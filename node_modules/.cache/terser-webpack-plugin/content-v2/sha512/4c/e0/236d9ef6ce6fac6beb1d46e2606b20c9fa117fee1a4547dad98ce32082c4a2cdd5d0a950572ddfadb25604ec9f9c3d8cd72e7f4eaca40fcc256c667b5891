{"code":"!function(e){var r={};function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var n in e)t.d(i,n,function(r){return e[r]}.bind(null,n));return i},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=\"\",t(t.s=7)}([function(e,r){e.exports.dm={},e.exports.r=[],e.exports.ri=0,e.exports.fi=null,e.exports.search=!0,e.exports.sdata={empty:!0},e.exports.init=!0,e.exports.mdownpos=[],e.exports.$addoc=$(\"#adddoc\"),e.exports.$loadsample=$(\"#loadsample\"),e.exports.$removedoc=$(\"#removedoc\"),e.exports.$initentry=$(\"#initentry\"),e.exports.$instr=$(\"#instr-button\")},function(e,t,i){const n=i(0),o=(i(4),i(2)),d=i(5),l=i(3),f=i(9),s=i(6),a=function(e){$(\".pdfwin\").empty(),void 0===e?$(\".pdfwin\").append('<iframe id=\"pdfiframe\" height=\"100%\" width=\"100%\" src=\"/doc/view\"></iframe>'):$(\".pdfwin\").append('<iframe id=\"pdfiframe\" height=\"100%\" width=\"100%\" src=\"'+e+'\"></iframe>'),$(\"#pdfiframe\").on(\"load\",function(){$(\"#pdfiframe\").contents().find(\"body\").off().mouseup(function(e){let r=document.getElementById(\"pdfiframe\").contentDocument.getSelection(),t=r.toString();if(t){if(mdownpos===[]&&(mdownpos=[e.pageX,e.pageY]),!validateSelection(t))return c(r),r.collapseToStart(),void $(\".fldwin\").attr(\"tabindex\",-1).focus();$(\".fldinput\").val(t),$(\".fldinput\").change(),r.collapseToStart(),$(\".fldwin\").attr(\"tabindex\",-1).focus(),mdownpos=[]}}),$(\"#pdfiframe\").contents().find(\"body\").mousedown(function(e){mdownpos=[e.pageX,e.pageY],$(\"#selecpopup\").remove()})})},c=function(e){const r=getFm().appname,t=$(\".mainwin\"),i=$(\".pdfwin\");t.append('<div id=\"selecpopup\" style=\"position:absolute;display:none;z-index:100;background-color:yellow;\"><b>Invalid selection for field: \"'+r+'\"</b></div>');$(\"#selecpopup\");$(\"#selecpopup\").offset({top:i.position().top+mdownpos[1]-45,left:i.position().left+mdownpos[0]-100}).show(),setTimeout(()=>{$(\"#selecpopup\").fadeOut(\"slow\",()=>{$(\"#selecpopup\").remove()})},2e3)};var u=function(e){$(\".error-body\").empty(),$(\".error-body\").append(e),$(\".error\").modal(\"show\")},p=function(e){$(\".ld-msg\").empty(),$(\".ld-msg\").append(e),$(\".loading\").modal(\"show\"),setTimeout(function(){m()},1e4)},m=function(){setTimeout(function(){$(\".loading\").modal(\"hide\")},200),$(\".ld-msg\").empty()},h=function(){var e=o.getBorR(),t=n.ri;n.fi;if($(\".sfviewmenu\").empty(),\"search\"==n.r[ri].type){if($(\".sfviewmenu\").append('<button type=\"button\" class=\"btn btn-primary newbase-button\">New</button'),$(\".newbase-button\").off().click(function(){n.r[t].type=\"base\",setOrder(t),n.fi=r[t].order[0],g(),v()}),$(\".sfviewbody\").empty(),$(\".sfviewbody\").append(\"<h4>Find or Create \"+e.appname+\" (\"+e.sobject+\")</h4>\"),n.sdata.empty)return!1;for(let e=0;e<n.sdata.records.length;e++){for(var i in $(\".sfviewbody\").append('<div class=\"search-result\" data-id=\"'+n.sdata.records[e].Id+'\" id=\"sresult'+e+'\"></div>'),n.sdata.layout)$(\"#sresult\"+e).append(\"<div>\"+parseLayout(n.sdata.layout[i],n.sdata.records[e])+\"</div>\");$(\"#sresult\"+e).off().click(function(){$.event.trigger({type:\"searchSelect\",Id:n.sdata.records[e].Id})})}}else $(\".sfviewmenu\").append('<button type=\"button\" class=\"btn btn-primary createbase-button\">Add to Salesforce</button'),$(\".createbase-button\").off().click(function(){p(),f.updateRecord(t,function(e,r){m(),console.log(\"Created contact record!\"),console.log(e),console.log(r),e[0]&&e[0].id&&(setValue(r,\"Id\",e[0].id),n.r[r].new=!1,d.loadAllRecords())})}),$(\".sfviewbody\").empty(),$(\".sfviewbody\").append(\"<h4>Add \"+e.appname+\" (\"+e.sobject+\") to Salesforce</h4>\")},v=function(){if(n.search)return h();n.ri>=n.r.length&&(n.ri=n.r.length-1),n.ri<0&&(n.ri=0),$(\".sfviewmenu\").empty(),$(\".sfviewmenu\").append('<button type=\"button\" class=\"btn btn-primary saveall-button\" style=\"margin-right:5px;\">Save All</button'),$(\".saveall-button\").off().click(function(){f.updateAll()}),$(\".sfviewmenu\").append('<button type=\"button\" class=\"btn btn-primary refresh-button\">Refresh</button'),$(\".refresh-button\").off().click(function(){d.loadAllRecords()}),$(\".sfviewbody\").empty();for(let r=0;r<n.dm.b.length;r++){$(\".sfviewbody\").append('<div class=\"sfview-header sfview-base-box\" id=\"sfview-hdr-b-'+r+'\"></div>'),$(\"#sfview-hdr-b-\"+r).append(\"<h4>\"+n.dm.b[r].appname+\"</h4>\");for(var e=0;e<n.dm.b[r].settings.layout.length;e++)$(\"#sfview-hdr-b-\"+r).append(\"<div>\"+parseLayout(n.dm.b[r].settings.layout[e],o.getFieldsForLayout(r))+\"</div>\");$(\"#sfview-hdr-b-\"+r).attr(\"style\",\"cursor:pointer\"),$(\"#sfview-hdr-b-\"+r).off().click(function(){l.jumpTo(r),g(),v()}),n.ri==r&&$(\"#sfview-hdr-b-\"+r).attr(\"style\",\"border:2px solid red;\")}for(let e=0;e<n.dm.r.length;e++)$(\".sfviewbody\").append('<div class=\"sfview-header\" id=\"sfview-hdr-r-'+e+'\"></div>'),$(\"#sfview-hdr-r-\"+e).append(\"<h4>\"+n.dm.r[e].appname+\"</h4>\");for(let e=n.dm.b.length;e<n.r.length;e++){$(\"#sfview-hdr-r-\"+n.r[e].ri).append('<div class=\"sfview-record\" id=\"sfview-rec-'+e+'\"></div>');for(let r=0;r<n.dm.r[n.r[e].ri].settings.layout.length;r++)$(\"#sfview-rec-\"+e).append(\"<div>\"+parseLayout(n.dm.r[n.r[e].ri].settings.layout[r],getFieldsForLayout(e))+\"</div>\");$(\"#sfview-rec-\"+e).off().click(function(){jumpTo(e),g(),v()}),n.ri==e&&$(\"#sfview-rec-\"+e).attr(\"style\",\"border: 2px solid red;\")}var r=$(\".sfviewbody\").scrollTop();if(n.ri<n.dm.b.length)var t=$(\"#sfview-hdr-b-\"+ri);else t=$(\"#sfview-rec-\"+ri);var i=t.offset().top-$(\".sfviewbody\").offset().top,s=i+t.height();s>$(\".sfviewbody\").innerHeight()?$(\".sfviewbody\").scrollTop(r+s-$(\".sfviewbody\").innerHeight()+5):i<0&&$(\".sfviewbody\").scrollTop(r+i)},b=function(e){var r=new Date(e);return[\"Jan.\",\"Feb.\",\"Mar.\",\"Apr.\",\"May\",\"June\",\"July\",\"Aug.\",\"Sep.\",\"Oct.\",\"Nov.\",\"Dec.\"][r.getMonth()]+\" \"+r.getDate()+\", \"+r.getFullYear()},g=function(){n.ri>=n.r.length&&(n.ri=n.r.length-1),n.ri<0&&(n.ri=0),$(\".fldwinleft\").empty(),0==n.ri&&n.fi==n.r[0].order[0]||($(\".fldwinleft\").append('<a class=\"btn btn-primary\" href=\"#\" id=\"prevlink\"><</a>'),$(\"#prevlink\").off().click(function(){l.updateR(),l.setOrder(),l.prevf(),g(),v()})),$(\".fldwinright\").empty(),(n.ri<n.r.length-1||n.fi!=n.r[n.r.length-1].order[n.r[n.r.length-1].order.length-1])&&($(\".fldwinright\").append('<a class=\"btn btn-primary\" href=\"#\" id=\"nextlink\">></a>'),$(\"#nextlink\").off().click(function(){l.updateR(),l.setOrder(),l.nextf(),g(),v()}));n.r[n.ri];var e=fm.getBorR();switch($(\".fldtitle\").empty(),$(\".fldtitle\").append(\"<h4>\"+e.fields[n.fi].appname+\"</h4>\"),$(\".fldinstr\").empty(),e.fields[n.fi].instructions&&$(\".fldinstr\").append(\"<p>\"+e.fields[n.fi].instructions+\"</p>\"),$(\".fldentry\").empty(),e.fields[n.fi].type){case\"text\":if(e.fields[n.fi].length>260)var r='<textarea style=\"resize: none\" rows=\"5\" cols=\"45\" ';else r='<input type=\"text\" size=\"45\" ';r+='class=\"fldinput\" maxlength = \"'+e.fields[n.fi].length+'\" > ';break;case\"phone\":r='<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"40\">';break;case\"url\":r='<input class=\"fldinput\" type=\"text\" size=\"50\">';break;case\"email\":r='<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"'+e.fields[n.fi].length+'\">';break;case\"picklist\":r='<select class=\"fldinput\">';r+='<option value=\"\">None</option>';for(var t=0;t<e.fields[n.fi].values.length;t++)r+=\"<option>\"+e.fields[n.fi].values[t]+\"</option>\";r+=\"</select>\";break;case\"date\":r='<input class=\"fldinput\" type=\"text\" maxlength=\"100\">';break;case\"index\":r='<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"255\">';break;case\"boolean\":r='<input class=\"fldinput\" type=\"checkbox\" >'}$(\".fldentry\").append(r),n.r[n.ri].f[n.fi].value&&(\"index\"==e.fields[n.fi].type?n.r[ri].f[fi].showval&&$(\".fldinput\").val(n.r[n.ri].f[n.fi].showval):\"date\"==e.fields[n.fi].type?$(\".fldinput\").val(b(n.r[n.ri].f[n.fi].value)):\"boolean\"==e.fields[n.fi].type?n.r[n.ri].f[n.fi].value?$(\".fldinput\").prop(\"checked\",!0):$(\".fldinput\").prop(\"checked\",!1):$(\".fldinput\").val(n.r[n.ri].f[n.fi].value));let i=n.ri,o=n.fi;e.fields[n.fin].indexto;$(\".fldinput\").off().change(function(){if(\"index\"==e.fields[o].type)return\"\"==$(\".fldinput\").val()?(n.r[i].f[o].showval=null,n.r[i].f[o].value=null,l.updateR(),l.setOrder(),l.nextf(),g(),void v()):(n.r[i].f[o].showval=$(\".fldinput\").val(),void d.searchIndexRecord(i,o));\"boolean\"!=e.fields[o].type?setValue(i,o,$(\".fldinput\").val())&&(l.updateR(),l.setOrder(),l.nextf(),g(),v()):n.r[i].f[o].value=$(\".fldinput\").prop(\"checked\")})},y=function(e,r){t.getBorR(e);var t=t.getFm(e,r);$(\".increate-title\").empty(),$(\".increate-body\").empty(),$(\".increate-title\").append(\"Create new \"+t.appname+\" record\");var i={};i.sobject=t.indexto,i.record={};for(let e=0;e<t.createfields.length;e++)$(\".increate-body\").append('<div id=\"increate-fld-'+e+'\"></div>'),$(\"#increate-fld-\"+e).append('<h5 id=\"increate-fldtitle-'+e+'\"></h5>'),$(\"#increate-fld-\"+e).append('<input type=\"text\" size=\"45\" id=\"increate-fldinput-'+e+'\">'),$(\"#increate-fldtitle-\"+e).append(t.createfields[e]+\":\"),t.createfields[e]==t.indexshow&&$(\"#increate-fldinput-\"+e).val($(\".fldinput\").val());$(\".increate-create-btn\").off().click(function(){for(var i={sobject:t.indexto,records:[{}]},o=0;o<t.createfields.length;o++)$(\"#increate-fldinput-\"+o).val()&&(i.records[0][t.createfields[o]]=$(\"#increate-fldinput-\"+o).val());for(var d in t.indexfields)t.indexfields[d].value&&(i.records[0][d]=t.indexfields[d].value);p(\"Creating \"+t.appname+\" record\"),$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/create\",dataType:\"json\",async:!0,data:JSON.stringify(i),success:function(o){if(m(),o[0].err||!o[0].success)return u(\"Could not create \"+t.indexto+\": \"+o[0].err),!1;$(\".increate\").modal(\"hide\"),l.setValue(e,r,o[0].id),n.r[e].f[r].showval=i.records[0][t.indexshow],g(),v()}})}),$(\".increate\").modal(\"show\")};e.exports.renderDoc=a,e.exports.renderSelectionErr=c,e.exports.renderError=u,e.exports.renderAlert=function(e,r){$(\".alert-body\").empty(),$(\".alert-body\").append(e),$(\".alert\").modal(\"show\"),$(\".alert-execute\").off().click(function(){$(\".alert\").modal(\"hide\"),r&&r()})},e.exports.renderOpenUrl=function(){$(\".openurl-input\").val(\"\"),$(\".openurlmodal\").modal(\"show\"),$(\".openurl-open-btn\").off().click(function(){$(\".openurlmodal\").modal(\"hide\"),a($(\".openurl-input\").val())})},e.exports.renderLoadingStart=p,e.exports.renderLoadingEnd=m,e.exports.renderBaseSearch=h,e.exports.renderSfView=v,e.exports.convertDate=b,e.exports.renderFldEntry=g,e.exports.renderIndexSearch=function(e,r,t){var i=o.getFm(e,r);$(\".insrch-title\").empty(),$(\".insrch-body\").empty(),$(\".insrch-title\").prepend(\"Searching for \"+i.indexto),$(\".insrch\").modal(\"show\");for(let n=0;n<t.length;n++){$(\".insrch-body\").append('<div class=\"insresult\" id=\"insresult'+n+'\"></div>');for(let e=0;e<i.searchlayout.length;e++)$(\"#insresult\"+n).append(\"<span>\"+parseLayout(i.searchlayout[e],t[n])+\"</span>\");$(\"#insresult\"+n).off().click(function(){indexSearchSelected(e,r,t[n]),$(\".insrch\").modal(\"hide\")})}$(\".insrch-create-btn\").off().click(function(){y(e,r)})},e.exports.renderIndexCreate=y,e.exports.renderAll=function(){v(),g(),a()},e.exports.renderInstructions=function(){$(\".instructions-frame\").show(),s.unbindEvents()},e.exports.renderInstructionsHide=function(){$(\".instructions-frame\").hide(),s.bindEvents()}},function(e,r,t){const i=t(0),n=function(e){return void 0===e&&(e=i.ri),\"record\"==i.r[e].type?i.dm.r[i.r[e].ri]:\"base\"==i.r[e].type?i.dm.b[i.r[e].bi]:\"search\"==i.r[e].type&&i.dm.b[i.r[e].bi]},o=function(e,r){const t=function(e,t,i){let n=$.trim(e).split(\"=\");return r[n[0]]?1==n.length?r[n[0]]?o(t,r):o(i,r):n.length>1?r[n[0]]==n[1]?o(t,r):o(i,r):\"#BAD CONDITION (else)#\":o(i,r)};let i,n,d,l,f,s,a,c,u=\"\";for(i=0;i<e.length;i++)if(\"#\"===e[i])if(i+=1,\"IF\"===e.slice(i,i+2)){if(\"(\"!=e[i+=2]){u+=\"#BAD CONDITIONAL! (no opening parentheses)#\",i-=1;continue}for(n=i+1;n<e.length&&\")\"!=e[n];)n+=1;if(n===e.length){u+=\"#BAD CONDITIONAL! (no closing parentheses)#\",i-=1;continue}if(f=e.slice(i+1,n),\"{\"!=e[i=n+1])u+=\"#BAD CONDITIONAL! (no opening brackets for true)#\",i-=1;else{for(d=i+=1,s=0;d<e.length&&(\"}\"!=e[d]||s>0);)\"#\"==e[d]&&(s+=1),\"}\"==e[d]&&\"{\"!=e[d+1]&&(s-=1),d+=1;if(d===e.length){u+=\"#BAD CONDITIONAL! (no closing brackets for true)#\",i-=1;continue}if(a=e.slice(i,d),\"{\"===e[i=d+1]){for(l=i+=1,s=0;l<e.length&&(\"}\"!=e[l]||s>0);)\"#\"==e[l]&&(s+=1),\"}\"==e[l]&&\"{\"!=e[l+1]&&(s-=1),l+=1;c=e.slice(i,l),i=l+1}else c=\"\";i-=1,console.log(e[i]),u+=t(f,a,c)}}else if(\"{\"===e[i]){for(n=i+=1;n<e.length&&\"}\"!=e[n];)n+=1;if(n===e.length){u+=\"#BAD FIELD#\",i-=1;continue}r[e.slice(i,n)]?u+=r[e.slice(i,n)]:u+=\"#BAD FIELD#\",i=n}else u+=\"#\";else u+=e[i];return u};e.exports.convRecSA=function(e,r,t){const n=function(t){let n=\"record\"===e?i.dm.r[r].fields:i.dm.b[r].fields,o={};for(let e in t)for(let r in n)n[r].sfname===e&&(o[r]=t[e]);return o};let o=[];if(Array.isArray(t))for(let e=0;e<t.length;e++)o.push(n(t[e]));return o},e.exports.getFieldsForLayout=function(e){let r={},t=n(e);for(let n in i.r[e].f)\"index\"===t.fields[n].type&&i.r[e].f[n].showval?r[n]=i.r[e].f[n].showval:r[n]=i.r[e].f[n].value;return r},e.exports.getBorR=n,e.exports.getFm=function(e,r){return null==r&&(e=i.ri,r=i.fi),\"record\"==i.r[e].type?i.dm.r[i.r[e].ri].fields[r]:\"base\"==i.r[e].type?i.dm.b[i.r[e].bi].fields[r]:\"search\"==i.r[e].type&&i.dm.b[i.r[e].bi].fields[r]},e.exports.parseLayout=o},function(e,t,n){const o=n(0),d=n(2),l=n(5),f=n(1),s=function(e){return!!o.r[e].new},a=function(e){getBorR(e);if(r[e].new||!r[e].f.Id){for(let t in r[e].f)if(r[e].f[t].changed)return!0;return!1}for(let t in r[e].f)if(r[e].f[t].changed&&r[e].f[t].value!=r[e].f[t].origval)return!0;return!1},c=function(e){return!(e<0||e>=dm.r.length&&\"record\"==o.r[o.ri].type)&&(y(e),s(o.ri)&&!a(o.ri)?r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0)},u=function(){return s(o.ri)&&!a(o.ri)?o.r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0},p=function(){if(o.ri===o.r.length-1){if(o.ri>=o.dm.b.length)return!s(o.ri)||s(o.ri)&&a(o.ri)?c(o.r[o.ri].ri):o.r[o.ri].ri<o.dm.r.length-1&&c(o.r[o.ri].ri+1);if(o.ri<o.dm.b.length-1)return!1;if(o.ri===o.dm.b.length-1)return!s(o.ri)&&c(0)}else if(o.ri<o.r.length-1)return o.r[o.ri+1].d.ri===o.r[o.ri].ri||\"base\"===o.r[ri].type?u():!s(o.ri)||s(o.ri)&&a(o.ri)?c(o.r[o.ri].ri):o.r[o.ri+1].ri===o.r[o.ri].ri+1?u():c(o.r[o.ri].ri+1);return!1},m=function(e){return!(e<0||e>=dm.r.length)&&(y(e),s(o.ri+1)&&!a(o.ri+1)&&o.r.splice(o.ri+1,1),o.fi=o.r[o.ri].order[0],!0)},h=function(){return s(o.ri)&&!a(o.ri)&&\"record\"===o.r[o.ri].type&&o.r.splice(o.ri,1),o.ri-=1,o.fi=o.r[o.ri].order[0],!0},v=function(){if(o.fi===o.r[o.ri].order[0])return 0!==o.ri&&(o.ri<o.dm.b.length?h():0===o.r[o.ri].ri||o.r[o.ri-1].ri===o.r[o.ri].ri||s(o.ri-1)&&!a(o.ri-1)?h():m(o.r[o.ri].ri-1),!0)&&(o.fi=o.r[o.ri].order[o.r[o.ri].order.length-1],!0);for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e-1];break}return!0},b=function(e){null==e&&(e=o.ri);let r,t=function(e,r){let i=[];for(let n=0;n<e.length;n++)if(i.push(e[n].field),e[n].autofill&&!r[e[n].field].origval&&\"filled\"===e[n].autofill.condition&&(r[e[n].autofill.conditionfield].value&&e[n].autofill.true?r[e[n].field].value=e[n].autofill.true:!r[e[n].autofill.conditionfield].value&&e[n].autofill.false&&(r[e[n].field].value=e[n].autofill.false)),e[n].condition)if(\"filled\"===e[n].condition)r[e[n].field].value&&e[n].true?i=i.concat(t(e[n].true,r)):!r[e[n].field].value&&e[n].false&&(i=i.concat(t(e[n].false,r)));else if(\"switch\"===e[n].condition)for(let o=0;o<e[n].switch.length;o++)for(let d=0;d<e[n].switch[o].value.length;d++)if(r[e[n].field].value==e[n].switch[o].value[d]){i=i.concat(t(e[n].switch[o].order,r));break}return i},i=o.r[e];\"base\"===i.type?(r=o.dm.b[i.bi],orderm=r.settings.order):\"search\"===i.type?(r=o.dm.b[i.bi],orderm=r.settings.searchorder):\"record\"===i.type&&(r=o.dm.r[i.ri],orderm=r.settings.order),i.order=t(orderm,o.r[e].f)},g=function(){for(let e=0;e<o.dm.b.length;e++){r.push({type:\"search\",bi:e,new:!0,order:[],f:{}});for(let r in o.dm.b[e].fields)o.r[e].f[r]={sfname:o.dm.b[e].fields[r].sfname},o.dm.b[e].fields[r].value?o.r[e].f[r].value=o.dm.b[e].fields[r].value:(o.r[e].f[r].value=null,o.r[e].f[r].origval=null);b(e)}o.ri=0,o.fi=o.r[ri].order[0]},y=function(e,r){let t=o.dm.b.length;for(;t<o.r.length;)if(r){if(!(o.r[t].ri<=e)||o.r[t].ri===e&&o.r[t].f.Id.value===r.Id)break;t++}else{if(!(o.r[t].ri<=e))break;t+=1}t===o.r.length?o.r.push({type:\"record\",ri:e,order:[],f:{}}):o.r[t].ri===e&&o.r[t].f.Id.value===r.Id?o.r.splice(t,1,{type:\"record\",ri:e,order:[],f:{}}):o.r.splice(t,0,{type:\"record\",ri:e,order:[],f:{}}),o.r[t].new=!r;for(let i in o.dm.r[e].fields)o.r[t].f[i]={},o.r[t].f[i].sfname=o.dm.r[e].fields[i].sfname,o.r[t].new?o.dm.r[e].fields[i].inherits?o.r[t].f[i].value=o.r[o.dm.r[e].fields[i].inherits.base].f[o.dm.r[e].fields[i].inherits.field].value:o.dm.r[e].fields[i].autofill?o.r[t].f[i].value=o.r[o.dm.r[e].fields[i].autofill.base].f[o.dm.r[e].fields[i].autofill.field].value:o.dm.r[e].fields[i].value?o.r[t].f[i].value=o.dm.r[e].fields[i].value:o.dm.r[e].fields[i].default?o.r[t].f[i].value=o.dm.r[e].fields[i].default:o.r[t].f[i].value=null:(o.r[t].f[i].value=r[o.dm.r[e].fields[i].sfname],o.r[t].f[i].origval=r[o.dm.r[e].fields[i].sfname]);return b(t),!0};e.exports.initR=function(){o.r=[],o.ri=0,g(),o.search=!0,o.sdata={empty:!0},o.fi=o.r[o.ri].order[0],f.renderSfView(),f.renderFldEntry()},e.exports.orderR=function(){const e=function(e,r){e&&r&&e!==r&&o.r.splice(r,0,o.r.splice(e,1)[0])};for(let d=0;d<o.dm.r.length;d++){let l=0,f=[];const s=o.dm.r[d],a=s.settings.listorder;for(let e=0;e<a.length;e++)f.push(s.fields[a[e].field]);for(l=o.dm.b.length;l<o.r.length&&o.r[l].ri<d;l++);if(l==r.length-1)break;for(let r=a.length-1;r>=0;r--){const s=f[r].type;for(let c=l;c<o.r.length&&o.r[c].ri===d;c++){if(\"index\"===s)if(o.r[c].f[a[r].field].showval)var t=o.r[c].f[a[r].field].showval;else t=\"\";else t=o.r[c].f[a[r].field].value;for(let d=c-1;d>=l;d--){if(\"index\"===s){var i=f[r].indexfields[f[r].indexshow].type;if(o.r[d].f[a[r].field].showval)var n=o.r[d].f[a[r].field].showval;else n=\"\"}else i=s,n=o.r[d].f[a[r].field].value;if(null==t||\"\"===t){if(null==n||\"\"===n){e(c,d+1);break}if(a[r].empty){if(\"last\"==a[r].empty)break;if(\"first\"==a[r].empty){if(d==l){e(c,d);break}continue}break}break}if(null!=n&&null!=n&&\"\"!=n){if(\"date\"===i&&(t=new Date(t).getTime(),n=new Date(n).getTime()),t===n){e(c,d+1);break}if(t>n){if(\"asc\"===a[r].order){e(c,d+1);break}if(d===l){e(c,d);break}}else if(t<n){if(\"desc\"===a[r].order){e(c,d+1);break}if(d==l){e(c,d);break}}}else if(a[r].empty){if(\"last\"==a[r].empty)continue;if(\"first\"==a[r].empty){e(c,d+1);break}e(c,d+1);break}}}}}},e.exports.isNew=s,e.exports.isChanged=a,e.exports.allUnchanged=function(){for(let e in r)if(a(e))return!1;return!0},e.exports.basesUpToDate=function(){for(let e in dm.b)if(a(e))return!1;return!0},e.exports.setValue=function(e,t,i){let n;switch(getFm(e,t).type){case\"text\":case\"picklist\":case\"index\":case void 0:n=i;break;case\"date\":{if(\"\"==i||\" \"==i){n=null;break}const e=i.split(\" \");let r;if(1==e.length?r=i<9999&&i>1e3?new Date(\"Jan. 1, \"+i):new Date(i):2==e.length?\"SPRING\"==e[0].toUpperCase()?r=new Date(\"May 30, \"+e[1]):\"SUMMER\"==e[0].toUpperCase()?r=new Date(\"July 15, \"+e[1]):\"FALL\"==e[0].toUpperCase()?r=new Date(\"September 1, \"+e[1]):\"WINTER\"==e[0].toUpperCase()&&(r=new Date(\"December 15, \"+e[1])):r=new Date(i),!r||isNaN(r.getTime()))return renderError(\"Not a valid date!\"),!1;n=r.toISOString();break}case\"email\":if(!/[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(i))return renderError(\"Not a valid email address!\"),!1;n=i;break;default:n=i}return r[e].f[t].value=n,r[e].f[t].changed=!0,b(e),!0},e.exports.validateSelection=function(e){e=e.trim();const r=$(\".fldinput\"),t=getFm().type;let i=!0;if(\"INPUT\"===r.prop(\"nodeName\")?\"text\"===r.attr(\"type\")&&(e.indexOf(\"\\n\")>-1&&(i=!1),e.length>r.attr(\"size\")&&(i=!1)):\"SELECT\"===r.prop(\"nodeName\")&&(i=!1,$(\".fldinput option\").each(function(){this.value==e&&(i=!0)})),\"phone\"===t)e.length>20&&(i=!1),/[\\&\\@\\$\\%\\^\\{\\}]/.test(e)&&(i=!1),/\\d/.test(e)||(i=!1);else if(\"date\"===t)e.length>19&&(i=!1);else if(\"email\"===t)console.log(\"email\"),/[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+\\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)||(i=!1);else if(\"url\"===t){console.log(\"url\");const r=/\\.+/;/[\\s\\\"]+/.test(e)&&(i=!1),r.test(e)||(i=!1)}return i},e.exports.nextrAndAdd=c,e.exports.nextrNoAdd=u,e.exports.nextr=p,e.exports.prevrAndAdd=m,e.exports.prevrNoAdd=h,e.exports.prevr=v,e.exports.nextf=function(){if(fi===o.r[o.ri].order[o.r[o.ri].order.length-1])return p();for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e+1];break}return!0},e.exports.prevf=v,e.exports.jumpTo=function(e){return!!o.r[e]&&(o.ri=e,o.fi=o.r[e].order[0],!0)},e.exports.setOrder=b,e.exports.addSearchRecords=g,e.exports.addBaseRecord=function(e,t){for(let i=0;i<o.r.length;i++)if(o.r[i].bi==e){o.r.splice(i,1,{type:\"base\",bi:i,new:!1,order:[],f:{}});for(let e in o.dm.b[i].fields)o.r[i].f[e]={sfname:o.dm.b[i].fields[e].sfname},t?(o.r[i].f[e].value=t[o.dm.b[i].fields[e].sfname],o.r[i].f[e].origval=t[o.dm.b[i].fields[e].sfname]):o.dm.b[i].fields[e].value?o.r[i].f[e].value=o.dm.b[i].fields[e].value:(o.r[i].f[e].value=null,o.r[i].f[e].origval=null);b(i);for(let e=0;e<o.r.length;e++)if(\"search\"===o.r[e].type)return o.ri=e,o.fi=o.r[e].order[0],!0;return o.search&&(l.clearBaseSearch(),o.fi=r[i].order[0],l.loadAllRecords()),!0}return!1},e.exports.addRecord=y,e.exports.updateIndexFields=function(e,t){if(!e||\"function\"!=typeof e)return!1;renderLoadingStart(\"Looking up index fields\");let n=0,l=0;if(void 0!==t&&t<r.length){let d=rf.getBorR(t);for(let e in o.r[t].f)\"index\"===d.fields[e].type&&o.r[t].f[e].value&&(l+=1);if(0===l)return f.renderLoadingEnd(),void e();for(let e in r[t].f)if(\"index\"===d.fields[e].type&&o.r[t].f[e].value){let r,t={};t[d.fields[e].indexshow]=1,$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify({sobject:d.fields[e].indexto,conditions:{Id:o.r[i].f[e].value},fields:t}),success:t=>{n+=1,t[0]&&(o.r[i].f[e].showval=t[0][d.fields[e].indexshow]),n===l&&(f.renderLoadingEnd(),r())}})}return!0}l=0,n=0;for(let e in r){let t=d.getBorR(e);for(let i in r[e].f)\"index\"==t.fields[i].type&&r[e].f[i].value&&(l+=1)}if(0===l)return f.renderLoadingEnd(),void e();for(let t in r){let i=d.getBorR(t);for(let d in r[t].f)if(\"index\"==i.fields[d].type&&r[t].f[d].value){let r={};r[i.fields[d].indexshow]=1,$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify({sobject:i.fields[d].indexto,conditions:{Id:o.r[t].f[d].value},fields:r}),success:r=>{n+=1,r[0]&&(o.r[t].f[d].showval=r[0][i.fields[d].indexshow]),n===l&&(f.renderLoadingEnd(),e())}})}}},e.exports.updateR=function(){return fm=d.getFm(),!(!(o.r[o.ri].f[o.fi].origval&&o.r[o.ri].f[o.fi].value==o.r[o.ri].f[o.fi].origval||\"search\"!==o.r[o.ri].type)&&o.r[o.ri].new)||l.searchBase(o.ri)}},function(e,r,t){const i=t(1);e.exports.addDoc=function(e,r){return i.renderLoadingStart(\"Loading document\"),!!e&&!!e.get(\"file\")&&($.ajax({url:\"/doc/load\",type:\"POST\",data:e,success:function(e){if(renderLoadingEnd(),e.err||!e.iframeurl)return renderError(e.err),!1;renderDoc(e.iframeurl)},cache:!1,contentType:!1,processData:!1}),!0)},e.exports.removeDoc=function(e){renderLoadingStart(\"Removing Document\"),$.getJSON(\"/doc/remove\",function(r){renderLoadingEnd(),r.err?i.renderError(r.err):e?e():i.renderDoc()})}},function(e,t,i){const n=i(0),o=i(2),d=i(3),l=i(1),f=function(e){let r={};for(let t in n.sdata.records)n.sdata.records[t].Id===e&&(r=n.sdata.records[t]);if(!r.Id)return!1;d.addBaseRecord(n.sdata.i,r)};e.exports.searchBase=function(e){if(\"search\"!=n.r[e].type)return!1;const r=o.getBorR(e);let t={};t.sobject=r.sobject,t.conditions={},t.fields={};for(let e in r.fields)t.fields[r.fields[e].sfname]=1;for(let i=0;i<r.settings.searchorder.length;i++){let o=r.settings.searchorder[i].field;n.r[e].f[o].value&&(\"text\"==r.fields[o].type?t.conditions[r.fields[o].sfname]={$like:\"%\"+n.r[e].f[o].value.replace(/\\s+/g,\"%\")+\"%\"}:t.conditions[r.fields[o].sfname]=n.r[e].f[o].value)}renderLoadingStart(\"Searching for \"+r.appname),$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify(t),success:function(i){n.search=!0,n.sdata={type:\"base\",layout:r.settings.searchlayout,sobject:t.sobject,i:n.r[e].bi,records:o.convRecSA(\"base\",n.r[e].bi,i)},$(document).on(\"searchSelect\",function(e){if(!e)return!1;e.Id&&f(e.Id)}),l.renderLoadingEnd(),l.renderSfView()}})},e.exports.clearBaseSearch=function(){n.search=!1,n.sdata={empty:!0},l.renderSfView()},e.exports.searchIndexRecord=function(e,r){var t=o.getBorR(e),i=t.fields[r];if(\"index\"!=i.type)return!1;var d={sobject:i.indexto,conditions:{},fields:{Id:1}};for(var f in d.conditions[i.indexshow]={$like:\"%\"+n.r[e].f[r].showval.replace(/\\s\\s+/g,\"%\")+\"%\"},i.indexfields)d.fields[f]=1;renderLoadingStart(\"Searching for \"+t.fields[r].indexto),$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify(d),success:function(t){return l.renderLoadingEnd(),l.renderIndexSearch(e,r,t)}})},e.exports.loadAllRecords=function(e){renderLoadingStart(\"Loading all records\");let t=0;if(n.r.length>n.dm.b.length){let e=n.r.length;for(let r=n.dm.b.length;r<e;r++)n.r.pop()}for(let r=0;r<n.dm.b.length;r++){if(!n.r[r].f.Id.value)continue;let i={sobject:n.dm.b[r].sobject,conditions:{},fields:{}};i.conditions.Id=n.r[r].f.Id.value;for(let e in n.dm.b[r].fields)i.fields[n.dm.b[r].fields[e].sfname]=1,n.dm.b[r].fields[e].value&&(i.conditions[n.dm.b[r].fields[e].sfname]=n.dm.b[r].fields[e].value);$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify(i),success:function(i){if(t+=1,i)for(let e in i)d.addBaseRecord(r,i[e]);t===n.dm.b.length+n.dm.r.length&&(d.orderR(),d.updateIndexFields(()=>{l.renderFldEntry(),l.renderSfView(),e&&\"function\"==typeof e&&e()}))}})}let i=n.dm.r.length;for(let o=0;o<i;o++){let i={sobject:n.dm.r[o].sobject,conditions:{},fields:{}};for(let e in n.dm.r[o].fields)if(i.fields[n.dm.r[o].fields[e].sfname]=1,n.dm.r[o].fields[e].value)i.conditions[n.dm.r[o].fields[e].sfname]=n.dm.r[o].fields[e].value;else if(n.dm.r[o].fields[e].inherits)for(let t in r)n.r[t].bi==n.dm.r[o].fields[e].inherits.base&&(i.conditions[n.dm.r[o].fields[e].sfname]=n.r[t].f[n.dm.r[o].fields[e].inherits.field].value);$.ajax({type:\"POST\",contentType:\"application/json\",url:\"/api/find\",dataType:\"json\",async:!0,data:JSON.stringify(i),success:function(r){if(t+=1,r)for(let e in r)d.addRecord(o,r[e]);return t===dm.b.length+dm.r.length&&(d.orderR(),d.updateIndexFields(()=>{l.renderFldEntry(),l.renderSfView(),e&&\"function\"==typeof e&&e()})),!0}})}},e.exports.indexSearchSelected=function(e,r,t){if(!t.Id)return!1;d.setValue(e,r,t.Id);const i=o.getFm(e,r);return!!t[i.indexshow]&&(n.r[e].f[r].showval=t[i.indexshow],d.nextf(),l.renderFldEntry(),!0)},e.exports.baseSearchSelected=f,e.exports.recordSearchSelected=function(e){let r={};for(let t in n.sdata.records)n.sdata.records[t].Id===e&&(r=n.sdata.records[t]);if(!r.Id)return!1;d.addRecord(n.sdata.i,record),l.renderSfView(),l.renderFldEntry()}},function(e,t,i){const n=i(0),o=i(4),d=i(3),l=i(1);e.exports.bindEvents=function(){n.$initentry.off().click(function(){allUnchanged()?(d.initR(),l.renderSfView(),l.renderFldEntry()):renderAlert(\"Initiating data entry will end your current session, erasing any unsaved data. Are you sure you wish to continue?\",()=>{d.initR(),l.renderSfView(),l.renderFldEntry()})}),n.$addoc.off().change(function(){const e=new FormData;return e.append(\"file\",n.$addoc[0].files[0]),n.$addoc.val(null),o.addDoc(e)}),n.$loadsample.off().click(function(){l.renderDoc(\"/pdfviewer/web/viewer.html?file=/doc/SampleRoster.pdf\"),(r=[])&&(d.initR(),l.renderSfView(),l.renderFldEntry())}),n.$removedoc.off().click(function(){allUnchanged()?o.removeDoc(function(){d.initR(),l.renderAll()}):l.renderAlert(\"Removing document now will erase all unsaved changes.\",()=>{o.removeDoc(function(){d.initR(),l.renderAll()})})}),n.$instr.off().click(function(){l.renderInstructions()}),$(document).off(\"keydown\").keydown(e=>{let r=$(\".fldinput\");if($(\"select\").is(\":focus\")||$(\"input\").is(\":focus\")||$(\"textarea\").is(\":focus\"))13===e.which&&r&&r.change();else{if(39===e.which){if(!nextf())return}else if(37===e.which){if(!prevf())return}else if(40===e.which){if(!nextr())return}else if(38===e.which){if(!prevr())return}else if(32!==e.which)return;if(l.renderFldEntry(),l.renderSfView(),32===e.which){e.preventDefault();let r=$(\".fldinput\");r&&r.focus()}}})},e.exports.unbindEvents=function(){n.$initentry.off(),n.$addoc.off(),n.$loadsample.off(),n.$removedoc.off(),n.$instr.off(),$(document).off(\"keydown\")}},function(e,r,t){t(8),function(){var e=new Error(\"Cannot find module 'sf-pdf-webloader.js'\");throw e.code=\"MODULE_NOT_FOUND\",e}()},function(e,r,t){const i=t(0),n=t(1),o=t(6);i.$addoc=$(\"#adddoc\"),i.$loadsample=$(\"#loadsample\"),i.$removedoc=$(\"#removedoc\"),i.$initentry=$(\"#initentry\"),i.$instr=$(\"#instr-button\"),$.getJSON(\"/api/dm\",function(e){e.b&&e.r?(i.dm=e,o.bindEvents(),$(\".instructions\").off().click(e=>{e.stopPropagation()}),$(\".modal\").on(\"hidden.bs.modal\",function(){o.bindEvents()}),$(\".modal\").on(\"shown.bs.modal\",function(){$(\".fldwin\").attr(\"tabindex\",-1).focus(),o.unbindEvents()})):n.renderError(\"Can't access server!\")})},function(e,r){}]);","extractedComments":[]}