!function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=6)}([function(e,r){e.exports.dm={},e.exports.r=[],e.exports.ri=0,e.exports.fi=null,e.exports.search=!0,e.exports.sdata={empty:!0},e.exports.init=!0,e.exports.mdownpos=[],e.exports.$addoc=$("#adddoc"),e.exports.$loadsample=$("#loadsample"),e.exports.$removedoc=$("#removedoc"),e.exports.$initentry=$("#initentry"),e.exports.$instr=$("#instr-button")},function(e,r,t){const n=t(0),i=t(2),o=t(4),d=t(3),l=t(7),s=t(5),a=function(e){$(".pdfwin").empty(),void 0===e?$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="/doc/view"></iframe>'):$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="'+e+'"></iframe>'),$("#pdfiframe").on("load",function(){$("#pdfiframe").contents().find("body").off().mouseup(function(e){let r=document.getElementById("pdfiframe").contentDocument.getSelection(),t=r.toString();if(t){if(mdownpos===[]&&(mdownpos=[e.pageX,e.pageY]),!d.validateSelection(t))return f(r),r.collapseToStart(),void $(".fldwin").attr("tabindex",-1).focus();$(".fldinput").val(t),$(".fldinput").change(),r.collapseToStart(),$(".fldwin").attr("tabindex",-1).focus(),mdownpos=[]}}),$("#pdfiframe").contents().find("body").mousedown(function(e){mdownpos=[e.pageX,e.pageY],$("#selecpopup").remove()})})},f=function(e){const r=i.getFm().appname,t=$(".mainwin"),n=$(".pdfwin");t.append('<div id="selecpopup" style="position:absolute;display:none;z-index:100;background-color:yellow;"><b>Invalid selection for field: "'+r+'"</b></div>');$("#selecpopup");$("#selecpopup").offset({top:n.position().top+mdownpos[1]-45,left:n.position().left+mdownpos[0]-100}).show(),setTimeout(()=>{$("#selecpopup").fadeOut("slow",()=>{$("#selecpopup").remove()})},2e3)};var c=function(e){$(".error-body").empty(),$(".error-body").append(e),$(".error").modal("show")},u=function(e){$(".ld-msg").empty(),$(".ld-msg").append(e),$(".loading").modal("show"),setTimeout(function(){p()},1e4)},p=function(){setTimeout(function(){$(".loading").modal("hide")},200),$(".ld-msg").empty()},h=function(){var e=i.getBorR(),r=n.ri;n.fi;if($(".sfviewmenu").empty(),"search"==n.r[n.ri].type){if($(".sfviewmenu").append('<button type="button" class="btn btn-primary newbase-button">New</button'),$(".newbase-button").off().click(function(){n.r[r].type="base",d.setOrder(r),n.fi=n.r[r].order[0],b(),m()}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Find or Create "+e.appname+" ("+e.sobject+")</h4>"),n.sdata.empty)return!1;for(let e=0;e<n.sdata.records.length;e++){for(var t in $(".sfviewbody").append('<div class="search-result" data-id="'+n.sdata.records[e].Id+'" id="sresult'+e+'"></div>'),n.sdata.layout)$("#sresult"+e).append("<div>"+i.parseLayout(n.sdata.layout[t],n.sdata.records[e])+"</div>");$("#sresult"+e).off().click(function(){$.event.trigger({type:"searchSelect",Id:n.sdata.records[e].Id})})}}else $(".sfviewmenu").append('<button type="button" class="btn btn-primary createbase-button">Add to Salesforce</button'),$(".createbase-button").off().click(function(){u(),l.updateRecord(r,function(e,r){p(),e[0]&&e[0].id&&(d.setValue(r,"Id",e[0].id),n.r[r].new=!1,o.loadAllRecords())})}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Add "+e.appname+" ("+e.sobject+") to Salesforce</h4>")},m=function(){if(n.search)return h();n.ri>=n.r.length&&(n.ri=n.r.length-1),n.ri<0&&(n.ri=0),$(".sfviewmenu").empty(),$(".sfviewmenu").append('<button type="button" class="btn btn-primary saveall-button" style="margin-right:5px;">Save All</button'),$(".saveall-button").off().click(function(){l.updateAll()}),$(".sfviewmenu").append('<button type="button" class="btn btn-primary refresh-button">Refresh</button'),$(".refresh-button").off().click(function(){o.loadAllRecords()}),$(".sfviewbody").empty();for(let r=0;r<n.dm.b.length;r++){$(".sfviewbody").append('<div class="sfview-header sfview-base-box" id="sfview-hdr-b-'+r+'"></div>'),$("#sfview-hdr-b-"+r).append("<h4>"+n.dm.b[r].appname+"</h4>");for(var e=0;e<n.dm.b[r].settings.layout.length;e++)$("#sfview-hdr-b-"+r).append("<div>"+i.parseLayout(n.dm.b[r].settings.layout[e],i.getFieldsForLayout(r))+"</div>");$("#sfview-hdr-b-"+r).attr("style","cursor:pointer"),$("#sfview-hdr-b-"+r).off().click(function(){d.jumpTo(r),b(),m()}),n.ri==r&&$("#sfview-hdr-b-"+r).attr("style","border:2px solid red;")}for(let e=0;e<n.dm.r.length;e++)$(".sfviewbody").append('<div class="sfview-header" id="sfview-hdr-r-'+e+'"></div>'),$("#sfview-hdr-r-"+e).append("<h4>"+n.dm.r[e].appname+"</h4>");for(let e=n.dm.b.length;e<n.r.length;e++){$("#sfview-hdr-r-"+n.r[e].ri).append('<div class="sfview-record" id="sfview-rec-'+e+'"></div>');for(let r=0;r<n.dm.r[n.r[e].ri].settings.layout.length;r++)$("#sfview-rec-"+e).append("<div>"+i.parseLayout(n.dm.r[n.r[e].ri].settings.layout[r],i.getFieldsForLayout(e))+"</div>");$("#sfview-rec-"+e).off().click(function(){d.jumpTo(e),b(),m()}),n.ri==e&&$("#sfview-rec-"+e).attr("style","border: 2px solid red;")}var r=$(".sfviewbody").scrollTop();if(n.ri<n.dm.b.length)var t=$("#sfview-hdr-b-"+n.ri);else t=$("#sfview-rec-"+n.ri);var s=t.offset().top-$(".sfviewbody").offset().top,a=s+t.height();a>$(".sfviewbody").innerHeight()?$(".sfviewbody").scrollTop(r+a-$(".sfviewbody").innerHeight()+5):s<0&&$(".sfviewbody").scrollTop(r+s)},v=function(e){var r=new Date(e);return["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."][r.getMonth()]+" "+r.getDate()+", "+r.getFullYear()},b=function(){n.ri>=n.r.length&&(n.ri=n.r.length-1),n.ri<0&&(n.ri=0),$(".fldwinleft").empty(),0==n.ri&&n.fi==n.r[0].order[0]||($(".fldwinleft").append('<a class="btn btn-primary" href="#" id="prevlink"><</a>'),$("#prevlink").off().click(function(){d.updateR(),d.setOrder(),d.prevf(),b(),m()})),$(".fldwinright").empty(),(n.ri<n.r.length-1||n.fi!=n.r[n.r.length-1].order[n.r[n.r.length-1].order.length-1])&&($(".fldwinright").append('<a class="btn btn-primary" href="#" id="nextlink">></a>'),$("#nextlink").off().click(function(){d.updateR(),d.setOrder(),d.nextf(),b(),m()}));n.r[n.ri];var e=i.getBorR();switch($(".fldtitle").empty(),$(".fldtitle").append("<h4>"+e.fields[n.fi].appname+"</h4>"),$(".fldinstr").empty(),e.fields[n.fi].instructions&&$(".fldinstr").append("<p>"+e.fields[n.fi].instructions+"</p>"),$(".fldentry").empty(),e.fields[n.fi].type){case"text":if(e.fields[n.fi].length>260)var r='<textarea style="resize: none" rows="5" cols="45" ';else r='<input type="text" size="45" ';r+='class="fldinput" maxlength = "'+e.fields[n.fi].length+'" > ';break;case"phone":r='<input class="fldinput" type="text" size="45" maxlength="40">';break;case"url":r='<input class="fldinput" type="text" size="50">';break;case"email":r='<input class="fldinput" type="text" size="45" maxlength="'+e.fields[n.fi].length+'">';break;case"picklist":r='<select class="fldinput">';r+='<option value="">None</option>';for(var t=0;t<e.fields[n.fi].values.length;t++)r+="<option>"+e.fields[n.fi].values[t]+"</option>";r+="</select>";break;case"date":r='<input class="fldinput" type="text" maxlength="100">';break;case"index":r='<input class="fldinput" type="text" size="45" maxlength="255">';break;case"boolean":r='<input class="fldinput" type="checkbox" >'}$(".fldentry").append(r),n.r[n.ri].f[n.fi].value&&("index"==e.fields[n.fi].type?n.r[n.ri].f[n.fi].showval&&$(".fldinput").val(n.r[n.ri].f[n.fi].showval):"date"==e.fields[n.fi].type?$(".fldinput").val(v(n.r[n.ri].f[n.fi].value)):"boolean"==e.fields[n.fi].type?n.r[n.ri].f[n.fi].value?$(".fldinput").prop("checked",!0):$(".fldinput").prop("checked",!1):$(".fldinput").val(n.r[n.ri].f[n.fi].value));let l=n.ri,s=n.fi;e.fields[s].indexto;$(".fldinput").off().change(function(){if("index"==e.fields[s].type)return""==$(".fldinput").val()?(n.r[l].f[s].showval=null,n.r[l].f[s].value=null,d.updateR(),d.setOrder(),d.nextf(),b(),void m()):(n.r[l].f[s].showval=$(".fldinput").val(),void o.searchIndexRecord(l,s));"boolean"!=e.fields[s].type?d.setValue(l,s,$(".fldinput").val())&&(d.updateR(),d.setOrder(),d.nextf(),b(),m()):n.r[l].f[s].value=$(".fldinput").prop("checked")})},y=function(e,r){i.getBorR(e);var t=i.getFm(e,r);$(".increate-title").empty(),$(".increate-body").empty(),$(".increate-title").append("Create new "+t.appname+" record");var o={};o.sobject=t.indexto,o.record={};for(let e=0;e<t.createfields.length;e++)$(".increate-body").append('<div id="increate-fld-'+e+'"></div>'),$("#increate-fld-"+e).append('<h5 id="increate-fldtitle-'+e+'"></h5>'),$("#increate-fld-"+e).append('<input type="text" size="45" id="increate-fldinput-'+e+'">'),$("#increate-fldtitle-"+e).append(t.createfields[e]+":"),t.createfields[e]==t.indexshow&&$("#increate-fldinput-"+e).val($(".fldinput").val());$(".increate-create-btn").off().click(function(){for(var i={sobject:t.indexto,records:[{}]},o=0;o<t.createfields.length;o++)$("#increate-fldinput-"+o).val()&&(i.records[0][t.createfields[o]]=$("#increate-fldinput-"+o).val());for(var l in t.indexfields)t.indexfields[l].value&&(i.records[0][l]=t.indexfields[l].value);u("Creating "+t.appname+" record"),$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(i),success:function(o){if(p(),o[0].err||!o[0].success)return c("Could not create "+t.indexto+": "+o[0].err),!1;$(".increate").modal("hide"),d.setValue(e,r,o[0].id),n.r[e].f[r].showval=i.records[0][t.indexshow],b(),m()}})}),$(".increate").modal("show")};e.exports.renderDoc=a,e.exports.renderSelectionErr=f,e.exports.renderError=c,e.exports.renderAlert=function(e,r){$(".alert-body").empty(),$(".alert-body").append(e),$(".alert").modal("show"),$(".alert-execute").off().click(function(){$(".alert").modal("hide"),r&&r()})},e.exports.renderOpenUrl=function(){$(".openurl-input").val(""),$(".openurlmodal").modal("show"),$(".openurl-open-btn").off().click(function(){$(".openurlmodal").modal("hide"),a($(".openurl-input").val())})},e.exports.renderLoadingStart=u,e.exports.renderLoadingEnd=p,e.exports.renderBaseSearch=h,e.exports.renderSfView=m,e.exports.convertDate=v,e.exports.renderFldEntry=b,e.exports.renderIndexSearch=function(e,r,t){var n=i.getFm(e,r);$(".insrch-title").empty(),$(".insrch-body").empty(),$(".insrch-title").prepend("Searching for "+n.indexto),$(".insrch").modal("show");for(let o=0;o<t.length;o++){$(".insrch-body").append('<div class="insresult" id="insresult'+o+'"></div>');for(let e=0;e<n.searchlayout.length;e++)$("#insresult"+o).append("<span>"+i.parseLayout(n.searchlayout[e],t[o])+"</span>");$("#insresult"+o).off().click(function(){indexSearchSelected(e,r,t[o]),$(".insrch").modal("hide")})}$(".insrch-create-btn").off().click(function(){y(e,r)})},e.exports.renderIndexCreate=y,e.exports.renderAll=function(){m(),b(),a()},e.exports.renderInstructions=function(){$(".instructions-frame").show(),s.unbindEvents()},e.exports.renderInstructionsHide=function(){$(".instructions-frame").hide(),s.bindEvents()}},function(e,r,t){const n=t(0),i=function(e){return void 0===e&&(e=n.ri),"record"==n.r[e].type?n.dm.r[n.r[e].ri]:"base"==n.r[e].type?n.dm.b[n.r[e].bi]:"search"==n.r[e].type&&n.dm.b[n.r[e].bi]},o=function(e,r){const t=function(e,t,n){let i=$.trim(e).split("=");return r[i[0]]?1==i.length?r[i[0]]?o(t,r):o(n,r):i.length>1?r[i[0]]==i[1]?o(t,r):o(n,r):"#BAD CONDITION (else)#":o(n,r)};let n,i,d,l,s,a,f,c,u="";for(n=0;n<e.length;n++)if("#"===e[n])if(n+=1,"IF"===e.slice(n,n+2)){if("("!=e[n+=2]){u+="#BAD CONDITIONAL! (no opening parentheses)#",n-=1;continue}for(i=n+1;i<e.length&&")"!=e[i];)i+=1;if(i===e.length){u+="#BAD CONDITIONAL! (no closing parentheses)#",n-=1;continue}if(s=e.slice(n+1,i),"{"!=e[n=i+1])u+="#BAD CONDITIONAL! (no opening brackets for true)#",n-=1;else{for(d=n+=1,a=0;d<e.length&&("}"!=e[d]||a>0);)"#"==e[d]&&(a+=1),"}"==e[d]&&"{"!=e[d+1]&&(a-=1),d+=1;if(d===e.length){u+="#BAD CONDITIONAL! (no closing brackets for true)#",n-=1;continue}if(f=e.slice(n,d),"{"===e[n=d+1]){for(l=n+=1,a=0;l<e.length&&("}"!=e[l]||a>0);)"#"==e[l]&&(a+=1),"}"==e[l]&&"{"!=e[l+1]&&(a-=1),l+=1;c=e.slice(n,l),n=l+1}else c="";n-=1,u+=t(s,f,c)}}else if("{"===e[n]){for(i=n+=1;i<e.length&&"}"!=e[i];)i+=1;if(i===e.length){u+="#BAD FIELD#",n-=1;continue}r[e.slice(n,i)]?u+=r[e.slice(n,i)]:u+="#BAD FIELD#",n=i}else u+="#";else u+=e[n];return u};e.exports.convRecSA=function(e,r,t){const i=function(t){let i="record"===e?n.dm.r[r].fields:n.dm.b[r].fields,o={};for(let e in t)for(let r in i)i[r].sfname===e&&(o[r]=t[e]);return o};let o=[];if(Array.isArray(t))for(let e=0;e<t.length;e++)o.push(i(t[e]));return o},e.exports.getFieldsForLayout=function(e){let r={},t=i(e);for(let i in n.r[e].f)"index"===t.fields[i].type&&n.r[e].f[i].showval?r[i]=n.r[e].f[i].showval:r[i]=n.r[e].f[i].value;return r},e.exports.getBorR=i,e.exports.getFm=function(e,r){return null==r&&(e=n.ri,r=n.fi),"record"==n.r[e].type?n.dm.r[n.r[e].ri].fields[r]:"base"==n.r[e].type?n.dm.b[n.r[e].bi].fields[r]:"search"==n.r[e].type&&n.dm.b[n.r[e].bi].fields[r]},e.exports.parseLayout=o},function(e,r,t){const n=t(0),o=t(2),d=t(4),l=t(1),s=function(e){return!!n.r[e].new},a=function(e){o.getBorR(e);if(n.r[e].new||!n.r[e].f.Id){for(let r in n.r[e].f)if(n.r[e].f[r].changed)return!0;return!1}for(let r in n.r[e].f)if(n.r[e].f[r].changed&&n.r[e].f[r].value!=n.r[e].f[r].origval)return!0;return!1},f=function(e){return!(e<0||e>=n.dm.r.length&&"record"==n.r[n.ri].type)&&(y(e),s(n.ri)&&!a(n.ri)?n.r.splice(n.ri,1):n.ri+=1,n.fi=n.r[n.ri].order[0],!0)},c=function(){return s(n.ri)&&!a(n.ri)?n.r.splice(n.ri,1):n.ri+=1,n.fi=n.r[n.ri].order[0],!0},u=function(){if(n.ri===n.r.length-1){if(n.ri>=n.dm.b.length)return!s(n.ri)||s(n.ri)&&a(n.ri)?f(n.r[n.ri].ri):n.r[n.ri].ri<n.dm.r.length-1&&f(n.r[n.ri].ri+1);if(n.ri<n.dm.b.length-1)return!1;if(n.ri===n.dm.b.length-1)return!s(n.ri)&&f(0)}else if(n.ri<n.r.length-1)return n.r[n.ri+1].ri===n.r[n.ri].ri||"base"===n.r[n.ri].type?c():!s(n.ri)||s(n.ri)&&a(n.ri)?f(n.r[n.ri].ri):n.r[n.ri+1].ri===n.r[n.ri].ri+1?c():f(n.r[n.ri].ri+1);return!1},p=function(e){return!(e<0||e>=n.dm.r.length)&&(y(e),s(n.ri+1)&&!a(n.ri+1)&&n.r.splice(n.ri+1,1),n.fi=n.r[n.ri].order[0],!0)},h=function(){return s(n.ri)&&!a(n.ri)&&"record"===n.r[n.ri].type&&n.r.splice(n.ri,1),n.ri-=1,n.fi=n.r[n.ri].order[0],!0},m=function(){return 0!==n.ri&&(n.ri<n.dm.b.length?h():0===n.r[n.ri].ri||n.r[n.ri-1].ri===n.r[n.ri].ri||s(n.ri-1)&&!a(n.ri-1)?h():p(n.r[n.ri].ri-1),!0)},v=function(e){null==e&&(e=n.ri);let r,t=function(e,r){let n=[];for(let i=0;i<e.length;i++)if(n.push(e[i].field),e[i].autofill&&!r[e[i].field].origval&&"filled"===e[i].autofill.condition&&(r[e[i].autofill.conditionfield].value&&e[i].autofill.true?r[e[i].field].value=e[i].autofill.true:!r[e[i].autofill.conditionfield].value&&e[i].autofill.false&&(r[e[i].field].value=e[i].autofill.false)),e[i].condition)if("filled"===e[i].condition)r[e[i].field].value&&e[i].true?n=n.concat(t(e[i].true,r)):!r[e[i].field].value&&e[i].false&&(n=n.concat(t(e[i].false,r)));else if("switch"===e[i].condition)for(let o=0;o<e[i].switch.length;o++)for(let d=0;d<e[i].switch[o].value.length;d++)if(r[e[i].field].value==e[i].switch[o].value[d]){n=n.concat(t(e[i].switch[o].order,r));break}return n},i=n.r[e];"base"===i.type?(r=n.dm.b[i.bi],orderm=r.settings.order):"search"===i.type?(r=n.dm.b[i.bi],orderm=r.settings.searchorder):"record"===i.type&&(r=n.dm.r[i.ri],orderm=r.settings.order),i.order=t(orderm,n.r[e].f)},b=function(){for(let e=0;e<n.dm.b.length;e++){n.r.push({type:"search",bi:e,new:!0,order:[],f:{}});for(let r in n.dm.b[e].fields)n.r[e].f[r]={sfname:n.dm.b[e].fields[r].sfname},n.dm.b[e].fields[r].value?n.r[e].f[r].value=n.dm.b[e].fields[r].value:(n.r[e].f[r].value=null,n.r[e].f[r].origval=null);v(e)}n.ri=0,n.fi=n.r[n.ri].order[0]},y=function(e,r){let t=n.dm.b.length;for(;t<n.r.length;)if(r){if(!(n.r[t].ri<=e)||n.r[t].ri===e&&n.r[t].f.Id.value===r.Id)break;t++}else{if(!(n.r[t].ri<=e))break;t+=1}t===n.r.length?n.r.push({type:"record",ri:e,order:[],f:{}}):n.r[t].ri===e&&n.r[t].f.Id.value===r.Id?n.r.splice(t,1,{type:"record",ri:e,order:[],f:{}}):n.r.splice(t,0,{type:"record",ri:e,order:[],f:{}}),n.r[t].new=!r;for(let i in n.dm.r[e].fields)n.r[t].f[i]={},n.r[t].f[i].sfname=n.dm.r[e].fields[i].sfname,n.r[t].new?n.dm.r[e].fields[i].inherits?n.r[t].f[i].value=n.r[n.dm.r[e].fields[i].inherits.base].f[n.dm.r[e].fields[i].inherits.field].value:n.dm.r[e].fields[i].autofill?n.r[t].f[i].value=n.r[n.dm.r[e].fields[i].autofill.base].f[n.dm.r[e].fields[i].autofill.field].value:n.dm.r[e].fields[i].value?n.r[t].f[i].value=n.dm.r[e].fields[i].value:n.dm.r[e].fields[i].default?n.r[t].f[i].value=n.dm.r[e].fields[i].default:n.r[t].f[i].value=null:(n.r[t].f[i].value=r[n.dm.r[e].fields[i].sfname],n.r[t].f[i].origval=r[n.dm.r[e].fields[i].sfname]);return v(t),!0};e.exports.initR=function(){n.r=[],n.ri=0,b(),n.search=!0,n.sdata={empty:!0},n.fi=n.r[n.ri].order[0],l.renderSfView(),l.renderFldEntry()},e.exports.orderR=function(){const e=function(e,r){e&&r&&e!==r&&n.r.splice(r,0,n.r.splice(e,1)[0])};for(let o=0;o<n.dm.r.length;o++){let d=0,l=[];const s=n.dm.r[o],a=s.settings.listorder;for(let e=0;e<a.length;e++)l.push(s.fields[a[e].field]);for(d=n.dm.b.length;d<n.r.length&&n.r[d].ri<o;d++);if(d==n.r.length-1)break;for(let s=a.length-1;s>=0;s--){const f=l[s].type;for(let c=d;c<n.r.length&&n.r[c].ri===o;c++){if("index"===f)if(n.r[c].f[a[s].field].showval)var r=n.r[c].f[a[s].field].showval;else r="";else r=n.r[c].f[a[s].field].value;for(let o=c-1;o>=d;o--){if("index"===f){var t=l[s].indexfields[l[s].indexshow].type;if(n.r[o].f[a[s].field].showval)var i=n.r[o].f[a[s].field].showval;else i=""}else t=f,i=n.r[o].f[a[s].field].value;if(null==r||""===r){if(null==i||""===i){e(c,o+1);break}if(a[s].empty){if("last"==a[s].empty)break;if("first"==a[s].empty){if(o==d){e(c,o);break}continue}break}break}if(null!=i&&null!=i&&""!=i){if("date"===t&&(r=new Date(r).getTime(),i=new Date(i).getTime()),r===i){e(c,o+1);break}if(r>i){if("asc"===a[s].order){e(c,o+1);break}if(o===d){e(c,o);break}}else if(r<i){if("desc"===a[s].order){e(c,o+1);break}if(o==d){e(c,o);break}}}else if(a[s].empty){if("last"==a[s].empty)continue;if("first"==a[s].empty){e(c,o+1);break}e(c,o+1);break}}}}}},e.exports.isNew=s,e.exports.isChanged=a,e.exports.allUnchanged=function(){for(let e in n.r)if(a(e))return!1;return!0},e.exports.basesUpToDate=function(){for(let e in n.dm.b)if(a(e))return!1;return!0},e.exports.setValue=function(e,r,t){let i;switch(o.getFm(e,r).type){case"text":case"picklist":case"index":case void 0:i=t;break;case"date":{if(""==t||" "==t){i=null;break}const e=t.split(" ");let r;if(1==e.length?r=t<9999&&t>1e3?new Date("Jan. 1, "+t):new Date(t):2==e.length?"SPRING"==e[0].toUpperCase()?r=new Date("May 30, "+e[1]):"SUMMER"==e[0].toUpperCase()?r=new Date("July 15, "+e[1]):"FALL"==e[0].toUpperCase()?r=new Date("September 1, "+e[1]):"WINTER"==e[0].toUpperCase()&&(r=new Date("December 15, "+e[1])):r=new Date(t),!r||isNaN(r.getTime()))return l.renderError("Not a valid date!"),!1;i=r.toISOString();break}case"email":if(!/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t))return l.renderError("Not a valid email address!"),!1;i=t;break;default:i=t}return n.r[e].f[r].value=i,n.r[e].f[r].changed=!0,v(e),!0},e.exports.validateSelection=function(e){e=e.trim();const r=$(".fldinput"),t=o.getFm().type;let n=!0;if("INPUT"===r.prop("nodeName")?"text"===r.attr("type")&&(e.indexOf("\n")>-1&&(n=!1),e.length>r.attr("size")&&(n=!1)):"SELECT"===r.prop("nodeName")&&(n=!1,$(".fldinput option").each(function(){this.value==e&&(n=!0)})),"phone"===t)e.length>20&&(n=!1),/[\&\@\$\%\^\{\}]/.test(e)&&(n=!1),/\d/.test(e)||(n=!1);else if("date"===t)e.length>19&&(n=!1);else if("email"===t)/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)||(n=!1);else if("url"===t){const r=/\.+/;/[\s\"]+/.test(e)&&(n=!1),r.test(e)||(n=!1)}return n},e.exports.nextrAndAdd=f,e.exports.nextrNoAdd=c,e.exports.nextr=u,e.exports.prevrAndAdd=p,e.exports.prevrNoAdd=h,e.exports.prevr=m,e.exports.nextf=function(){if(n.fi===n.r[n.ri].order[n.r[n.ri].order.length-1])return u();for(var e=0;e<n.r[n.ri].order.length;e++)if(n.fi===n.r[n.ri].order[e]){n.fi=n.r[n.ri].order[e+1];break}return!0},e.exports.prevf=function(){if(n.fi===n.r[n.ri].order[0])return!!m()&&(n.fi=n.r[n.ri].order[n.r[n.ri].order.length-1],!0);for(var e=0;e<n.r[n.ri].order.length;e++)if(n.fi===n.r[n.ri].order[e]){n.fi=n.r[n.ri].order[e-1];break}return!0},e.exports.jumpTo=function(e){return!!n.r[e]&&(n.ri=e,n.fi=n.r[e].order[0],!0)},e.exports.setOrder=v,e.exports.addSearchRecords=b,e.exports.addBaseRecord=function(e,r){for(let t=0;t<n.r.length;t++)if(n.r[t].bi==e){n.r.splice(t,1,{type:"base",bi:t,new:!1,order:[],f:{}});for(let e in n.dm.b[t].fields)n.r[t].f[e]={sfname:n.dm.b[t].fields[e].sfname},r?(n.r[t].f[e].value=r[n.dm.b[t].fields[e].sfname],n.r[t].f[e].origval=r[n.dm.b[t].fields[e].sfname]):n.dm.b[t].fields[e].value?n.r[t].f[e].value=n.dm.b[t].fields[e].value:(n.r[t].f[e].value=null,n.r[t].f[e].origval=null);v(t);for(let e=0;e<n.r.length;e++)if("search"===n.r[e].type)return n.ri=e,n.fi=n.r[e].order[0],!0;return n.search&&(d.clearBaseSearch(),n.fi=n.r[t].order[0],d.loadAllRecords()),!0}return!1},e.exports.addRecord=y,e.exports.updateIndexFields=function(e,r){if(!e||"function"!=typeof e)return!1;l.renderLoadingStart("Looking up index fields");let t=0,d=0;if(void 0!==r&&r<n.r.length){let o=rf.getBorR(r);for(let e in n.r[r].f)"index"===o.fields[e].type&&n.r[r].f[e].value&&(d+=1);if(0===d)return l.renderLoadingEnd(),void e();for(let e in n.r[r].f)if("index"===o.fields[e].type&&n.r[r].f[e].value){let r,s={};s[o.fields[e].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:o.fields[e].indexto,conditions:{Id:n.r[i].f[e].value},fields:s}),success:s=>{t+=1,s[0]&&(n.r[i].f[e].showval=s[0][o.fields[e].indexshow]),t===d&&(l.renderLoadingEnd(),r())}})}return!0}d=0,t=0;for(let e in n.r){let r=o.getBorR(e);for(let t in n.r[e].f)"index"==r.fields[t].type&&n.r[e].f[t].value&&(d+=1)}if(0===d)return l.renderLoadingEnd(),void e();for(let r in n.r){let i=o.getBorR(r);for(let o in n.r[r].f)if("index"==i.fields[o].type&&n.r[r].f[o].value){let s={};s[i.fields[o].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:i.fields[o].indexto,conditions:{Id:n.r[r].f[o].value},fields:s}),success:s=>{t+=1,s[0]&&(n.r[r].f[o].showval=s[0][i.fields[o].indexshow]),t===d&&(l.renderLoadingEnd(),e())}})}}},e.exports.updateR=function(){return fm=o.getFm(),!(!(n.r[n.ri].f[n.fi].origval&&n.r[n.ri].f[n.fi].value==n.r[n.ri].f[n.fi].origval||"search"!==n.r[n.ri].type)&&n.r[n.ri].new)||d.searchBase(n.ri)}},function(e,r,t){const n=t(0),i=t(2),o=t(3),d=t(1),l=function(e){let r={};for(let t in n.sdata.records)n.sdata.records[t].Id===e&&(r=n.sdata.records[t]);if(!r.Id)return!1;o.addBaseRecord(n.sdata.i,r)};e.exports.searchBase=function(e){if("search"!=n.r[e].type)return!1;const r=i.getBorR(e);let t={};t.sobject=r.sobject,t.conditions={},t.fields={};for(let e in r.fields)t.fields[r.fields[e].sfname]=1;for(let i=0;i<r.settings.searchorder.length;i++){let o=r.settings.searchorder[i].field;n.r[e].f[o].value&&("text"==r.fields[o].type?t.conditions[r.fields[o].sfname]={$like:"%"+n.r[e].f[o].value.replace(/\s+/g,"%")+"%"}:t.conditions[r.fields[o].sfname]=n.r[e].f[o].value)}d.renderLoadingStart("Searching for "+r.appname),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(t),success:function(o){n.search=!0,n.sdata={type:"base",layout:r.settings.searchlayout,sobject:t.sobject,i:n.r[e].bi,records:i.convRecSA("base",n.r[e].bi,o)},$(document).on("searchSelect",function(e){if(!e)return!1;e.Id&&l(e.Id)}),d.renderLoadingEnd(),d.renderSfView()}})},e.exports.clearBaseSearch=function(){n.search=!1,n.sdata={empty:!0},d.renderSfView()},e.exports.searchIndexRecord=function(e,r){var t=i.getBorR(e),o=t.fields[r];if("index"!=o.type)return!1;var l={sobject:o.indexto,conditions:{},fields:{Id:1}};for(var s in l.conditions[o.indexshow]={$like:"%"+n.r[e].f[r].showval.replace(/\s\s+/g,"%")+"%"},o.indexfields)l.fields[s]=1;d.renderLoadingStart("Searching for "+t.fields[r].indexto),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(l),success:function(t){return d.renderLoadingEnd(),d.renderIndexSearch(e,r,t)}})},e.exports.loadAllRecords=function(e){d.renderLoadingStart("Loading all records");let r=0;if(n.r.length>n.dm.b.length){let e=n.r.length;for(let r=n.dm.b.length;r<e;r++)n.r.pop()}for(let t=0;t<n.dm.b.length;t++){if(!n.r[t].f.Id.value)continue;let i={sobject:n.dm.b[t].sobject,conditions:{},fields:{}};i.conditions.Id=n.r[t].f.Id.value;for(let e in n.dm.b[t].fields)i.fields[n.dm.b[t].fields[e].sfname]=1,n.dm.b[t].fields[e].value&&(i.conditions[n.dm.b[t].fields[e].sfname]=n.dm.b[t].fields[e].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(i),success:function(i){if(r+=1,i)for(let e in i)o.addBaseRecord(t,i[e]);r===n.dm.b.length+n.dm.r.length&&(o.orderR(),o.updateIndexFields(()=>{d.renderFldEntry(),d.renderSfView(),e&&"function"==typeof e&&e()}))}})}let t=n.dm.r.length;for(let i=0;i<t;i++){let t={sobject:n.dm.r[i].sobject,conditions:{},fields:{}};for(let e in n.dm.r[i].fields)if(t.fields[n.dm.r[i].fields[e].sfname]=1,n.dm.r[i].fields[e].value)t.conditions[n.dm.r[i].fields[e].sfname]=n.dm.r[i].fields[e].value;else if(n.dm.r[i].fields[e].inherits)for(let r in n.r)n.r[r].bi==n.dm.r[i].fields[e].inherits.base&&(t.conditions[n.dm.r[i].fields[e].sfname]=n.r[r].f[n.dm.r[i].fields[e].inherits.field].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(t),success:function(t){if(r+=1,t)for(let e in t)o.addRecord(i,t[e]);return r===n.dm.b.length+n.dm.r.length&&(o.orderR(),o.updateIndexFields(()=>{d.renderFldEntry(),d.renderSfView(),e&&"function"==typeof e&&e()})),!0}})}},e.exports.indexSearchSelected=function(e,r,t){if(!t.Id)return!1;o.setValue(e,r,t.Id);const l=i.getFm(e,r);return!!t[l.indexshow]&&(n.r[e].f[r].showval=t[l.indexshow],o.nextf(),d.renderFldEntry(),!0)},e.exports.baseSearchSelected=l,e.exports.recordSearchSelected=function(e){let r={};for(let t in n.sdata.records)n.sdata.records[t].Id===e&&(r=n.sdata.records[t]);if(!r.Id)return!1;o.addRecord(n.sdata.i,record),d.renderSfView(),d.renderFldEntry()}},function(e,t,n){const i=n(0),o=n(8),d=n(3),l=n(1);e.exports.bindEvents=function(){i.$initentry.off().click(function(){d.allUnchanged()?(d.initR(),l.renderSfView(),l.renderFldEntry()):l.renderAlert("Initiating data entry will end your current session, erasing any unsaved data. Are you sure you wish to continue?",()=>{d.initR(),l.renderSfView(),l.renderFldEntry()})}),i.$addoc.off().change(function(){const e=new FormData;return e.append("file",i.$addoc[0].files[0]),i.$addoc.val(null),o.addDoc(e)}),i.$loadsample.off().click(function(){l.renderDoc("/pdfviewer/web/viewer.html?file=/doc/SampleRoster.pdf"),(r=[])&&(d.initR(),l.renderSfView(),l.renderFldEntry())}),i.$removedoc.off().click(function(){d.allUnchanged()?o.removeDoc(function(){d.initR(),l.renderAll()}):l.renderAlert("Removing document now will erase all unsaved changes.",()=>{o.removeDoc(function(){d.initR(),l.renderAll()})})}),i.$instr.off().click(function(){l.renderInstructions()}),$(document).off("keydown").keydown(e=>{let r=$(".fldinput");if($("select").is(":focus")||$("input").is(":focus")||$("textarea").is(":focus"))13===e.which&&r&&r.change();else{if(39===e.which){if(!d.nextf())return}else if(37===e.which){if(!d.prevf())return}else if(40===e.which){if(!d.nextr())return}else if(38===e.which){if(!d.prevr())return}else if(32!==e.which)return;if(l.renderFldEntry(),l.renderSfView(),32===e.which){e.preventDefault();let r=$(".fldinput");r&&r.focus()}}})},e.exports.unbindEvents=function(){i.$initentry.off(),i.$addoc.off(),i.$loadsample.off(),i.$removedoc.off(),i.$instr.off(),$(document).off("keydown")}},function(e,r,t){const n=t(0),i=t(1),o=t(5);n.$addoc=$("#adddoc"),n.$loadsample=$("#loadsample"),n.$removedoc=$("#removedoc"),n.$initentry=$("#initentry"),n.$instr=$("#instr-button"),$.getJSON("/api/dm",function(e){e.b&&e.r?(n.dm=e,o.bindEvents(),$(".instructions-frame").click(i.renderInstructionsHide),$(".close-button").click(i.renderInstructionsHide),$(".instructions").off().click(e=>{e.stopPropagation()}),$(".modal").on("hidden.bs.modal",function(){o.bindEvents()}),$(".modal").on("shown.bs.modal",function(){$(".fldwin").attr("tabindex",-1).focus(),o.unbindEvents()})):i.renderError("Can't access server!")})},function(e,r,t){const n=t(0),i=t(2),o=t(3),d=t(1),l=t(4),s=function(e,r){if(!o.isChanged(e))return!1;let t=i.getBorR(e),l=n.r[e];if(l.new&&!l.f.Id.value){let n={sobject:t.sobject,records:[{}]};for(let e in l.f)l.f[e].value&&"Id"!=l.f[e].sfname&&!t.fields[e].noupdate&&(n.records[0][t.fields[e].sfname]=l.f[e].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(n),success:function(t){!1===t.success||t.err||r&&r(t,e)}})}else{if(l.new)return d.renderErr("Record is labelled new but has salesforce Id"),!1;{let e={sobject:t.sobject,records:[{}]};e.records[0].Id=l.f.Id.value;for(let r in l.f)l.f[r].value==l.f[r].origval||t.fields[r].noupdate||(e.records[0][t.fields[r].sfname]=l.f[r].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/update",dataType:"json",async:!0,data:JSON.stringify(e),success:function(e){!1===e.success||e.err||r&&r(e)}})}}return!0};e.exports.updateRecord=s,e.exports.updateAll=function(){if(o.allUnchanged())return d.renderError("Nothing to update!"),!1;var e=0,r=0;d.renderLoadingStart();for(let e=0;e<n.r.length;e++)o.isChanged(e)&&(r+=1);for(let t=0;t<n.r.length;t++)s(t,function(){(e+=1)===r&&(d.renderLoadingEnd(),l.loadAllRecords())});return!0}},function(e,r,t){const n=t(1);e.exports.addDoc=function(e,r){return n.renderLoadingStart("Loading document"),!!e&&!!e.get("file")&&($.ajax({url:"/doc/load",type:"POST",data:e,success:function(e){if(n.renderLoadingEnd(),e.err||!e.iframeurl)return n.renderError(e.err),!1;n.renderDoc(e.iframeurl)},cache:!1,contentType:!1,processData:!1}),!0)},e.exports.removeDoc=function(e){n.renderLoadingStart("Removing Document"),$.getJSON("/doc/remove",function(r){n.renderLoadingEnd(),e?e():n.renderDoc()})}}]);