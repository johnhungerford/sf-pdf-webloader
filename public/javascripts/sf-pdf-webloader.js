!function(e){var r={};function n(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)n.d(t,i,function(r){return e[r]}.bind(null,i));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=6)}([function(e,r){e.exports.dm={},e.exports.r=[],e.exports.ri=0,e.exports.fi=null,e.exports.search=!0,e.exports.sdata={empty:!0},e.exports.init=!0,e.exports.mdownpos=[],e.exports.$addoc=$("#adddoc"),e.exports.$loadsample=$("#loadsample"),e.exports.$removedoc=$("#removedoc"),e.exports.$initentry=$("#initentry"),e.exports.$instr=$("#instr-button")},function(e,r,n){var t=n(0),i=n(2),o=n(4),d=n(3),a=n(7),f=n(5),s=function(e){$(".pdfwin").empty(),void 0===e?$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="/doc/view"></iframe>'):$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="'+e+'"></iframe>'),$("#pdfiframe").on("load",function(){$("#pdfiframe").contents().find("body").off().mouseup(function(e){var r=document.getElementById("pdfiframe").contentDocument.getSelection(),n=r.toString();if(n){if(mdownpos===[]&&(mdownpos=[e.pageX,e.pageY]),!d.validateSelection(n))return l(r),r.collapseToStart(),void $(".fldwin").attr("tabindex",-1).focus();$(".fldinput").val(n),$(".fldinput").change(),r.collapseToStart(),$(".fldwin").attr("tabindex",-1).focus(),mdownpos=[]}}),$("#pdfiframe").contents().find("body").mousedown(function(e){mdownpos=[e.pageX,e.pageY],$("#selecpopup").remove()})})},l=function(e){var r=i.getFm().appname,n=$(".mainwin"),t=$(".pdfwin");n.append('<div id="selecpopup" style="position:absolute;display:none;z-index:100;background-color:yellow;"><b>Invalid selection for field: "'+r+'"</b></div>');$("#selecpopup");$("#selecpopup").offset({top:t.position().top+mdownpos[1]-45,left:t.position().left+mdownpos[0]-100}).show(),setTimeout(function(){$("#selecpopup").fadeOut("slow",function(){$("#selecpopup").remove()})},2e3)},c=function(e){$(".error-body").empty(),$(".error-body").append(e),$(".error").modal("show")},u=function(e){$(".ld-msg").empty(),$(".ld-msg").append(e),$(".loading").modal("show"),setTimeout(function(){p()},1e4)},p=function(){setTimeout(function(){$(".loading").modal("hide")},200),$(".ld-msg").empty()},v=function(){var e=i.getBorR(),r=t.ri;t.fi;if($(".sfviewmenu").empty(),"search"==t.r[t.ri].type){if($(".sfviewmenu").append('<button type="button" class="btn btn-primary newbase-button">New</button'),$(".newbase-button").off().click(function(){t.r[r].type="base",d.setOrder(r),t.fi=t.r[r].order[0],y(),m()}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Find or Create "+e.appname+" ("+e.sobject+")</h4>"),t.sdata.empty)return!1;for(var n=function(e){for(s in $(".sfviewbody").append('<div class="search-result" data-id="'+t.sdata.records[e].Id+'" id="sresult'+e+'"></div>'),t.sdata.layout)$("#sresult"+e).append("<div>"+i.parseLayout(t.sdata.layout[s],t.sdata.records[e])+"</div>");$("#sresult"+e).off().click(function(){$.event.trigger({type:"searchSelect",Id:t.sdata.records[e].Id})})},f=0;f<t.sdata.records.length;f++){var s;n(f)}}else $(".sfviewmenu").append('<button type="button" class="btn btn-primary createbase-button">Add to Salesforce</button'),$(".createbase-button").off().click(function(){u(),a.updateRecord(r,function(e,r){p(),e[0]&&e[0].id&&(d.setValue(r,"Id",e[0].id),t.r[r].new=!1,o.loadAllRecords())})}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Add "+e.appname+" ("+e.sobject+") to Salesforce</h4>")},m=function e(){if(t.search)return v();t.ri>=t.r.length&&(t.ri=t.r.length-1),t.ri<0&&(t.ri=0),$(".sfviewmenu").empty(),$(".sfviewmenu").append('<button type="button" class="btn btn-primary saveall-button" style="margin-right:5px;">Save All</button'),$(".saveall-button").off().click(function(){a.updateAll()}),$(".sfviewmenu").append('<button type="button" class="btn btn-primary refresh-button">Refresh</button'),$(".refresh-button").off().click(function(){o.loadAllRecords()}),$(".sfviewbody").empty();for(var r=function(r){for($(".sfviewbody").append('<div class="sfview-header sfview-base-box" id="sfview-hdr-b-'+r+'"></div>'),$("#sfview-hdr-b-"+r).append("<h4>"+t.dm.b[r].appname+"</h4>"),f=0;f<t.dm.b[r].settings.layout.length;f++)$("#sfview-hdr-b-"+r).append("<div>"+i.parseLayout(t.dm.b[r].settings.layout[f],i.getFieldsForLayout(r))+"</div>");$("#sfview-hdr-b-"+r).attr("style","cursor:pointer"),$("#sfview-hdr-b-"+r).off().click(function(){d.jumpTo(r),y(),e()}),t.ri==r&&$("#sfview-hdr-b-"+r).attr("style","border:2px solid red;")},n=0;n<t.dm.b.length;n++){var f;r(n)}for(n=0;n<t.dm.r.length;n++)$(".sfviewbody").append('<div class="sfview-header" id="sfview-hdr-r-'+n+'"></div>'),$("#sfview-hdr-r-"+n).append("<h4>"+t.dm.r[n].appname+"</h4>");for(var s=function(r){$("#sfview-hdr-r-"+t.r[r].ri).append('<div class="sfview-record" id="sfview-rec-'+r+'"></div>');for(var n=0;n<t.dm.r[t.r[r].ri].settings.layout.length;n++)$("#sfview-rec-"+r).append("<div>"+i.parseLayout(t.dm.r[t.r[r].ri].settings.layout[n],i.getFieldsForLayout(r))+"</div>");$("#sfview-rec-"+r).off().click(function(){d.jumpTo(r),y(),e()}),t.ri==r&&$("#sfview-rec-"+r).attr("style","border: 2px solid red;")},l=t.dm.b.length;l<t.r.length;l++)s(l);var c=$(".sfviewbody").scrollTop();if(t.ri<t.dm.b.length)var u=$("#sfview-hdr-b-"+t.ri);else u=$("#sfview-rec-"+t.ri);var p=u.offset().top-$(".sfviewbody").offset().top,m=p+u.height();m>$(".sfviewbody").innerHeight()?$(".sfviewbody").scrollTop(c+m-$(".sfviewbody").innerHeight()+5):p<0&&$(".sfviewbody").scrollTop(c+p)},h=function(e){var r=new Date(e);return["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."][r.getMonth()]+" "+r.getDate()+", "+r.getFullYear()},y=function e(){t.ri>=t.r.length&&(t.ri=t.r.length-1),t.ri<0&&(t.ri=0),$(".fldwinleft").empty(),0==t.ri&&t.fi==t.r[0].order[0]||($(".fldwinleft").append('<a class="btn btn-primary" href="#" id="prevlink"><</a>'),$("#prevlink").off().click(function(){d.updateR(),d.setOrder(),d.prevf(),e(),m()})),$(".fldwinright").empty(),(t.ri<t.r.length-1||t.fi!=t.r[t.r.length-1].order[t.r[t.r.length-1].order.length-1])&&($(".fldwinright").append('<a class="btn btn-primary" href="#" id="nextlink">></a>'),$("#nextlink").off().click(function(){d.updateR(),d.setOrder(),d.nextf(),e(),m()}));t.r[t.ri];var r=i.getBorR();switch($(".fldtitle").empty(),$(".fldtitle").append("<h4>"+r.fields[t.fi].appname+"</h4>"),$(".fldinstr").empty(),r.fields[t.fi].instructions&&$(".fldinstr").append("<p>"+r.fields[t.fi].instructions+"</p>"),$(".fldentry").empty(),r.fields[t.fi].type){case"text":if(r.fields[t.fi].length>260)var n='<textarea style="resize: none" rows="5" cols="45" ';else n='<input type="text" size="45" ';n+='class="fldinput" maxlength = "'+r.fields[t.fi].length+'" > ';break;case"phone":n='<input class="fldinput" type="text" size="45" maxlength="40">';break;case"url":n='<input class="fldinput" type="text" size="50">';break;case"email":n='<input class="fldinput" type="text" size="45" maxlength="'+r.fields[t.fi].length+'">';break;case"picklist":n='<select class="fldinput">';n+='<option value="">None</option>';for(var a=0;a<r.fields[t.fi].values.length;a++)n+="<option>"+r.fields[t.fi].values[a]+"</option>";n+="</select>";break;case"date":n='<input class="fldinput" type="text" maxlength="100">';break;case"index":n='<input class="fldinput" type="text" size="45" maxlength="255">';break;case"boolean":n='<input class="fldinput" type="checkbox" >'}$(".fldentry").append(n),t.r[t.ri].f[t.fi].value&&("index"==r.fields[t.fi].type?t.r[t.ri].f[t.fi].showval&&$(".fldinput").val(t.r[t.ri].f[t.fi].showval):"date"==r.fields[t.fi].type?$(".fldinput").val(h(t.r[t.ri].f[t.fi].value)):"boolean"==r.fields[t.fi].type?t.r[t.ri].f[t.fi].value?$(".fldinput").prop("checked",!0):$(".fldinput").prop("checked",!1):$(".fldinput").val(t.r[t.ri].f[t.fi].value));var f=t.ri,s=t.fi;r.fields[s].indexto;$(".fldinput").off().change(function(){if("index"==r.fields[s].type)return""==$(".fldinput").val()?(t.r[f].f[s].showval=null,t.r[f].f[s].value=null,d.updateR(),d.setOrder(),d.nextf(),e(),void m()):(t.r[f].f[s].showval=$(".fldinput").val(),void o.searchIndexRecord(f,s));"boolean"!=r.fields[s].type?d.setValue(f,s,$(".fldinput").val())&&(d.updateR(),d.setOrder(),d.nextf(),e(),m()):t.r[f].f[s].value=$(".fldinput").prop("checked")})},b=function(e,r){i.getBorR(e);var n=i.getFm(e,r);$(".increate-title").empty(),$(".increate-body").empty(),$(".increate-title").append("Create new "+n.appname+" record");var o={};o.sobject=n.indexto,o.record={};for(var a=0;a<n.createfields.length;a++)$(".increate-body").append('<div id="increate-fld-'+a+'"></div>'),$("#increate-fld-"+a).append('<h5 id="increate-fldtitle-'+a+'"></h5>'),$("#increate-fld-"+a).append('<input type="text" size="45" id="increate-fldinput-'+a+'">'),$("#increate-fldtitle-"+a).append(n.createfields[a]+":"),n.createfields[a]==n.indexshow&&$("#increate-fldinput-"+a).val($(".fldinput").val());$(".increate-create-btn").off().click(function(){for(var i={sobject:n.indexto,records:[{}]},o=0;o<n.createfields.length;o++)$("#increate-fldinput-"+o).val()&&(i.records[0][n.createfields[o]]=$("#increate-fldinput-"+o).val());for(var a in n.indexfields)n.indexfields[a].value&&(i.records[0][a]=n.indexfields[a].value);u("Creating "+n.appname+" record"),$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(i),success:function(o){if(p(),o[0].err||!o[0].success)return c("Could not create "+n.indexto+": "+o[0].err),!1;$(".increate").modal("hide"),d.setValue(e,r,o[0].id),t.r[e].f[r].showval=i.records[0][n.indexshow],y(),m()}})}),$(".increate").modal("show")};e.exports.renderDoc=s,e.exports.renderSelectionErr=l,e.exports.renderError=c,e.exports.renderAlert=function(e,r){$(".alert-body").empty(),$(".alert-body").append(e),$(".alert").modal("show"),$(".alert-execute").off().click(function(){$(".alert").modal("hide"),r&&r()})},e.exports.renderOpenUrl=function(){$(".openurl-input").val(""),$(".openurlmodal").modal("show"),$(".openurl-open-btn").off().click(function(){$(".openurlmodal").modal("hide"),s($(".openurl-input").val())})},e.exports.renderLoadingStart=u,e.exports.renderLoadingEnd=p,e.exports.renderBaseSearch=v,e.exports.renderSfView=m,e.exports.convertDate=h,e.exports.renderFldEntry=y,e.exports.renderIndexSearch=function(e,r,n){var t=i.getFm(e,r);$(".insrch-title").empty(),$(".insrch-body").empty(),$(".insrch-title").prepend("Searching for "+t.indexto),$(".insrch").modal("show");for(var o=function(o){$(".insrch-body").append('<div class="insresult" id="insresult'+o+'"></div>');for(var d=0;d<t.searchlayout.length;d++)$("#insresult"+o).append("<span>"+i.parseLayout(t.searchlayout[d],n[o])+"</span>");$("#insresult"+o).off().click(function(){indexSearchSelected(e,r,n[o]),$(".insrch").modal("hide")})},d=0;d<n.length;d++)o(d);$(".insrch-create-btn").off().click(function(){b(e,r)})},e.exports.renderIndexCreate=b,e.exports.renderAll=function(){m(),y(),s()},e.exports.renderInstructions=function(){$(".instructions-frame").show(),f.unbindEvents()},e.exports.renderInstructionsHide=function(){$(".instructions-frame").hide(),f.bindEvents()}},function(e,r,n){var t=n(0),i=function(e){return void 0===e&&(e=t.ri),"record"==t.r[e].type?t.dm.r[t.r[e].ri]:"base"==t.r[e].type?t.dm.b[t.r[e].bi]:"search"==t.r[e].type&&t.dm.b[t.r[e].bi]};e.exports.convRecSA=function(e,r,n){var i=function(n){var i="record"===e?t.dm.r[r].fields:t.dm.b[r].fields,o={};for(var d in n)for(var a in i)i[a].sfname===d&&(o[a]=n[d]);return o},o=[];if(Array.isArray(n))for(var d=0;d<n.length;d++)o.push(i(n[d]));return o},e.exports.getFieldsForLayout=function(e){var r={},n=i(e);for(var o in t.r[e].f)"index"===n.fields[o].type&&t.r[e].f[o].showval?r[o]=t.r[e].f[o].showval:r[o]=t.r[e].f[o].value;return r},e.exports.getBorR=i,e.exports.getFm=function(e,r){return null==r&&(e=t.ri,r=t.fi),"record"==t.r[e].type?t.dm.r[t.r[e].ri].fields[r]:"base"==t.r[e].type?t.dm.b[t.r[e].bi].fields[r]:"search"==t.r[e].type&&t.dm.b[t.r[e].bi].fields[r]},e.exports.parseLayout=function e(r,n){var t,i,o,d,a,f,s,l,c=function(r,t,i){var o=$.trim(r).split("=");return n[o[0]]?1==o.length?n[o[0]]?e(t,n):e(i,n):o.length>1?n[o[0]]==o[1]?e(t,n):e(i,n):"#BAD CONDITION (else)#":e(i,n)},u="";for(t=0;t<r.length;t++)if("#"===r[t])if(t+=1,"IF"===r.slice(t,t+2)){if("("!=r[t+=2]){u+="#BAD CONDITIONAL! (no opening parentheses)#",t-=1;continue}for(i=t+1;i<r.length&&")"!=r[i];)i+=1;if(i===r.length){u+="#BAD CONDITIONAL! (no closing parentheses)#",t-=1;continue}if(a=r.slice(t+1,i),"{"!=r[t=i+1])u+="#BAD CONDITIONAL! (no opening brackets for true)#",t-=1;else{for(o=t+=1,f=0;o<r.length&&("}"!=r[o]||f>0);)"#"==r[o]&&(f+=1),"}"==r[o]&&"{"!=r[o+1]&&(f-=1),o+=1;if(o===r.length){u+="#BAD CONDITIONAL! (no closing brackets for true)#",t-=1;continue}if(s=r.slice(t,o),"{"===r[t=o+1]){for(d=t+=1,f=0;d<r.length&&("}"!=r[d]||f>0);)"#"==r[d]&&(f+=1),"}"==r[d]&&"{"!=r[d+1]&&(f-=1),d+=1;l=r.slice(t,d),t=d+1}else l="";t-=1,u+=c(a,s,l)}}else if("{"===r[t]){for(i=t+=1;i<r.length&&"}"!=r[i];)i+=1;if(i===r.length){u+="#BAD FIELD#",t-=1;continue}n[r.slice(t,i)]?u+=n[r.slice(t,i)]:u+="#BAD FIELD#",t=i}else u+="#";else u+=r[t];return u}},function(e,r,n){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(0),d=n(2),a=n(4),f=n(1),s=function(e){return!!o.r[e].new},l=function(e){d.getBorR(e);if(o.r[e].new||!o.r[e].f.Id){for(var r in o.r[e].f)if(o.r[e].f[r].changed)return!0;return!1}for(var n in o.r[e].f)if(o.r[e].f[n].changed&&o.r[e].f[n].value!=o.r[e].f[n].origval)return!0;return!1},c=function(e){return!(e<0||e>=o.dm.r.length&&"record"==o.r[o.ri].type)&&(g(e),s(o.ri)&&!l(o.ri)?o.r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0)},u=function(){return s(o.ri)&&!l(o.ri)?o.r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0},p=function(){if(o.ri===o.r.length-1){if(o.ri>=o.dm.b.length)return!s(o.ri)||s(o.ri)&&l(o.ri)?c(o.r[o.ri].ri):o.r[o.ri].ri<o.dm.r.length-1&&c(o.r[o.ri].ri+1);if(o.ri<o.dm.b.length-1)return!1;if(o.ri===o.dm.b.length-1)return!s(o.ri)&&c(0)}else if(o.ri<o.r.length-1)return o.r[o.ri+1].ri===o.r[o.ri].ri||"base"===o.r[o.ri].type?u():!s(o.ri)||s(o.ri)&&l(o.ri)?c(o.r[o.ri].ri):o.r[o.ri+1].ri===o.r[o.ri].ri+1?u():c(o.r[o.ri].ri+1);return!1},v=function(e){return!(e<0||e>=o.dm.r.length)&&(g(e),s(o.ri+1)&&!l(o.ri+1)&&o.r.splice(o.ri+1,1),o.fi=o.r[o.ri].order[0],!0)},m=function(){return s(o.ri)&&!l(o.ri)&&"record"===o.r[o.ri].type&&o.r.splice(o.ri,1),o.ri-=1,o.fi=o.r[o.ri].order[0],!0},h=function(){return 0!==o.ri&&(o.ri<o.dm.b.length?m():0===o.r[o.ri].ri||o.r[o.ri-1].ri===o.r[o.ri].ri||s(o.ri-1)&&!l(o.ri-1)?m():v(o.r[o.ri].ri-1),!0)},y=function(e){null==e&&(e=o.ri);var r,n=o.r[e];"base"===n.type?(r=o.dm.b[n.bi],orderm=r.settings.order):"search"===n.type?(r=o.dm.b[n.bi],orderm=r.settings.searchorder):"record"===n.type&&(r=o.dm.r[n.ri],orderm=r.settings.order),n.order=function e(r,n){for(var t=[],i=0;i<r.length;i++)if(t.push(r[i].field),r[i].autofill&&!n[r[i].field].origval&&"filled"===r[i].autofill.condition&&(n[r[i].autofill.conditionfield].value&&r[i].autofill.true?n[r[i].field].value=r[i].autofill.true:!n[r[i].autofill.conditionfield].value&&r[i].autofill.false&&(n[r[i].field].value=r[i].autofill.false)),r[i].condition)if("filled"===r[i].condition)n[r[i].field].value&&r[i].true?t=t.concat(e(r[i].true,n)):!n[r[i].field].value&&r[i].false&&(t=t.concat(e(r[i].false,n)));else if("switch"===r[i].condition)for(var o=0;o<r[i].switch.length;o++)for(var d=0;d<r[i].switch[o].value.length;d++)if(n[r[i].field].value==r[i].switch[o].value[d]){t=t.concat(e(r[i].switch[o].order,n));break}return t}(orderm,o.r[e].f)},b=function(){for(var e=0;e<o.dm.b.length;e++){for(var r in o.r.push({type:"search",bi:e,new:!0,order:[],f:{}}),o.dm.b[e].fields)o.r[e].f[r]={sfname:o.dm.b[e].fields[r].sfname},o.dm.b[e].fields[r].value?o.r[e].f[r].value=o.dm.b[e].fields[r].value:(o.r[e].f[r].value=null,o.r[e].f[r].origval=null);y(e)}o.ri=0,o.fi=o.r[o.ri].order[0]},g=function(e,r){for(var n=o.dm.b.length;n<o.r.length;)if(r){if(!(o.r[n].ri<=e)||o.r[n].ri===e&&o.r[n].f.Id.value===r.Id)break;n++}else{if(!(o.r[n].ri<=e))break;n+=1}for(var t in n===o.r.length?o.r.push({type:"record",ri:e,order:[],f:{}}):o.r[n].ri===e&&o.r[n].f.Id.value===r.Id?o.r.splice(n,1,{type:"record",ri:e,order:[],f:{}}):o.r.splice(n,0,{type:"record",ri:e,order:[],f:{}}),o.r[n].new=!r,o.dm.r[e].fields)o.r[n].f[t]={},o.r[n].f[t].sfname=o.dm.r[e].fields[t].sfname,o.r[n].new?o.dm.r[e].fields[t].inherits?o.r[n].f[t].value=o.r[o.dm.r[e].fields[t].inherits.base].f[o.dm.r[e].fields[t].inherits.field].value:o.dm.r[e].fields[t].autofill?o.r[n].f[t].value=o.r[o.dm.r[e].fields[t].autofill.base].f[o.dm.r[e].fields[t].autofill.field].value:o.dm.r[e].fields[t].value?o.r[n].f[t].value=o.dm.r[e].fields[t].value:o.dm.r[e].fields[t].default?o.r[n].f[t].value=o.dm.r[e].fields[t].default:o.r[n].f[t].value=null:(o.r[n].f[t].value=r[o.dm.r[e].fields[t].sfname],o.r[n].f[t].origval=r[o.dm.r[e].fields[t].sfname]);return y(n),!0};e.exports.initR=function(){o.r=[],o.ri=0,b(),o.search=!0,o.sdata={empty:!0},o.fi=o.r[o.ri].order[0],f.renderSfView(),f.renderFldEntry()},e.exports.orderR=function(){for(var e=function(e,r){e&&r&&e!==r&&o.r.splice(r,0,o.r.splice(e,1)[0])},r=0;r<o.dm.r.length;r++){for(var n=0,t=[],i=o.dm.r[r],d=i.settings.listorder,a=0;a<d.length;a++)t.push(i.fields[d[a].field]);for(n=o.dm.b.length;n<o.r.length&&o.r[n].ri<r;n++);if(n==o.r.length-1)break;for(var f=d.length-1;f>=0;f--)for(var s=t[f].type,l=n;l<o.r.length&&o.r[l].ri===r;l++){if("index"===s)if(o.r[l].f[d[f].field].showval)var c=o.r[l].f[d[f].field].showval;else c="";else c=o.r[l].f[d[f].field].value;for(var u=l-1;u>=n;u--){if("index"===s){var p=t[f].indexfields[t[f].indexshow].type;if(o.r[u].f[d[f].field].showval)var v=o.r[u].f[d[f].field].showval;else v=""}else p=s,v=o.r[u].f[d[f].field].value;if(null==c||""===c){if(null==v||""===v){e(l,u+1);break}if(d[f].empty){if("last"==d[f].empty)break;if("first"==d[f].empty){if(u==n){e(l,u);break}continue}break}break}if(null!=v&&null!=v&&""!=v){if("date"===p&&(c=new Date(c).getTime(),v=new Date(v).getTime()),c===v){e(l,u+1);break}if(c>v){if("asc"===d[f].order){e(l,u+1);break}if(u===n){e(l,u);break}}else if(c<v){if("desc"===d[f].order){e(l,u+1);break}if(u==n){e(l,u);break}}}else if(d[f].empty){if("last"==d[f].empty)continue;if("first"==d[f].empty){e(l,u+1);break}e(l,u+1);break}}}}},e.exports.isNew=s,e.exports.isChanged=l,e.exports.allUnchanged=function(){for(var e in o.r)if(l(e))return!1;return!0},e.exports.basesUpToDate=function(){for(var e in o.dm.b)if(l(e))return!1;return!0},e.exports.setValue=function(e,r,n){var t;switch(d.getFm(e,r).type){case"text":case"picklist":case"index":case void 0:t=n;break;case"date":if(""==n||" "==n){t=null;break}var i,a=n.split(" ");if(1==a.length?i=n<9999&&n>1e3?new Date("Jan. 1, "+n):new Date(n):2==a.length?"SPRING"==a[0].toUpperCase()?i=new Date("May 30, "+a[1]):"SUMMER"==a[0].toUpperCase()?i=new Date("July 15, "+a[1]):"FALL"==a[0].toUpperCase()?i=new Date("September 1, "+a[1]):"WINTER"==a[0].toUpperCase()&&(i=new Date("December 15, "+a[1])):i=new Date(n),!i||isNaN(i.getTime()))return f.renderError("Not a valid date!"),!1;t=i.toISOString();break;case"email":if(!/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(n))return f.renderError("Not a valid email address!"),!1;t=n;break;default:t=n}return o.r[e].f[r].value=t,o.r[e].f[r].changed=!0,y(e),!0},e.exports.validateSelection=function(e){e=e.trim();var r=$(".fldinput"),n=d.getFm().type,t=!0;"INPUT"===r.prop("nodeName")?"text"===r.attr("type")&&(e.indexOf("\n")>-1&&(t=!1),e.length>r.attr("size")&&(t=!1)):"SELECT"===r.prop("nodeName")&&(t=!1,$(".fldinput option").each(function(){this.value==e&&(t=!0)})),"phone"===n?(e.length>20&&(t=!1),/[\&\@\$\%\^\{\}]/.test(e)&&(t=!1),/\d/.test(e)||(t=!1)):"date"===n?e.length>19&&(t=!1):"email"===n?/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)||(t=!1):"url"===n&&(/[\s\"]+/.test(e)&&(t=!1),/\.+/.test(e)||(t=!1));return t},e.exports.nextrAndAdd=c,e.exports.nextrNoAdd=u,e.exports.nextr=p,e.exports.prevrAndAdd=v,e.exports.prevrNoAdd=m,e.exports.prevr=h,e.exports.nextf=function(){if(o.fi===o.r[o.ri].order[o.r[o.ri].order.length-1])return p();for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e+1];break}return!0},e.exports.prevf=function(){if(o.fi===o.r[o.ri].order[0])return!!h()&&(o.fi=o.r[o.ri].order[o.r[o.ri].order.length-1],!0);for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e-1];break}return!0},e.exports.jumpTo=function(e){return!!o.r[e]&&(o.ri=e,o.fi=o.r[e].order[0],!0)},e.exports.setOrder=y,e.exports.addSearchRecords=b,e.exports.addBaseRecord=function(e,r){for(var n=0;n<o.r.length;n++)if(o.r[n].bi==e){for(var t in o.r.splice(n,1,{type:"base",bi:n,new:!1,order:[],f:{}}),o.dm.b[n].fields)o.r[n].f[t]={sfname:o.dm.b[n].fields[t].sfname},r?(o.r[n].f[t].value=r[o.dm.b[n].fields[t].sfname],o.r[n].f[t].origval=r[o.dm.b[n].fields[t].sfname]):o.dm.b[n].fields[t].value?o.r[n].f[t].value=o.dm.b[n].fields[t].value:(o.r[n].f[t].value=null,o.r[n].f[t].origval=null);y(n);for(var i=0;i<o.r.length;i++)if("search"===o.r[i].type)return o.ri=i,o.fi=o.r[i].order[0],!0;return o.search&&(a.clearBaseSearch(),o.fi=o.r[n].order[0],a.loadAllRecords()),!0}return!1},e.exports.addRecord=g,e.exports.updateIndexFields=function(e,r){if(!e||"function"!=typeof e)return!1;f.renderLoadingStart("Looking up index fields");var n=0,a=0;if(void 0!==r&&r<o.r.length){var s=function(){var t=rf.getBorR(r);for(var d in o.r[r].f)"index"===t.fields[d].type&&o.r[r].f[d].value&&(a+=1);if(0===a)return f.renderLoadingEnd(),e(),{v:void 0};var s=function(e){if("index"===t.fields[e].type&&o.r[r].f[e].value){var d={};d[t.fields[e].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:t.fields[e].indexto,conditions:{Id:o.r[i].f[e].value},fields:d}),success:function(r){n+=1,r[0]&&(o.r[i].f[e].showval=r[0][t.fields[e].indexshow]),n===a&&(f.renderLoadingEnd(),(void 0)())}})}};for(var l in o.r[r].f)s(l);return{v:!0}}();if("object"===t(s))return s.v}for(var l in a=0,n=0,o.r){var c=d.getBorR(l);for(var u in o.r[l].f)"index"==c.fields[u].type&&o.r[l].f[u].value&&(a+=1)}if(0===a)return f.renderLoadingEnd(),void e();var p=function(r){var t=d.getBorR(r),i=function(i){if("index"==t.fields[i].type&&o.r[r].f[i].value){var d={};d[t.fields[i].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:t.fields[i].indexto,conditions:{Id:o.r[r].f[i].value},fields:d}),success:function(d){n+=1,d[0]&&(o.r[r].f[i].showval=d[0][t.fields[i].indexshow]),n===a&&(f.renderLoadingEnd(),e())}})}};for(var s in o.r[r].f)i(s)};for(var v in o.r)p(v)},e.exports.updateR=function(){return fm=d.getFm(),!(!(o.r[o.ri].f[o.fi].origval&&o.r[o.ri].f[o.fi].value==o.r[o.ri].f[o.fi].origval||"search"!==o.r[o.ri].type)&&o.r[o.ri].new)||a.searchBase(o.ri)}},function(e,r,n){var t=n(0),i=n(2),o=n(3),d=n(1),a=function(e){var r={};for(var n in t.sdata.records)t.sdata.records[n].Id===e&&(r=t.sdata.records[n]);if(!r.Id)return!1;o.addBaseRecord(t.sdata.i,r)};e.exports.searchBase=function(e){if("search"!=t.r[e].type)return!1;var r=i.getBorR(e),n={};for(var o in n.sobject=r.sobject,n.conditions={},n.fields={},r.fields)n.fields[r.fields[o].sfname]=1;for(var f=0;f<r.settings.searchorder.length;f++){var s=r.settings.searchorder[f].field;t.r[e].f[s].value&&("text"==r.fields[s].type?n.conditions[r.fields[s].sfname]={$like:"%"+t.r[e].f[s].value.replace(/\s+/g,"%")+"%"}:n.conditions[r.fields[s].sfname]=t.r[e].f[s].value)}d.renderLoadingStart("Searching for "+r.appname),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(n),success:function(o){t.search=!0,t.sdata={type:"base",layout:r.settings.searchlayout,sobject:n.sobject,i:t.r[e].bi,records:i.convRecSA("base",t.r[e].bi,o)},$(document).on("searchSelect",function(e){if(!e)return!1;e.Id&&a(e.Id)}),d.renderLoadingEnd(),d.renderSfView()}})},e.exports.clearBaseSearch=function(){t.search=!1,t.sdata={empty:!0},d.renderSfView()},e.exports.searchIndexRecord=function(e,r){var n=i.getBorR(e),o=n.fields[r];if("index"!=o.type)return!1;var a={sobject:o.indexto,conditions:{},fields:{Id:1}};for(var f in a.conditions[o.indexshow]={$like:"%"+t.r[e].f[r].showval.replace(/\s\s+/g,"%")+"%"},o.indexfields)a.fields[f]=1;d.renderLoadingStart("Searching for "+n.fields[r].indexto),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(a),success:function(n){return d.renderLoadingEnd(),d.renderIndexSearch(e,r,n)}})},e.exports.loadAllRecords=function(e){d.renderLoadingStart("Loading all records");var r=0;if(t.r.length>t.dm.b.length)for(var n=t.r.length,i=t.dm.b.length;i<n;i++)t.r.pop();for(var a=function(n){if(!t.r[n].f.Id.value)return"continue";var i={sobject:t.dm.b[n].sobject,conditions:{},fields:{}};for(var a in i.conditions.Id=t.r[n].f.Id.value,t.dm.b[n].fields)i.fields[t.dm.b[n].fields[a].sfname]=1,t.dm.b[n].fields[a].value&&(i.conditions[t.dm.b[n].fields[a].sfname]=t.dm.b[n].fields[a].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(i),success:function(i){if(r+=1,i)for(var a in i)o.addBaseRecord(n,i[a]);r===t.dm.b.length+t.dm.r.length&&(o.orderR(),o.updateIndexFields(function(){d.renderFldEntry(),d.renderSfView(),e&&"function"==typeof e&&e()}))}})},f=0;f<t.dm.b.length;f++)a(f);for(var s=t.dm.r.length,l=function(n){var i={sobject:t.dm.r[n].sobject,conditions:{},fields:{}};for(var a in t.dm.r[n].fields)if(i.fields[t.dm.r[n].fields[a].sfname]=1,t.dm.r[n].fields[a].value)i.conditions[t.dm.r[n].fields[a].sfname]=t.dm.r[n].fields[a].value;else if(t.dm.r[n].fields[a].inherits)for(var f in t.r)t.r[f].bi==t.dm.r[n].fields[a].inherits.base&&(i.conditions[t.dm.r[n].fields[a].sfname]=t.r[f].f[t.dm.r[n].fields[a].inherits.field].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(i),success:function(i){if(r+=1,i)for(var a in i)o.addRecord(n,i[a]);return r===t.dm.b.length+t.dm.r.length&&(o.orderR(),o.updateIndexFields(function(){d.renderFldEntry(),d.renderSfView(),e&&"function"==typeof e&&e()})),!0}})},c=0;c<s;c++)l(c)},e.exports.indexSearchSelected=function(e,r,n){if(!n.Id)return!1;o.setValue(e,r,n.Id);var a=i.getFm(e,r);return!!n[a.indexshow]&&(t.r[e].f[r].showval=n[a.indexshow],o.nextf(),d.renderFldEntry(),!0)},e.exports.baseSearchSelected=a,e.exports.recordSearchSelected=function(e){var r={};for(var n in t.sdata.records)t.sdata.records[n].Id===e&&(r=t.sdata.records[n]);if(!r.Id)return!1;o.addRecord(t.sdata.i,record),d.renderSfView(),d.renderFldEntry()}},function(e,n,t){var i=t(0),o=t(8),d=t(3),a=t(1);e.exports.bindEvents=function(){i.$initentry.off().click(function(){d.allUnchanged()?(d.initR(),a.renderSfView(),a.renderFldEntry()):a.renderAlert("Initiating data entry will end your current session, erasing any unsaved data. Are you sure you wish to continue?",function(){d.initR(),a.renderSfView(),a.renderFldEntry()})}),i.$addoc.off().change(function(){var e=new FormData;return e.append("file",i.$addoc[0].files[0]),i.$addoc.val(null),o.addDoc(e)}),i.$loadsample.off().click(function(){a.renderDoc("/pdfviewer/web/viewer.html?file=/doc/SampleRoster.pdf"),(r=[])&&(d.initR(),a.renderSfView(),a.renderFldEntry())}),i.$removedoc.off().click(function(){d.allUnchanged()?o.removeDoc(function(){d.initR(),a.renderAll()}):a.renderAlert("Removing document now will erase all unsaved changes.",function(){o.removeDoc(function(){d.initR(),a.renderAll()})})}),i.$instr.off().click(function(){a.renderInstructions()}),$(document).off("keydown").keydown(function(e){var r=$(".fldinput");if($("select").is(":focus")||$("input").is(":focus")||$("textarea").is(":focus"))13===e.which&&r&&r.change();else{if(39===e.which){if(!d.nextf())return}else if(37===e.which){if(!d.prevf())return}else if(40===e.which){if(!d.nextr())return}else if(38===e.which){if(!d.prevr())return}else if(32!==e.which)return;if(a.renderFldEntry(),a.renderSfView(),32===e.which){e.preventDefault();var n=$(".fldinput");n&&n.focus()}}})},e.exports.unbindEvents=function(){i.$initentry.off(),i.$addoc.off(),i.$loadsample.off(),i.$removedoc.off(),i.$instr.off(),$(document).off("keydown")}},function(e,r,n){var t=n(0),i=n(1),o=n(5);t.$addoc=$("#adddoc"),t.$loadsample=$("#loadsample"),t.$removedoc=$("#removedoc"),t.$initentry=$("#initentry"),t.$instr=$("#instr-button"),$.getJSON("/api/dm",function(e){e.b&&e.r?(t.dm=e,o.bindEvents(),$(".instructions-frame").click(i.renderInstructionsHide),$(".close-button").click(i.renderInstructionsHide),$(".instructions").off().click(function(e){e.stopPropagation()}),$(".modal").on("hidden.bs.modal",function(){o.bindEvents()}),$(".modal").on("shown.bs.modal",function(){$(".fldwin").attr("tabindex",-1).focus(),o.unbindEvents()})):i.renderError("Can't access server!")})},function(e,r,n){var t=n(0),i=n(2),o=n(3),d=n(1),a=n(4),f=function(e,r){if(!o.isChanged(e))return!1;var n=i.getBorR(e),a=t.r[e];if(a.new&&!a.f.Id.value){var f={sobject:n.sobject,records:[{}]};for(var s in a.f)a.f[s].value&&"Id"!=a.f[s].sfname&&!n.fields[s].noupdate&&(f.records[0][n.fields[s].sfname]=a.f[s].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(f),success:function(n){!1===n.success||n.err||r&&r(n,e)}})}else{if(a.new)return d.renderErr("Record is labelled new but has salesforce Id"),!1;var l={sobject:n.sobject,records:[{}]};for(var c in l.records[0].Id=a.f.Id.value,a.f)a.f[c].value==a.f[c].origval||n.fields[c].noupdate||(l.records[0][n.fields[c].sfname]=a.f[c].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/update",dataType:"json",async:!0,data:JSON.stringify(l),success:function(e){!1===e.success||e.err||r&&r(e)}})}return!0};e.exports.updateRecord=f,e.exports.updateAll=function(){if(o.allUnchanged())return d.renderError("Nothing to update!"),!1;var e=0,r=0;d.renderLoadingStart();for(var n=0;n<t.r.length;n++)o.isChanged(n)&&(r+=1);for(var i=0;i<t.r.length;i++)f(i,function(){(e+=1)===r&&(d.renderLoadingEnd(),a.loadAllRecords())});return!0}},function(e,r,n){var t=n(1);e.exports.addDoc=function(e,r){return t.renderLoadingStart("Loading document"),!!e&&!!e.get("file")&&($.ajax({url:"/doc/load",type:"POST",data:e,success:function(e){if(t.renderLoadingEnd(),e.err||!e.iframeurl)return t.renderError(e.err),!1;t.renderDoc(e.iframeurl)},cache:!1,contentType:!1,processData:!1}),!0)},e.exports.removeDoc=function(e){t.renderLoadingStart("Removing Document"),$.getJSON("/doc/remove",function(r){t.renderLoadingEnd(),e?e():t.renderDoc()})}}]);