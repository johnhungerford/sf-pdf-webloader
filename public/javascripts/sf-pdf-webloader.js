!function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=6)}([function(e,r){e.exports.dm={},e.exports.r=[],e.exports.ri=0,e.exports.fi=null,e.exports.search=!0,e.exports.sdata={empty:!0},e.exports.init=!0,e.exports.mdownpos=[],e.exports.$addoc=$("#adddoc"),e.exports.$loadsample=$("#loadsample"),e.exports.$removedoc=$("#removedoc"),e.exports.$initentry=$("#initentry"),e.exports.$instr=$("#instr-button")},function(e,t,n){const i=n(0),o=n(2),d=n(4),l=n(3),s=n(7),a=n(5),f=function(e){$(".pdfwin").empty(),void 0===e?$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="/doc/view"></iframe>'):$(".pdfwin").append('<iframe id="pdfiframe" height="100%" width="100%" src="'+e+'"></iframe>'),$("#pdfiframe").on("load",function(){$("#pdfiframe").contents().find("body").off().mouseup(function(e){let r=document.getElementById("pdfiframe").contentDocument.getSelection(),t=r.toString();if(t){if(mdownpos===[]&&(mdownpos=[e.pageX,e.pageY]),!validateSelection(t))return c(r),r.collapseToStart(),void $(".fldwin").attr("tabindex",-1).focus();$(".fldinput").val(t),$(".fldinput").change(),r.collapseToStart(),$(".fldwin").attr("tabindex",-1).focus(),mdownpos=[]}}),$("#pdfiframe").contents().find("body").mousedown(function(e){mdownpos=[e.pageX,e.pageY],$("#selecpopup").remove()})})},c=function(e){const r=getFm().appname,t=$(".mainwin"),n=$(".pdfwin");t.append('<div id="selecpopup" style="position:absolute;display:none;z-index:100;background-color:yellow;"><b>Invalid selection for field: "'+r+'"</b></div>');$("#selecpopup");$("#selecpopup").offset({top:n.position().top+mdownpos[1]-45,left:n.position().left+mdownpos[0]-100}).show(),setTimeout(()=>{$("#selecpopup").fadeOut("slow",()=>{$("#selecpopup").remove()})},2e3)};var u=function(e){$(".error-body").empty(),$(".error-body").append(e),$(".error").modal("show")},p=function(e){$(".ld-msg").empty(),$(".ld-msg").append(e),$(".loading").modal("show"),setTimeout(function(){h()},1e4)},h=function(){setTimeout(function(){$(".loading").modal("hide")},200),$(".ld-msg").empty()},m=function(){var e=o.getBorR(),t=i.ri;i.fi;if($(".sfviewmenu").empty(),"search"==i.r[ri].type){if($(".sfviewmenu").append('<button type="button" class="btn btn-primary newbase-button">New</button'),$(".newbase-button").off().click(function(){i.r[t].type="base",setOrder(t),i.fi=r[t].order[0],y(),v()}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Find or Create "+e.appname+" ("+e.sobject+")</h4>"),i.sdata.empty)return!1;for(let e=0;e<i.sdata.records.length;e++){for(var n in $(".sfviewbody").append('<div class="search-result" data-id="'+i.sdata.records[e].Id+'" id="sresult'+e+'"></div>'),i.sdata.layout)$("#sresult"+e).append("<div>"+parseLayout(i.sdata.layout[n],i.sdata.records[e])+"</div>");$("#sresult"+e).off().click(function(){$.event.trigger({type:"searchSelect",Id:i.sdata.records[e].Id})})}}else $(".sfviewmenu").append('<button type="button" class="btn btn-primary createbase-button">Add to Salesforce</button'),$(".createbase-button").off().click(function(){p(),s.updateRecord(t,function(e,r){h(),console.log("Created contact record!"),console.log(e),console.log(r),e[0]&&e[0].id&&(setValue(r,"Id",e[0].id),i.r[r].new=!1,d.loadAllRecords())})}),$(".sfviewbody").empty(),$(".sfviewbody").append("<h4>Add "+e.appname+" ("+e.sobject+") to Salesforce</h4>")},v=function(){if(i.search)return m();i.ri>=i.r.length&&(i.ri=i.r.length-1),i.ri<0&&(i.ri=0),$(".sfviewmenu").empty(),$(".sfviewmenu").append('<button type="button" class="btn btn-primary saveall-button" style="margin-right:5px;">Save All</button'),$(".saveall-button").off().click(function(){s.updateAll()}),$(".sfviewmenu").append('<button type="button" class="btn btn-primary refresh-button">Refresh</button'),$(".refresh-button").off().click(function(){d.loadAllRecords()}),$(".sfviewbody").empty();for(let r=0;r<i.dm.b.length;r++){$(".sfviewbody").append('<div class="sfview-header sfview-base-box" id="sfview-hdr-b-'+r+'"></div>'),$("#sfview-hdr-b-"+r).append("<h4>"+i.dm.b[r].appname+"</h4>");for(var e=0;e<i.dm.b[r].settings.layout.length;e++)$("#sfview-hdr-b-"+r).append("<div>"+parseLayout(i.dm.b[r].settings.layout[e],o.getFieldsForLayout(r))+"</div>");$("#sfview-hdr-b-"+r).attr("style","cursor:pointer"),$("#sfview-hdr-b-"+r).off().click(function(){l.jumpTo(r),y(),v()}),i.ri==r&&$("#sfview-hdr-b-"+r).attr("style","border:2px solid red;")}for(let e=0;e<i.dm.r.length;e++)$(".sfviewbody").append('<div class="sfview-header" id="sfview-hdr-r-'+e+'"></div>'),$("#sfview-hdr-r-"+e).append("<h4>"+i.dm.r[e].appname+"</h4>");for(let e=i.dm.b.length;e<i.r.length;e++){$("#sfview-hdr-r-"+i.r[e].ri).append('<div class="sfview-record" id="sfview-rec-'+e+'"></div>');for(let r=0;r<i.dm.r[i.r[e].ri].settings.layout.length;r++)$("#sfview-rec-"+e).append("<div>"+parseLayout(i.dm.r[i.r[e].ri].settings.layout[r],getFieldsForLayout(e))+"</div>");$("#sfview-rec-"+e).off().click(function(){jumpTo(e),y(),v()}),i.ri==e&&$("#sfview-rec-"+e).attr("style","border: 2px solid red;")}var r=$(".sfviewbody").scrollTop();if(i.ri<i.dm.b.length)var t=$("#sfview-hdr-b-"+ri);else t=$("#sfview-rec-"+ri);var n=t.offset().top-$(".sfviewbody").offset().top,a=n+t.height();a>$(".sfviewbody").innerHeight()?$(".sfviewbody").scrollTop(r+a-$(".sfviewbody").innerHeight()+5):n<0&&$(".sfviewbody").scrollTop(r+n)},g=function(e){var r=new Date(e);return["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."][r.getMonth()]+" "+r.getDate()+", "+r.getFullYear()},y=function(){i.ri>=i.r.length&&(i.ri=i.r.length-1),i.ri<0&&(i.ri=0),$(".fldwinleft").empty(),0==i.ri&&i.fi==i.r[0].order[0]||($(".fldwinleft").append('<a class="btn btn-primary" href="#" id="prevlink"><</a>'),$("#prevlink").off().click(function(){l.updateR(),l.setOrder(),l.prevf(),y(),v()})),$(".fldwinright").empty(),(i.ri<i.r.length-1||i.fi!=i.r[i.r.length-1].order[i.r[i.r.length-1].order.length-1])&&($(".fldwinright").append('<a class="btn btn-primary" href="#" id="nextlink">></a>'),$("#nextlink").off().click(function(){l.updateR(),l.setOrder(),l.nextf(),y(),v()}));i.r[i.ri];var e=fm.getBorR();switch($(".fldtitle").empty(),$(".fldtitle").append("<h4>"+e.fields[i.fi].appname+"</h4>"),$(".fldinstr").empty(),e.fields[i.fi].instructions&&$(".fldinstr").append("<p>"+e.fields[i.fi].instructions+"</p>"),$(".fldentry").empty(),e.fields[i.fi].type){case"text":if(e.fields[i.fi].length>260)var r='<textarea style="resize: none" rows="5" cols="45" ';else r='<input type="text" size="45" ';r+='class="fldinput" maxlength = "'+e.fields[i.fi].length+'" > ';break;case"phone":r='<input class="fldinput" type="text" size="45" maxlength="40">';break;case"url":r='<input class="fldinput" type="text" size="50">';break;case"email":r='<input class="fldinput" type="text" size="45" maxlength="'+e.fields[i.fi].length+'">';break;case"picklist":r='<select class="fldinput">';r+='<option value="">None</option>';for(var t=0;t<e.fields[i.fi].values.length;t++)r+="<option>"+e.fields[i.fi].values[t]+"</option>";r+="</select>";break;case"date":r='<input class="fldinput" type="text" maxlength="100">';break;case"index":r='<input class="fldinput" type="text" size="45" maxlength="255">';break;case"boolean":r='<input class="fldinput" type="checkbox" >'}$(".fldentry").append(r),i.r[i.ri].f[i.fi].value&&("index"==e.fields[i.fi].type?i.r[ri].f[fi].showval&&$(".fldinput").val(i.r[i.ri].f[i.fi].showval):"date"==e.fields[i.fi].type?$(".fldinput").val(g(i.r[i.ri].f[i.fi].value)):"boolean"==e.fields[i.fi].type?i.r[i.ri].f[i.fi].value?$(".fldinput").prop("checked",!0):$(".fldinput").prop("checked",!1):$(".fldinput").val(i.r[i.ri].f[i.fi].value));let n=i.ri,o=i.fi;e.fields[i.fin].indexto;$(".fldinput").off().change(function(){if("index"==e.fields[o].type)return""==$(".fldinput").val()?(i.r[n].f[o].showval=null,i.r[n].f[o].value=null,l.updateR(),l.setOrder(),l.nextf(),y(),void v()):(i.r[n].f[o].showval=$(".fldinput").val(),void d.searchIndexRecord(n,o));"boolean"!=e.fields[o].type?setValue(n,o,$(".fldinput").val())&&(l.updateR(),l.setOrder(),l.nextf(),y(),v()):i.r[n].f[o].value=$(".fldinput").prop("checked")})},b=function(e,r){t.getBorR(e);var t=t.getFm(e,r);$(".increate-title").empty(),$(".increate-body").empty(),$(".increate-title").append("Create new "+t.appname+" record");var n={};n.sobject=t.indexto,n.record={};for(let e=0;e<t.createfields.length;e++)$(".increate-body").append('<div id="increate-fld-'+e+'"></div>'),$("#increate-fld-"+e).append('<h5 id="increate-fldtitle-'+e+'"></h5>'),$("#increate-fld-"+e).append('<input type="text" size="45" id="increate-fldinput-'+e+'">'),$("#increate-fldtitle-"+e).append(t.createfields[e]+":"),t.createfields[e]==t.indexshow&&$("#increate-fldinput-"+e).val($(".fldinput").val());$(".increate-create-btn").off().click(function(){for(var n={sobject:t.indexto,records:[{}]},o=0;o<t.createfields.length;o++)$("#increate-fldinput-"+o).val()&&(n.records[0][t.createfields[o]]=$("#increate-fldinput-"+o).val());for(var d in t.indexfields)t.indexfields[d].value&&(n.records[0][d]=t.indexfields[d].value);p("Creating "+t.appname+" record"),$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(n),success:function(o){if(h(),o[0].err||!o[0].success)return u("Could not create "+t.indexto+": "+o[0].err),!1;$(".increate").modal("hide"),l.setValue(e,r,o[0].id),i.r[e].f[r].showval=n.records[0][t.indexshow],y(),v()}})}),$(".increate").modal("show")};e.exports.renderDoc=f,e.exports.renderSelectionErr=c,e.exports.renderError=u,e.exports.renderAlert=function(e,r){$(".alert-body").empty(),$(".alert-body").append(e),$(".alert").modal("show"),$(".alert-execute").off().click(function(){$(".alert").modal("hide"),r&&r()})},e.exports.renderOpenUrl=function(){$(".openurl-input").val(""),$(".openurlmodal").modal("show"),$(".openurl-open-btn").off().click(function(){$(".openurlmodal").modal("hide"),f($(".openurl-input").val())})},e.exports.renderLoadingStart=p,e.exports.renderLoadingEnd=h,e.exports.renderBaseSearch=m,e.exports.renderSfView=v,e.exports.convertDate=g,e.exports.renderFldEntry=y,e.exports.renderIndexSearch=function(e,r,t){var n=o.getFm(e,r);$(".insrch-title").empty(),$(".insrch-body").empty(),$(".insrch-title").prepend("Searching for "+n.indexto),$(".insrch").modal("show");for(let i=0;i<t.length;i++){$(".insrch-body").append('<div class="insresult" id="insresult'+i+'"></div>');for(let e=0;e<n.searchlayout.length;e++)$("#insresult"+i).append("<span>"+parseLayout(n.searchlayout[e],t[i])+"</span>");$("#insresult"+i).off().click(function(){indexSearchSelected(e,r,t[i]),$(".insrch").modal("hide")})}$(".insrch-create-btn").off().click(function(){b(e,r)})},e.exports.renderIndexCreate=b,e.exports.renderAll=function(){v(),y(),f()},e.exports.renderInstructions=function(){$(".instructions-frame").show(),a.unbindEvents()},e.exports.renderInstructionsHide=function(){$(".instructions-frame").hide(),a.bindEvents()}},function(e,r,t){const n=t(0),i=function(e){return void 0===e&&(e=n.ri),"record"==n.r[e].type?n.dm.r[n.r[e].ri]:"base"==n.r[e].type?n.dm.b[n.r[e].bi]:"search"==n.r[e].type&&n.dm.b[n.r[e].bi]},o=function(e,r){const t=function(e,t,n){let i=$.trim(e).split("=");return r[i[0]]?1==i.length?r[i[0]]?o(t,r):o(n,r):i.length>1?r[i[0]]==i[1]?o(t,r):o(n,r):"#BAD CONDITION (else)#":o(n,r)};let n,i,d,l,s,a,f,c,u="";for(n=0;n<e.length;n++)if("#"===e[n])if(n+=1,"IF"===e.slice(n,n+2)){if("("!=e[n+=2]){u+="#BAD CONDITIONAL! (no opening parentheses)#",n-=1;continue}for(i=n+1;i<e.length&&")"!=e[i];)i+=1;if(i===e.length){u+="#BAD CONDITIONAL! (no closing parentheses)#",n-=1;continue}if(s=e.slice(n+1,i),"{"!=e[n=i+1])u+="#BAD CONDITIONAL! (no opening brackets for true)#",n-=1;else{for(d=n+=1,a=0;d<e.length&&("}"!=e[d]||a>0);)"#"==e[d]&&(a+=1),"}"==e[d]&&"{"!=e[d+1]&&(a-=1),d+=1;if(d===e.length){u+="#BAD CONDITIONAL! (no closing brackets for true)#",n-=1;continue}if(f=e.slice(n,d),"{"===e[n=d+1]){for(l=n+=1,a=0;l<e.length&&("}"!=e[l]||a>0);)"#"==e[l]&&(a+=1),"}"==e[l]&&"{"!=e[l+1]&&(a-=1),l+=1;c=e.slice(n,l),n=l+1}else c="";n-=1,console.log(e[n]),u+=t(s,f,c)}}else if("{"===e[n]){for(i=n+=1;i<e.length&&"}"!=e[i];)i+=1;if(i===e.length){u+="#BAD FIELD#",n-=1;continue}r[e.slice(n,i)]?u+=r[e.slice(n,i)]:u+="#BAD FIELD#",n=i}else u+="#";else u+=e[n];return u};e.exports.convRecSA=function(e,r,t){const i=function(t){let i="record"===e?n.dm.r[r].fields:n.dm.b[r].fields,o={};for(let e in t)for(let r in i)i[r].sfname===e&&(o[r]=t[e]);return o};let o=[];if(Array.isArray(t))for(let e=0;e<t.length;e++)o.push(i(t[e]));return o},e.exports.getFieldsForLayout=function(e){let r={},t=i(e);for(let i in n.r[e].f)"index"===t.fields[i].type&&n.r[e].f[i].showval?r[i]=n.r[e].f[i].showval:r[i]=n.r[e].f[i].value;return r},e.exports.getBorR=i,e.exports.getFm=function(e,r){return null==r&&(e=n.ri,r=n.fi),"record"==n.r[e].type?n.dm.r[n.r[e].ri].fields[r]:"base"==n.r[e].type?n.dm.b[n.r[e].bi].fields[r]:"search"==n.r[e].type&&n.dm.b[n.r[e].bi].fields[r]},e.exports.parseLayout=o},function(e,t,n){const o=n(0),d=n(2),l=n(4),s=n(1),a=function(e){return!!o.r[e].new},f=function(e){getBorR(e);if(r[e].new||!r[e].f.Id){for(let t in r[e].f)if(r[e].f[t].changed)return!0;return!1}for(let t in r[e].f)if(r[e].f[t].changed&&r[e].f[t].value!=r[e].f[t].origval)return!0;return!1},c=function(e){return!(e<0||e>=dm.r.length&&"record"==o.r[o.ri].type)&&(b(e),a(o.ri)&&!f(o.ri)?r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0)},u=function(){return a(o.ri)&&!f(o.ri)?o.r.splice(o.ri,1):o.ri+=1,o.fi=o.r[o.ri].order[0],!0},p=function(){if(o.ri===o.r.length-1){if(o.ri>=o.dm.b.length)return!a(o.ri)||a(o.ri)&&f(o.ri)?c(o.r[o.ri].ri):o.r[o.ri].ri<o.dm.r.length-1&&c(o.r[o.ri].ri+1);if(o.ri<o.dm.b.length-1)return!1;if(o.ri===o.dm.b.length-1)return!a(o.ri)&&c(0)}else if(o.ri<o.r.length-1)return o.r[o.ri+1].d.ri===o.r[o.ri].ri||"base"===o.r[ri].type?u():!a(o.ri)||a(o.ri)&&f(o.ri)?c(o.r[o.ri].ri):o.r[o.ri+1].ri===o.r[o.ri].ri+1?u():c(o.r[o.ri].ri+1);return!1},h=function(e){return!(e<0||e>=dm.r.length)&&(b(e),a(o.ri+1)&&!f(o.ri+1)&&o.r.splice(o.ri+1,1),o.fi=o.r[o.ri].order[0],!0)},m=function(){return a(o.ri)&&!f(o.ri)&&"record"===o.r[o.ri].type&&o.r.splice(o.ri,1),o.ri-=1,o.fi=o.r[o.ri].order[0],!0},v=function(){if(o.fi===o.r[o.ri].order[0])return 0!==o.ri&&(o.ri<o.dm.b.length?m():0===o.r[o.ri].ri||o.r[o.ri-1].ri===o.r[o.ri].ri||a(o.ri-1)&&!f(o.ri-1)?m():h(o.r[o.ri].ri-1),!0)&&(o.fi=o.r[o.ri].order[o.r[o.ri].order.length-1],!0);for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e-1];break}return!0},g=function(e){null==e&&(e=o.ri);let r,t=function(e,r){let n=[];for(let i=0;i<e.length;i++)if(n.push(e[i].field),e[i].autofill&&!r[e[i].field].origval&&"filled"===e[i].autofill.condition&&(r[e[i].autofill.conditionfield].value&&e[i].autofill.true?r[e[i].field].value=e[i].autofill.true:!r[e[i].autofill.conditionfield].value&&e[i].autofill.false&&(r[e[i].field].value=e[i].autofill.false)),e[i].condition)if("filled"===e[i].condition)r[e[i].field].value&&e[i].true?n=n.concat(t(e[i].true,r)):!r[e[i].field].value&&e[i].false&&(n=n.concat(t(e[i].false,r)));else if("switch"===e[i].condition)for(let o=0;o<e[i].switch.length;o++)for(let d=0;d<e[i].switch[o].value.length;d++)if(r[e[i].field].value==e[i].switch[o].value[d]){n=n.concat(t(e[i].switch[o].order,r));break}return n},n=o.r[e];"base"===n.type?(r=o.dm.b[n.bi],orderm=r.settings.order):"search"===n.type?(r=o.dm.b[n.bi],orderm=r.settings.searchorder):"record"===n.type&&(r=o.dm.r[n.ri],orderm=r.settings.order),n.order=t(orderm,o.r[e].f)},y=function(){for(let e=0;e<o.dm.b.length;e++){r.push({type:"search",bi:e,new:!0,order:[],f:{}});for(let r in o.dm.b[e].fields)o.r[e].f[r]={sfname:o.dm.b[e].fields[r].sfname},o.dm.b[e].fields[r].value?o.r[e].f[r].value=o.dm.b[e].fields[r].value:(o.r[e].f[r].value=null,o.r[e].f[r].origval=null);g(e)}o.ri=0,o.fi=o.r[ri].order[0]},b=function(e,r){let t=o.dm.b.length;for(;t<o.r.length;)if(r){if(!(o.r[t].ri<=e)||o.r[t].ri===e&&o.r[t].f.Id.value===r.Id)break;t++}else{if(!(o.r[t].ri<=e))break;t+=1}t===o.r.length?o.r.push({type:"record",ri:e,order:[],f:{}}):o.r[t].ri===e&&o.r[t].f.Id.value===r.Id?o.r.splice(t,1,{type:"record",ri:e,order:[],f:{}}):o.r.splice(t,0,{type:"record",ri:e,order:[],f:{}}),o.r[t].new=!r;for(let n in o.dm.r[e].fields)o.r[t].f[n]={},o.r[t].f[n].sfname=o.dm.r[e].fields[n].sfname,o.r[t].new?o.dm.r[e].fields[n].inherits?o.r[t].f[n].value=o.r[o.dm.r[e].fields[n].inherits.base].f[o.dm.r[e].fields[n].inherits.field].value:o.dm.r[e].fields[n].autofill?o.r[t].f[n].value=o.r[o.dm.r[e].fields[n].autofill.base].f[o.dm.r[e].fields[n].autofill.field].value:o.dm.r[e].fields[n].value?o.r[t].f[n].value=o.dm.r[e].fields[n].value:o.dm.r[e].fields[n].default?o.r[t].f[n].value=o.dm.r[e].fields[n].default:o.r[t].f[n].value=null:(o.r[t].f[n].value=r[o.dm.r[e].fields[n].sfname],o.r[t].f[n].origval=r[o.dm.r[e].fields[n].sfname]);return g(t),!0};e.exports.initR=function(){o.r=[],o.ri=0,y(),o.search=!0,o.sdata={empty:!0},o.fi=o.r[o.ri].order[0],s.renderSfView(),s.renderFldEntry()},e.exports.orderR=function(){const e=function(e,r){e&&r&&e!==r&&o.r.splice(r,0,o.r.splice(e,1)[0])};for(let d=0;d<o.dm.r.length;d++){let l=0,s=[];const a=o.dm.r[d],f=a.settings.listorder;for(let e=0;e<f.length;e++)s.push(a.fields[f[e].field]);for(l=o.dm.b.length;l<o.r.length&&o.r[l].ri<d;l++);if(l==r.length-1)break;for(let r=f.length-1;r>=0;r--){const a=s[r].type;for(let c=l;c<o.r.length&&o.r[c].ri===d;c++){if("index"===a)if(o.r[c].f[f[r].field].showval)var t=o.r[c].f[f[r].field].showval;else t="";else t=o.r[c].f[f[r].field].value;for(let d=c-1;d>=l;d--){if("index"===a){var n=s[r].indexfields[s[r].indexshow].type;if(o.r[d].f[f[r].field].showval)var i=o.r[d].f[f[r].field].showval;else i=""}else n=a,i=o.r[d].f[f[r].field].value;if(null==t||""===t){if(null==i||""===i){e(c,d+1);break}if(f[r].empty){if("last"==f[r].empty)break;if("first"==f[r].empty){if(d==l){e(c,d);break}continue}break}break}if(null!=i&&null!=i&&""!=i){if("date"===n&&(t=new Date(t).getTime(),i=new Date(i).getTime()),t===i){e(c,d+1);break}if(t>i){if("asc"===f[r].order){e(c,d+1);break}if(d===l){e(c,d);break}}else if(t<i){if("desc"===f[r].order){e(c,d+1);break}if(d==l){e(c,d);break}}}else if(f[r].empty){if("last"==f[r].empty)continue;if("first"==f[r].empty){e(c,d+1);break}e(c,d+1);break}}}}}},e.exports.isNew=a,e.exports.isChanged=f,e.exports.allUnchanged=function(){for(let e in r)if(f(e))return!1;return!0},e.exports.basesUpToDate=function(){for(let e in dm.b)if(f(e))return!1;return!0},e.exports.setValue=function(e,t,n){let i;switch(getFm(e,t).type){case"text":case"picklist":case"index":case void 0:i=n;break;case"date":{if(""==n||" "==n){i=null;break}const e=n.split(" ");let r;if(1==e.length?r=n<9999&&n>1e3?new Date("Jan. 1, "+n):new Date(n):2==e.length?"SPRING"==e[0].toUpperCase()?r=new Date("May 30, "+e[1]):"SUMMER"==e[0].toUpperCase()?r=new Date("July 15, "+e[1]):"FALL"==e[0].toUpperCase()?r=new Date("September 1, "+e[1]):"WINTER"==e[0].toUpperCase()&&(r=new Date("December 15, "+e[1])):r=new Date(n),!r||isNaN(r.getTime()))return renderError("Not a valid date!"),!1;i=r.toISOString();break}case"email":if(!/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(n))return renderError("Not a valid email address!"),!1;i=n;break;default:i=n}return r[e].f[t].value=i,r[e].f[t].changed=!0,g(e),!0},e.exports.validateSelection=function(e){e=e.trim();const r=$(".fldinput"),t=getFm().type;let n=!0;if("INPUT"===r.prop("nodeName")?"text"===r.attr("type")&&(e.indexOf("\n")>-1&&(n=!1),e.length>r.attr("size")&&(n=!1)):"SELECT"===r.prop("nodeName")&&(n=!1,$(".fldinput option").each(function(){this.value==e&&(n=!0)})),"phone"===t)e.length>20&&(n=!1),/[\&\@\$\%\^\{\}]/.test(e)&&(n=!1),/\d/.test(e)||(n=!1);else if("date"===t)e.length>19&&(n=!1);else if("email"===t)console.log("email"),/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)||(n=!1);else if("url"===t){console.log("url");const r=/\.+/;/[\s\"]+/.test(e)&&(n=!1),r.test(e)||(n=!1)}return n},e.exports.nextrAndAdd=c,e.exports.nextrNoAdd=u,e.exports.nextr=p,e.exports.prevrAndAdd=h,e.exports.prevrNoAdd=m,e.exports.prevr=v,e.exports.nextf=function(){if(fi===o.r[o.ri].order[o.r[o.ri].order.length-1])return p();for(var e=0;e<o.r[o.ri].order.length;e++)if(o.fi===o.r[o.ri].order[e]){o.fi=o.r[o.ri].order[e+1];break}return!0},e.exports.prevf=v,e.exports.jumpTo=function(e){return!!o.r[e]&&(o.ri=e,o.fi=o.r[e].order[0],!0)},e.exports.setOrder=g,e.exports.addSearchRecords=y,e.exports.addBaseRecord=function(e,t){for(let n=0;n<o.r.length;n++)if(o.r[n].bi==e){o.r.splice(n,1,{type:"base",bi:n,new:!1,order:[],f:{}});for(let e in o.dm.b[n].fields)o.r[n].f[e]={sfname:o.dm.b[n].fields[e].sfname},t?(o.r[n].f[e].value=t[o.dm.b[n].fields[e].sfname],o.r[n].f[e].origval=t[o.dm.b[n].fields[e].sfname]):o.dm.b[n].fields[e].value?o.r[n].f[e].value=o.dm.b[n].fields[e].value:(o.r[n].f[e].value=null,o.r[n].f[e].origval=null);g(n);for(let e=0;e<o.r.length;e++)if("search"===o.r[e].type)return o.ri=e,o.fi=o.r[e].order[0],!0;return o.search&&(l.clearBaseSearch(),o.fi=r[n].order[0],l.loadAllRecords()),!0}return!1},e.exports.addRecord=b,e.exports.updateIndexFields=function(e,t){if(!e||"function"!=typeof e)return!1;renderLoadingStart("Looking up index fields");let n=0,l=0;if(void 0!==t&&t<r.length){let d=rf.getBorR(t);for(let e in o.r[t].f)"index"===d.fields[e].type&&o.r[t].f[e].value&&(l+=1);if(0===l)return s.renderLoadingEnd(),void e();for(let e in r[t].f)if("index"===d.fields[e].type&&o.r[t].f[e].value){let r,t={};t[d.fields[e].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:d.fields[e].indexto,conditions:{Id:o.r[i].f[e].value},fields:t}),success:t=>{n+=1,t[0]&&(o.r[i].f[e].showval=t[0][d.fields[e].indexshow]),n===l&&(s.renderLoadingEnd(),r())}})}return!0}l=0,n=0;for(let e in r){let t=d.getBorR(e);for(let n in r[e].f)"index"==t.fields[n].type&&r[e].f[n].value&&(l+=1)}if(0===l)return s.renderLoadingEnd(),void e();for(let t in r){let i=d.getBorR(t);for(let d in r[t].f)if("index"==i.fields[d].type&&r[t].f[d].value){let r={};r[i.fields[d].indexshow]=1,$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify({sobject:i.fields[d].indexto,conditions:{Id:o.r[t].f[d].value},fields:r}),success:r=>{n+=1,r[0]&&(o.r[t].f[d].showval=r[0][i.fields[d].indexshow]),n===l&&(s.renderLoadingEnd(),e())}})}}},e.exports.updateR=function(){return fm=d.getFm(),!(!(o.r[o.ri].f[o.fi].origval&&o.r[o.ri].f[o.fi].value==o.r[o.ri].f[o.fi].origval||"search"!==o.r[o.ri].type)&&o.r[o.ri].new)||l.searchBase(o.ri)}},function(e,t,n){const i=n(0),o=n(2),d=n(3),l=n(1),s=function(e){let r={};for(let t in i.sdata.records)i.sdata.records[t].Id===e&&(r=i.sdata.records[t]);if(!r.Id)return!1;d.addBaseRecord(i.sdata.i,r)};e.exports.searchBase=function(e){if("search"!=i.r[e].type)return!1;const r=o.getBorR(e);let t={};t.sobject=r.sobject,t.conditions={},t.fields={};for(let e in r.fields)t.fields[r.fields[e].sfname]=1;for(let n=0;n<r.settings.searchorder.length;n++){let o=r.settings.searchorder[n].field;i.r[e].f[o].value&&("text"==r.fields[o].type?t.conditions[r.fields[o].sfname]={$like:"%"+i.r[e].f[o].value.replace(/\s+/g,"%")+"%"}:t.conditions[r.fields[o].sfname]=i.r[e].f[o].value)}renderLoadingStart("Searching for "+r.appname),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(t),success:function(n){i.search=!0,i.sdata={type:"base",layout:r.settings.searchlayout,sobject:t.sobject,i:i.r[e].bi,records:o.convRecSA("base",i.r[e].bi,n)},$(document).on("searchSelect",function(e){if(!e)return!1;e.Id&&s(e.Id)}),l.renderLoadingEnd(),l.renderSfView()}})},e.exports.clearBaseSearch=function(){i.search=!1,i.sdata={empty:!0},l.renderSfView()},e.exports.searchIndexRecord=function(e,r){var t=o.getBorR(e),n=t.fields[r];if("index"!=n.type)return!1;var d={sobject:n.indexto,conditions:{},fields:{Id:1}};for(var s in d.conditions[n.indexshow]={$like:"%"+i.r[e].f[r].showval.replace(/\s\s+/g,"%")+"%"},n.indexfields)d.fields[s]=1;renderLoadingStart("Searching for "+t.fields[r].indexto),$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(d),success:function(t){return l.renderLoadingEnd(),l.renderIndexSearch(e,r,t)}})},e.exports.loadAllRecords=function(e){renderLoadingStart("Loading all records");let t=0;if(i.r.length>i.dm.b.length){let e=i.r.length;for(let r=i.dm.b.length;r<e;r++)i.r.pop()}for(let r=0;r<i.dm.b.length;r++){if(!i.r[r].f.Id.value)continue;let n={sobject:i.dm.b[r].sobject,conditions:{},fields:{}};n.conditions.Id=i.r[r].f.Id.value;for(let e in i.dm.b[r].fields)n.fields[i.dm.b[r].fields[e].sfname]=1,i.dm.b[r].fields[e].value&&(n.conditions[i.dm.b[r].fields[e].sfname]=i.dm.b[r].fields[e].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(n),success:function(n){if(t+=1,n)for(let e in n)d.addBaseRecord(r,n[e]);t===i.dm.b.length+i.dm.r.length&&(d.orderR(),d.updateIndexFields(()=>{l.renderFldEntry(),l.renderSfView(),e&&"function"==typeof e&&e()}))}})}let n=i.dm.r.length;for(let o=0;o<n;o++){let n={sobject:i.dm.r[o].sobject,conditions:{},fields:{}};for(let e in i.dm.r[o].fields)if(n.fields[i.dm.r[o].fields[e].sfname]=1,i.dm.r[o].fields[e].value)n.conditions[i.dm.r[o].fields[e].sfname]=i.dm.r[o].fields[e].value;else if(i.dm.r[o].fields[e].inherits)for(let t in r)i.r[t].bi==i.dm.r[o].fields[e].inherits.base&&(n.conditions[i.dm.r[o].fields[e].sfname]=i.r[t].f[i.dm.r[o].fields[e].inherits.field].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/find",dataType:"json",async:!0,data:JSON.stringify(n),success:function(r){if(t+=1,r)for(let e in r)d.addRecord(o,r[e]);return t===dm.b.length+dm.r.length&&(d.orderR(),d.updateIndexFields(()=>{l.renderFldEntry(),l.renderSfView(),e&&"function"==typeof e&&e()})),!0}})}},e.exports.indexSearchSelected=function(e,r,t){if(!t.Id)return!1;d.setValue(e,r,t.Id);const n=o.getFm(e,r);return!!t[n.indexshow]&&(i.r[e].f[r].showval=t[n.indexshow],d.nextf(),l.renderFldEntry(),!0)},e.exports.baseSearchSelected=s,e.exports.recordSearchSelected=function(e){let r={};for(let t in i.sdata.records)i.sdata.records[t].Id===e&&(r=i.sdata.records[t]);if(!r.Id)return!1;d.addRecord(i.sdata.i,record),l.renderSfView(),l.renderFldEntry()}},function(e,t,n){const i=n(0),o=n(8),d=n(3),l=n(1);e.exports.bindEvents=function(){i.$initentry.off().click(function(){allUnchanged()?(d.initR(),l.renderSfView(),l.renderFldEntry()):renderAlert("Initiating data entry will end your current session, erasing any unsaved data. Are you sure you wish to continue?",()=>{d.initR(),l.renderSfView(),l.renderFldEntry()})}),i.$addoc.off().change(function(){const e=new FormData;return e.append("file",i.$addoc[0].files[0]),i.$addoc.val(null),o.addDoc(e)}),i.$loadsample.off().click(function(){l.renderDoc("/pdfviewer/web/viewer.html?file=/doc/SampleRoster.pdf"),(r=[])&&(d.initR(),l.renderSfView(),l.renderFldEntry())}),i.$removedoc.off().click(function(){allUnchanged()?o.removeDoc(function(){d.initR(),l.renderAll()}):l.renderAlert("Removing document now will erase all unsaved changes.",()=>{o.removeDoc(function(){d.initR(),l.renderAll()})})}),i.$instr.off().click(function(){l.renderInstructions()}),$(document).off("keydown").keydown(e=>{let r=$(".fldinput");if($("select").is(":focus")||$("input").is(":focus")||$("textarea").is(":focus"))13===e.which&&r&&r.change();else{if(39===e.which){if(!nextf())return}else if(37===e.which){if(!prevf())return}else if(40===e.which){if(!nextr())return}else if(38===e.which){if(!prevr())return}else if(32!==e.which)return;if(l.renderFldEntry(),l.renderSfView(),32===e.which){e.preventDefault();let r=$(".fldinput");r&&r.focus()}}})},e.exports.unbindEvents=function(){i.$initentry.off(),i.$addoc.off(),i.$loadsample.off(),i.$removedoc.off(),i.$instr.off(),$(document).off("keydown")}},function(e,r,t){const n=t(0),i=t(1),o=t(5);n.$addoc=$("#adddoc"),n.$loadsample=$("#loadsample"),n.$removedoc=$("#removedoc"),n.$initentry=$("#initentry"),n.$instr=$("#instr-button"),$.getJSON("/api/dm",function(e){e.b&&e.r?(n.dm=e,o.bindEvents(),$(".instructions").off().click(e=>{e.stopPropagation()}),$(".modal").on("hidden.bs.modal",function(){o.bindEvents()}),$(".modal").on("shown.bs.modal",function(){$(".fldwin").attr("tabindex",-1).focus(),o.unbindEvents()})):i.renderError("Can't access server!")})},function(e,r,t){const n=t(0),i=t(2),o=(t(3),t(1)),d=function(e,r){if(!isChanged(e))return!1;let t=i.getBorR(e),d=n.r[e];if(d.new&&!d.f.Id.value){let n={sobject:t.sobject,records:[{}]};for(let e in d.f)d.f[e].value&&"Id"!=d.f[e].sfname&&!t.fields[e].noupdate&&(n.records[0][t.fields[e].sfname]=d.f[e].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/create",dataType:"json",async:!0,data:JSON.stringify(n),success:function(t){!1===t.success||t.err||r&&r(t,e)}})}else{if(d.new)return o.renderErr("Record is labelled new but has salesforce Id"),!1;{let e={sobject:t.sobject,records:[{}]};e.records[0].Id=d.f.Id.value;for(let r in d.f)d.f[r].value==d.f[r].origval||t.fields[r].noupdate||(e.records[0][t.fields[r].sfname]=d.f[r].value);$.ajax({type:"POST",contentType:"application/json",url:"/api/update",dataType:"json",async:!0,data:JSON.stringify(e),success:function(e){!1===e.success||e.err||r&&r(e)}})}}return!0};e.exports.updateRecord=d,e.exports.updateAll=function(){if(allUnchanged())return o.renderError("Nothing to update!"),!1;var e=0,r=0;o.renderLoadingStart();for(let e=0;e<n.r.length;e++)isChanged(e)&&(r+=1);for(let t=0;t<n.r.length;t++)d(t,function(){(e+=1)===r&&(o.renderLoadingEnd(),o.loadAllRecords())});return!0}},function(e,r,t){const n=t(1);e.exports.addDoc=function(e,r){return n.renderLoadingStart("Loading document"),!!e&&!!e.get("file")&&($.ajax({url:"/doc/load",type:"POST",data:e,success:function(e){if(renderLoadingEnd(),e.err||!e.iframeurl)return renderError(e.err),!1;renderDoc(e.iframeurl)},cache:!1,contentType:!1,processData:!1}),!0)},e.exports.removeDoc=function(e){renderLoadingStart("Removing Document"),$.getJSON("/doc/remove",function(r){renderLoadingEnd(),r.err?n.renderError(r.err):e?e():n.renderDoc()})}}]);