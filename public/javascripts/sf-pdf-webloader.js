/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/main.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/data.js":
/*!*********************!*\
  !*** ./src/data.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports.dm = {};\nmodule.exports.r = [];\nmodule.exports.ri = 0;\nmodule.exports.fi = null;\nmodule.exports.search = true;\nmodule.exports.sdata = { empty: true };\nmodule.exports.init = true;\nmodule.exports.mdownpos = [];\n\n// Cache jQuery lookups for buttons to add and remove pdfs\nmodule.exports.$addoc = $('#adddoc');\nmodule.exports.$loadsample = $('#loadsample')\nmodule.exports.$removedoc = $('#removedoc');\nmodule.exports.$initentry = $('#initentry');\nmodule.exports.$instr = $('#instr-button');\n\n\n//# sourceURL=webpack:///./src/data.js?");

/***/ }),

/***/ "./src/docfunctions.js":
/*!*****************************!*\
  !*** ./src/docfunctions.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\n\nconst addDoc = function(fd, callback) {\n\trn.renderLoadingStart('Loading document');\n\n\tif( !fd ) { return false; }\n\n\tif( !fd.get('file') ) { return false; }\n\n\t$.ajax({\n            url: '/doc/load',  \n            type: 'POST',\n            data: fd,\n            success:function(data){\n            \trenderLoadingEnd();\n            \tif ( data.err || !data.iframeurl) {\n            \t\trenderError(data.err);\n            \t\treturn false;\n            \t} else {\n            \t\trenderDoc(data.iframeurl);\n            \t}\n            },\n            cache: false,\n            contentType: false,\n            processData: false\n        });\n\n\treturn true;\n\n}\n\nconst removeDoc = function(callback) {\n\trenderLoadingStart('Removing Document');\n\t$.getJSON('/doc/remove', function(data) {\n\t\trenderLoadingEnd();\n\t\tif( data.err ) {\n\t\t\trn.renderError(data.err);\n\t\t\treturn;\n\t\t}\n\t\tif( callback ) {\n\t\t\tcallback();\n\t\t} else {\n\t\t\trn.renderDoc();\n\t\t}\n\n\t});\n\n}\n\nmodule.exports.addDoc = addDoc;\nmodule.exports.removeDoc = removeDoc;\n\n\n//# sourceURL=webpack:///./src/docfunctions.js?");

/***/ }),

/***/ "./src/eventfunctions.js":
/*!*******************************!*\
  !*** ./src/eventfunctions.js ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst df = __webpack_require__(/*! ./docfunctions.js */ \"./src/docfunctions.js\");\nconst rf = __webpack_require__(/*! ./recarrayfunctions.js */ \"./src/recarrayfunctions.js\");\nconst rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\n\n/** \n * Bind functions to document buttons (cached above) and keypresses. The buttons that add documents\n * are file type input elements, and the 'change' event means a file has been added.\n * The button to remove a document is just a button, so the function is bound to a click event.\n */\nconst bindEvents = function() {\n    d.$initentry.off().click(function() {\n      if( !rf.allUnchanged() ) {\n        rn.renderAlert('Initiating data entry will end your current session, erasing any unsaved data. Are you sure you wish to continue?', \n          () => {\n          rf.initR();\n          rn.renderSfView();\n          rn.renderFldEntry();\n        });\n      } else {    \n        rf.initR();\n        rn.renderSfView();\n        rn.renderFldEntry();\n      }\n    });\n  \n    d.$addoc.off().change(function(){\n      const fd = new FormData();\n      fd.append('file', d.$addoc[0].files[0]);\n      d.$addoc.val(null);\n      return df.addDoc(fd);\n    });\n  \n    d.$loadsample.off().click(function() {\n      rn.renderDoc('/pdfviewer/web/viewer.html?file=/doc/SampleRoster.pdf');\n      if(r=[]) {\n        rf.initR();\n        rn.renderSfView();\n        rn.renderFldEntry();\n      }\n    });\n  \n    d.$removedoc.off().click(function(){\n      /** \n       * If any records have been edited, warn before proceeding (callback is executed by alert \n       * function upon confirmation)\n       */\n      if( !rf.allUnchanged() ) {\n        rn.renderAlert('Removing document now will erase all unsaved changes.', () => {\n          df.removeDoc(function() {\n            rf.initR();\n            rn.renderAll();\n          });\n        });\n      } else {    \n        df.removeDoc(function() {\n          rf.initR();\n          rn.renderAll()\n        });\n      }\n  \n    });\n  \n    d.$instr.off().click(function() {\n      rn.renderInstructions();\n    });\n  \n    // Handle keydown events to cycle through fields and records\n    $(document).off('keydown').keydown((e) => {\n      let $fldinput = $('.fldinput');\n  \n      // If the focus is on any text input or textarea, disregard any other keystrokes, but \n      // make the \"enter\" key enter the data\n      if( $('select').is(':focus') || $('input').is(':focus') || $('textarea').is(':focus') ) {\n        // Enter triggers 'change' event on fldinput element. See renderFldEntry() for handler\n        if(e.which === 13) {\n          if($fldinput) $fldinput.change();\n        } \n        return;\n      }\n  \n      if(e.which === 39) { // 39: right\n        if( !nextf() ) { return; }\n      } else if(e.which === 37) { // 37: left\n        if( !prevf() ) { return; }\n      } else if(e.which === 40) { // 40: down\n        if( !nextr() ) { return; }\n      } else if(e.which === 38) { // 38: right\n        if( !prevr() ) { return; }\n      } else if(e.which === 32) { // 32: space\n        // see below (skip the return)\n      } else {\n        return;\n      }\n  \n      rn.renderFldEntry();\n      rn.renderSfView();\n  \n      // Space focuses on fldinput, but only *after* fldinput is rendered\n      if(e.which === 32) {\n        e.preventDefault();\n        let $fldinput = $('.fldinput');\n        if ($fldinput) $fldinput.focus();\n      }\n      \n    });\n  }\n\nconst unbindEvents = function() {\n    d.$initentry.off();\n    d.$addoc.off();\n    d.$loadsample.off();\n    d.$removedoc.off();\n    d.$instr.off();\n    $(document).off('keydown');\n  }\n\nmodule.exports.bindEvents = bindEvents;\nmodule.exports.unbindEvents = unbindEvents;\n\n\n//# sourceURL=webpack:///./src/eventfunctions.js?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\nconst ef = __webpack_require__(/*! ./eventfunctions.js */ \"./src/eventfunctions.js\");\n\n// Cache jQuery lookups for buttons to add and remove pdfs\nd.$addoc = $('#adddoc');\nd.$loadsample = $('#loadsample')\nd.$removedoc = $('#removedoc');\nd.$initentry = $('#initentry');\nd.$instr = $('#instr-button');\n\n/**\n * This ajax call gets everything started: it pulls the document map (a json config file) from\n * the server, sets it up as a global variable, and calls getDocs() to grab the list of pdfs\n * stored on the server. \n */\n$.getJSON(\"/api/dm\", function(data) {\n  if (!data.b || !data.r) {\n    rn.renderError('Can\\'t access server!');\n    return;\n  }\n\n  d.dm = data;\n  ef.bindEvents();\n\n  $('.instructions').off().click((e)=>{e.stopPropagation()});\n  $('.modal').on('hidden.bs.modal', function () {\n    ef.bindEvents();\n  });\n  $('.modal').on('shown.bs.modal', function () {\n    // Make sure focus is not on fldentry, where damage can be done...\n    $('.fldwin').attr(\"tabindex\",-1).focus();\n    ef.unbindEvents();\n  });\n  // setting the parameter to 'true' ensures that r will be initalized after the docs are pulled\n\n});\n\n\n//# sourceURL=webpack:///./src/main.js?");

/***/ }),

/***/ "./src/mapfunctions.js":
/*!*****************************!*\
  !*** ./src/mapfunctions.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\n\nconst getFieldsForLayout = function(rin) {\n  let fout = {};\n  let map = getBorR(rin);\n  for (let i in d.r[rin].f) {\n    if (map.fields[i].type === 'index' && d.r[rin].f[i].showval) {\n      fout[i] = d.r[rin].f[i].showval;\n    } else {\n      fout[i] = d.r[rin].f[i].value;\n    }\n  }\n\n  return fout;\n};\n\nconst convRecSA = function(type, index, records) {\n  const conv = function (record) {\n    let fm = type === 'record' ? d.dm.r[index].fields : d.dm.b[index].fields;\n    let recout = {};\n    for (let j in record) {\n      for (let k in fm) {\n        if (fm[k].sfname === j) {\n          recout[k] = record[j];\n        }\n      }\n    }\n\n    return recout;\n  }\n\n  let recsout = [];\n  if (Array.isArray(records)) {\n    for (let i = 0; i < records.length; i++) {\n      recsout.push(conv(records[i]));\n    }\n  }\n\n  return recsout;\n};\n\nconst getBorR = function(rin) {\n  if (rin === undefined) rin = d.ri;\n\n  if (d.r[rin].type == 'record') {\n    return d.dm.r[d.r[rin].ri];\n  } else if (d.r[rin].type == 'base') {\n    return d.dm.b[d.r[rin].bi];\n  } else if (d.r[rin].type == 'search') {\n    return d.dm.b[d.r[rin].bi];\n  } else {\n    return false;\n  }\n};\n\nconst getFm = function(rin, fin) {\n  if (fin == undefined) {\n    rin = d.ri;\n    fin = d.fi;\n  }\n\n  if (d.r[rin].type == 'record') {\n    return d.dm.r[d.r[rin].ri].fields[fin];\n  } else if (d.r[rin].type == 'base') {\n    return d.dm.b[d.r[rin].bi].fields[fin];\n  } else if (d.r[rin].type == 'search') {\n    return d.dm.b[d.r[rin].bi].fields[fin];\n  } else {\n    return false;\n  }\n};\n\n\nconst parseLayout = function (layStr, fieldsArray) {\n  const parseLayoutIf = function (condition, trueresult, falseresult) {\n    let conditionArray = $.trim(condition).split('=');\n    if (!fieldsArray[conditionArray[0]]) {\n      return parseLayout(falseresult, fieldsArray);\n    }\n\n    if (conditionArray.length == 1) {\n      if ( fieldsArray[conditionArray[0]] ) {\n        return parseLayout(trueresult, fieldsArray);\n      } else {\n        return parseLayout(falseresult, fieldsArray);\n      }\n    } else if (conditionArray.length > 1) {\n      if (fieldsArray[conditionArray[0]] == conditionArray[1]) {\n        return parseLayout(trueresult, fieldsArray);\n      } else {\n        return parseLayout(falseresult, fieldsArray);\n      }\n    } else {\n      return \"#BAD CONDITION (else)#\";\n    }\n  };\n\n  let outStr = '';\n  let i;\n  let j;\n  let k;\n  let l;\n  let condition;\n  let hashctr;\n  let trueresult;\n  let falseresult;\n  for (i = 0; i < layStr.length; i++) {\n    if (layStr[i] === \"#\") {\n      i += 1;\n      if (layStr.slice(i, i + 2) === \"IF\") {\n        i += 2;\n        if (layStr[i] != \"(\") {\n          outStr += \"#BAD CONDITIONAL! (no opening parentheses)#\";\n          i -= 1;\n          continue;\n        } else {\n          j = i + 1;\n          while (j < layStr.length && layStr[j] != \")\") {\n            j += 1;\n          }\n\n          if (j === layStr.length) {\n            outStr+= \"#BAD CONDITIONAL! (no closing parentheses)#\";\n            i -= 1;\n            continue;\n          }\n\n          condition = layStr.slice(i + 1, j);\n          i = j + 1;\n          if (layStr[i] != \"{\") {\n            outStr+= \"#BAD CONDITIONAL! (no opening brackets for true)#\";\n            i -= 1;\n          } else {\n            i += 1;\n            k = i;\n            hashctr = 0;\n            while (k < layStr.length && (layStr[k] != \"}\" || hashctr > 0)) {\n              if (layStr[k] == \"#\") {\n                hashctr += 1;\n              }\n\n              if (layStr[k] == \"}\" && layStr[k + 1] != \"{\") {\n                hashctr -= 1;\n              }\n\n              k += 1;\n            }\n\n            if (k === layStr.length) {\n              outStr += \"#BAD CONDITIONAL! (no closing brackets for true)#\";\n              i -= 1;\n              continue;\n            }\n\n            trueresult = layStr.slice(i, k);\n            i = k + 1;\n            if (layStr[i] === \"{\") {\n              i += 1;\n              l = i;\n              hashctr = 0;\n\n              while (l < layStr.length && (layStr[l] != \"}\" || hashctr > 0)) {\n                if (layStr[l] == \"#\") {\n                  hashctr += 1;\n                }\n\n                if (layStr[l] == \"}\" && layStr[l + 1] != \"{\") {\n                  hashctr -= 1;\n                }\n\n                l += 1;\n              }\n\n              falseresult = layStr.slice(i, l);\n              i = l + 1;\n            } else {\n              falseresult = '';\n            }\n\n            i -= 1;\n            console.log(layStr[i]);\n            outStr += parseLayoutIf(condition, trueresult, falseresult);\n          }\n        }\n      } else if (layStr[i] === \"{\") {\n        i += 1;\n        j = i;\n        while (j < layStr.length && layStr[j] != \"}\") {\n          j += 1;\n        }\n\n        if (j === layStr.length) {\n          outStr+=\"#BAD FIELD#\";\n          i -= 1;\n          continue;\n        }\n\n        if (fieldsArray[layStr.slice(i, j)]) {\n          outStr += fieldsArray[layStr.slice(i, j)];\n        } else {\n          outStr += \"#BAD FIELD#\";\n        }\n\n        i = j;\n      } else {\n        outStr += \"#\";\n      }\n    } else {\n      outStr += layStr[i];\n    }\n  }\n\n  return outStr;\n};\n\nmodule.exports.convRecSA = convRecSA\nmodule.exports.getFieldsForLayout = getFieldsForLayout;\nmodule.exports.getBorR = getBorR;\nmodule.exports.getFm = getFm;\nmodule.exports.parseLayout = parseLayout;\n\n\n\n//# sourceURL=webpack:///./src/mapfunctions.js?");

/***/ }),

/***/ "./src/recarrayfunctions.js":
/*!**********************************!*\
  !*** ./src/recarrayfunctions.js ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst mf = __webpack_require__(/*! ./mapfunctions.js */ \"./src/mapfunctions.js\");\nconst sf = __webpack_require__(/*! ./searchfunctions.js */ \"./src/searchfunctions.js\");\nconst rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\n\n/** \n/* Resets the global record array and its index tracker, initializing it with base records set to\n * 'search.'\n */\nconst initR = function() {\n  d.r = [];\n  d.ri = 0;\n  addSearchRecords();\n  d.search = true;\n  d.sdata = { empty: true };\n  d.fi = d.r[d.ri].order[0];\n  rn.renderSfView();\n  rn.renderFldEntry();\n}\n\n/**\n * This monster of a function orders all of the records in r. It looks up the order fields in the\n * data map. \n */\nconst orderR = function() {\n  /** \n   * Function to move an element from one place in an array (from) to another (to). It does not\n   * delete the element at to, but shifts it up on place.\n   */\n  const rMove = function (from, to) {\n    if( !from || !to || from === to ) { return; }\n\n    d.r.splice( to, 0, d.r.splice(from, 1)[0] );\n  }\n\n  \n  // Main iterator loop: goes through each of the record types\n  for (let i = 0; i < d.dm.r.length; i++) {\n    // j will tell us which element in r is where the records of type r[i] begin\n    let j = 0;\n    // fmlist will be an array of fieldmaps (taken from dm) for the fields of each level of ordering\n    let fmlist = [];\n    const map = d.dm.r[i];\n    // order is an array of objects that have all necessary information about each level of ordering\n    const order = map.settings.listorder;\n\n    // Fill fmlist from the fieldmaps stored in map\n    for (let z = 0; z < order.length; z++) {\n      fmlist.push(map.fields[order[z].field]);\n    }\n    \n    // Advance j until we get to record type r[i]\n    for (j = d.dm.b.length; j < d.r.length && d.r[j].ri < i; j++);\n\n    // If we get to the last field, there is no ordering to do; we're finished\n    if (j == r.length -1 ) break;\n\n    /** \n     * For each record type, this next loop iterates through every level of ordering, starting with\n     * the last and ending with the first, ordering all records.\n     */\n    for(let m = order.length-1; m >= 0; m--) {\n      const type = fmlist[m].type;\n\n      // Climb up the record array dealing with each record until we hit the next record type\n      for (let k = j; k < d.r.length && d.r[k].ri === i; k++) {\n        // Get the value of the ordering field of the current record in our climb, depending on\n        // whether it is an index field, a regular field.\n        if (type === 'index') {\n          if(d.r[k].f[order[m].field].showval) {\n            var value1 = d.r[k].f[order[m].field].showval;\n          } else {\n            var value1 = '';\n          }\n        } else {\n          var value1 = d.r[k].f[order[m].field].value;\n        }\n\n        // Now search back down the record array for the right place to move the current record\n        for (let l = k - 1; l >= j; l--) {\n\n          // Get the value of ordering field for the record we are comparing the higher record\n          // to, just like we did above\n          if (type === 'index') {\n            // This time, we make a note of what the type of index field is, storing it in \n            // 'typetmp'\n            var typetmp = fmlist[m].indexfields[fmlist[m].indexshow].type;\n            if(d.r[l].f[order[m].field].showval) {\n              var value2 = d.r[l].f[order[m].field].showval;\n            } else {\n              var value2 = '';\n            }\n          } else {\n            var typetmp = type;\n            var value2 = d.r[l].f[order[m].field].value;\n          }\n\n          // For any empty values, we have to consult the 'empty' field in the ordering settings of\n          // our data map.\n          if (value1 === null || value1 === undefined || value1 === '') {\n            // If the bottom value is also empty: easy, just move right above it\n            if (value2 === null || value2 === undefined || value2 === '') {\n              rMove(k,l+1);\n              break;\n            // If the bottom value is not empty, decide whether or not to go past current field\n            } else if (order[m].empty) {\n              // If set to 'last', no need to move -- other fields will be moved past this one.\n              if ( order[m].empty == 'last' ) {\n                break;\n              // If set to 'first', send it past\n              } else if ( order[m].empty == 'first' ) {\n                // If this element is the last one, just move into its place\n                if( l == j ) {\n                  rMove(k,l);\n                  break;\n                // Other wise move on to the next to compare\n                } else {\n                  continue;\n                }\n              // If 'empty' setting is set to something else, just default to 'last'\n              } else {\n                break;\n              }\n            // If the 'empty' setting is missing, default to 'last'\n            } else {\n              break;\n            }\n          }\n\n          // What about if value1 is not empty but value2 is?\n          if ( value2 == null || value2 == undefined || value2 == '') {\n            if ( order[m].empty ) {\n              // If empty fields go last, bring the non-empty record past the empty one\n              if ( order[m].empty == 'last' ) {\n                continue;\n              // If empty fields go first, this is where we end: move the non-empty record just\n              // above the empty one\n              } else if ( order[m].empty == 'first' ) {\n                rMove(k,l+1);\n                break;\n              // If the 'empty' setting is set to something unrecognized, default to 'last'\n              } else {\n                rMove(k,l+1);\n                break;\n              }\n            // If 'empty' setting is missing, default to 'last'\n            } else {\n              continue;\n            }\n          }\n\n          // For date fields, we need to convert to a number to compare properly. We only need\n          // to make this alteration after dealing with empties (which don't require knowing \n          // actual values, but just whether a field is empty or not)\n          if(typetmp === 'date') {\n            value1 = new Date(value1).getTime();\n            value2 = new Date(value2).getTime();\n          }\n\n          // Now we compare and decide whether to move. If equal, move just above to preserve order\n          // (which would be set by lower-level ordering from last iteration of variable m)\n          if (value1 === value2) {\n            rMove(k,l+1);\n            break;\n          } else if (value1 > value2) {\n            if ( order[m].order === 'asc' ) {\n              rMove(k,l+1);\n              break;\n            } else {\n              if(l === j) { \n                rMove(k,l);\n                break; \n              } else {\n                continue;\n              }\n            }\n          } else if (value1 < value2) {\n            if ( order[m].order === 'desc' ) {\n              rMove(k, l+1);\n              break;\n            } else {\n              if(l == j) {\n                rMove(k,l);\n                break;\n              } else {\n                continue;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n// Check whether a record in r at index rin (i.e., r[rin]) is new or not\nconst isNew = function(rin) {\n  if(d.r[rin].new) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\n// Check whether a record in r at index rin has been changed from the original value pulled\n// from salesforce\nconst isChanged = function(rin) {\n  const map = getBorR(rin);\n\n  if (r[rin].new || !r[rin].f.Id) { \n    for (let i in r[rin].f) {\n      if(r[rin].f[i].changed) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  for (let i in r[rin].f) {\n    if (r[rin].f[i].changed) {\n      if(r[rin].f[i].value != r[rin].f[i].origval) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n\n// Check whether none of the records have been changed from their original values\nconst allUnchanged = function() {\n  for (let i in r) {\n    if (isChanged(i)) return false;\n  }\n\n  return true;\n}\n\nconst basesUpToDate = function() {\n  for (let i in dm.b) {\n    if(isChanged(i)) return false;\n  }\n\n  return true;\n}\n\nconst setValue = function(rin, fin, value) {\n  const fm = getFm(rin, fin);\n  let valout;\n\n  switch (fm.type) {\n    case \"text\":\n    case \"picklist\":\n    case \"index\":\n    case undefined: {\n      valout = value;\n      break;\n    };\n\n    case \"date\": {\n      if(value == '' || value == ' ') {\n        valout = null;\n        break;\n      }\n\n      const darr = value.split(\" \");\n      let d;\n      if (darr.length == 1) {\n        if (value < 9999 && value > 1000) {\n          d = new Date(\"Jan. 1, \" + value);\n        } else {\n          d = new Date(value);\n        }\n      } else if (darr.length == 2) {\n        if (darr[0].toUpperCase() == \"SPRING\") {\n          d = new Date(\"May 30, \" + darr[1]);\n        } else if (darr[0].toUpperCase() == \"SUMMER\") {\n          d = new Date(\"July 15, \" + darr[1]);\n        } else if (darr[0].toUpperCase() == \"FALL\") {\n          d = new Date(\"September 1, \" + darr[1]);\n        } else if (darr[0].toUpperCase() == \"WINTER\") {\n          d = new Date(\"December 15, \" + darr[1]);\n        }\n      } else {\n        d = new Date(value);\n      }\n\n      if ( !d || isNaN(d.getTime())) {\n        renderError(\"Not a valid date!\");\n        return false;\n      } else {\n        valout = d.toISOString();\n      }\n\n      break;\n    };\n\n    case \"email\": {\n      const re = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;\n      if (re.test(value)) {\n        valout = value;\n      } else {\n        renderError(\"Not a valid email address!\");\n        return false;\n      }\n\n      break;\n    };\n\n    default: \n      valout = value;\n      break;\n  }\n\n  r[rin].f[fin].value = valout;\n  r[rin].f[fin].changed = true;\n  setOrder(rin);\n  return true;\n};\n\nconst validateSelection = function(str) {\n  str = str.trim();\n  const $fldinput = $('.fldinput');\n  const type = getFm().type;\n  let outval = true;\n\n  // If fldinput is an <input> tag\n  if($fldinput.prop('nodeName') === 'INPUT') {\n    // If fldinput is of type \"text\"\n    if($fldinput.attr('type') === 'text') {\n      // Reject if there are any line breaks\n      if(str.indexOf('\\n') > -1) outval = false;\n      // Reject if it is longer than the 'size' attribute of the input\n      if(str.length > $fldinput.attr('size')) outval = false;\n    } \n\n  // If fldinput is a <select> tag\n  } else if($fldinput.prop('nodeName') === 'SELECT') {\n    outval = false;\n    $('.fldinput option').each(function(){\n      if (this.value == str) {\n        outval = true;\n      }\n    });\n  } \n\n  if(type === 'phone') {\n    if(str.length > 20) outval = false;\n    if(/[\\&\\@\\$\\%\\^\\{\\}]/.test(str)) outval = false;\n    if(!/\\d/.test(str)) outval = false;\n  } else if(type === 'date') {\n    if(str.length > 19) outval = false;\n  } else if(type === 'email') {\n    console.log('email');\n    const re = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;\n    if (!re.test(str)) outval = false;\n  } else if(type === 'url') {\n    console.log('url');\n    const re = /[\\s\\\"]+/\n    const re2 = /\\.+/\n    if (re.test(str)) outval = false;\n    if (!re2.test(str)) outval = false;\n  }\n\n  return outval;\n}\n\n// Cycle to the next ri up the record array (r), but add a new record of type dm.r[rin]\nconst nextrAndAdd = function(rin) {\n  if( rin < 0 || rin >= dm.r.length && d.r[d.ri].type == 'record' ) return false;\n\n  addRecord(rin);\n  if (isNew(d.ri) && !isChanged(d.ri)) { \n    r.splice(d.ri,1); \n  } else {\n    d.ri += 1;\n  }\n\n  d.fi = d.r[d.ri].order[0];\n  return true;\n}\n\n// Cycle to the next record without adding a new record\nconst nextrNoAdd = function() {\n  if (isNew(d.ri) && !isChanged(d.ri)) { \n    d.r.splice(d.ri, 1); \n  } else {\n    d.ri += 1;\n  }\n\n  d.fi = d.r[d.ri].order[0];\n  return true;\n}\n\n// Cycle to the next record (called when one presses the 'down' key -- see init.js)\nconst nextr = function() {\n  if (d.ri === d.r.length - 1) {\n    if ( d.ri >= d.dm.b.length ) {\n      if (!isNew(d.ri) || (isNew(d.ri) && isChanged(d.ri)) ) {\n        return nextrAndAdd(d.r[d.ri].ri)\n      } else if (d.r[d.ri].ri < d.dm.r.length - 1) {\n        return nextrAndAdd(d.r[d.ri].ri + 1);\n      } else {\n        return false;\n      }\n    } else if (d.ri < d.dm.b.length - 1) {\n      return false;\n    } else if (d.ri === d.dm.b.length - 1) {\n      if ( isNew(d.ri) ) { \n        return false;\n      } else { \n        return nextrAndAdd(0); \n      }\n    }\n  } else if (d.ri < d.r.length - 1) {\n    if ( d.r[d.ri+1].d.ri === d.r[d.ri].ri || d.r[ri].type === 'base' ) {      \n      return nextrNoAdd();\n    } else if (!isNew(d.ri) || (isNew(d.ri) && isChanged(d.ri)) ) {\n      return nextrAndAdd(d.r[d.ri].ri);\n    } else if (d.r[d.ri + 1].ri === d.r[d.ri].ri + 1) {\n      return nextrNoAdd(); \n    } else {\n      return nextrAndAdd(d.r[d.ri].ri + 1);\n    }\n  }\n\n  return false;\n};\n\n// \nconst prevrAndAdd = function(rin) {\n  if(rin < 0 || rin >= dm.r.length) return false;\n\n  addRecord(rin);\n  if (isNew(d.ri + 1) && !isChanged(d.ri + 1)) { \n    d.r.splice(d.ri + 1, 1); \n  }\n\n  d.fi = d.r[d.ri].order[0];\n  return true;\n}\n\n//\nconst prevrNoAdd = function() {\n  if (isNew(d.ri) && !isChanged(d.ri) && d.r[d.ri].type === 'record') { \n    d.r.splice(d.ri, 1); \n  }\n\n  d.ri -= 1;\n  d.fi = d.r[d.ri].order[0];\n  return true;\n}\n\n// \nconst prevr = function() {\n  if(d.ri === 0) {\n    return false;\n  } else if ( d.ri < d.dm.b.length ) {\n    prevrNoAdd();\n  } else {\n    if(d.r[d.ri].ri === 0 || d.r[d.ri - 1].ri === d.r[d.ri].ri || (isNew(d.ri - 1) && !isChanged(d.ri - 1))) {\n      prevrNoAdd();\n    } else {\n      prevrAndAdd(d.r[d.ri].ri - 1);\n    }\n  }\n\n  return true;\n};\n\n// \nconst nextf = function() {\n  if (fi === d.r[d.ri].order[d.r[d.ri].order.length - 1]) {\n    return nextr();\n  } else {\n    for (var i = 0; i < d.r[d.ri].order.length; i++) {\n      if (d.fi === d.r[d.ri].order[i]) {\n        d.fi = d.r[d.ri].order[i + 1];\n        break;\n      }\n    }\n  }\n\n  return true;\n};\n\nconst prevf = function() {\n  if (d.fi === d.r[d.ri].order[0]) {\n    if (!prevr()) {\n      return false;\n    } else {\n      d.fi = d.r[d.ri].order[d.r[d.ri].order.length - 1];\n      return true;\n    }\n  } else {\n    for (var i = 0; i < d.r[d.ri].order.length; i++) {\n      if (d.fi === d.r[d.ri].order[i]) {\n        d.fi = d.r[d.ri].order[i - 1];\n        break;\n      }\n    }\n  }\n\n  return true;\n};\n\nconst jumpTo = function(rin) {\n  if(!d.r[rin]) return false;\n\n  d.ri = rin;\n  d.fi = d.r[rin].order[0];\n  return true;\n}\n\nconst setOrder = function(rInd) {\n  if( rInd == undefined ) rInd = d.ri;\n\n  let makeOrderArray = function(om, f) {\n    let out = [];\n    for (let i = 0; i < om.length; i++) {\n      out.push(om[i].field);\n      if (om[i].autofill && !f[om[i].field].origval) {\n        if (om[i].autofill.condition === \"filled\") {\n          if (f[om[i].autofill.conditionfield].value && om[i].autofill.true) {\n            f[om[i].field].value = om[i].autofill.true;\n          } else if (\n            !f[om[i].autofill.conditionfield].value &&\n            om[i].autofill.false\n          ) {\n            f[om[i].field].value = om[i].autofill.false;\n          }\n        }\n      }\n      if (om[i].condition) {\n        if (om[i].condition === \"filled\") {\n          if (f[om[i].field].value && om[i].true) {\n            out = out.concat(makeOrderArray(om[i].true, f));\n          } else if (!f[om[i].field].value && om[i].false) {\n            out = out.concat(makeOrderArray(om[i].false, f));\n          }\n        } else if (om[i].condition === \"switch\") {\n          for (let j = 0; j < om[i].switch.length; j++) {\n            for (let k = 0; k < om[i].switch[j].value.length; k++) {\n              if (f[om[i].field].value == om[i].switch[j].value[k]) {\n                out = out.concat(makeOrderArray(om[i].switch[j].order, f));\n                break;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return out;\n  };\n\n  let rec = d.r[rInd];\n  let recm;\n  let order;\n  if (rec.type === \"base\") {\n    recm = d.dm.b[rec.bi];\n    orderm = recm.settings.order;\n  } else if (rec.type === \"search\") {\n    recm = d.dm.b[rec.bi];\n    orderm = recm.settings.searchorder;\n  } else if (rec.type === \"record\") {\n    recm = d.dm.r[rec.ri];\n    orderm = recm.settings.order;\n  }\n\n  rec.order = makeOrderArray(orderm, d.r[rInd].f);\n};\n\nconst pushNewRec = function(rInd) {\n  for (let i = 0; i < d.r.length; i++) {\n    if (d.r[i].ri) {\n      if (d.r[i].ri > i) {\n        d.r.splice(i, 0, {\n          type: \"record\",\n          ri: rInd,\n          new: true,\n          order: [],\n          f: {}\n        });\n\n        for (let j in d.dm.r[i].fields) {\n          d.r[i].f[j] = {\n            sfname: d.dm.r[i].fields[j].sfname,\n            value: null\n          };\n        }\n\n        setOrder(i);\n        return i;\n      }\n    }\n  }\n\n  r.push({\n    type: \"record\",\n    ri: rInd,\n    new: true,\n    order: [],\n    f: {}\n  });\n\n  for (let j in d.dm.r[rInd].fields) {\n    d.r[d.r.length - 1].f[j] = {\n      sfname: d.dm.r[d.r.length - 1].fields[j].sfname,\n      value: null\n    };\n  }\n\n  setOrder(d.r.length - 1);\n  return d.r.length - 1;\n};\n\nconst addSearchRecords = function() {\n  for (let i = 0; i < d.dm.b.length; i++) {\n    r.push({\n      type: \"search\",\n      bi: i,\n      new: true,\n      order: [],\n      f: {}\n    });\n\n    for (let j in d.dm.b[i].fields) {\n      d.r[i].f[j] = {\n        sfname: d.dm.b[i].fields[j].sfname,\n      };\n      if(d.dm.b[i].fields[j].value) {\n        d.r[i].f[j].value = d.dm.b[i].fields[j].value;\n      } else {\n        d.r[i].f[j].value = null;\n        d.r[i].f[j].origval = null;\n      }\n    }\n\n    setOrder(i);\n  }\n\n  d.ri = 0;\n  d.fi = d.r[ri].order[0];\n};\n\nconst addBaseRecord = function(bInd, bRec) {\n  for (let i = 0; i < d.r.length; i++) {\n    if (d.r[i].bi == bInd) {\n      // use Array.splice() to replace the base record with one that's filled out\n      d.r.splice(i, 1, {\n        type: \"base\",\n        bi: i,\n        new: false,\n        order: [],\n        f: {},\n      });\n      \n      for (let j in d.dm.b[i].fields) {\n        d.r[i].f[j] = {\n          sfname: d.dm.b[i].fields[j].sfname,\n        };\n        if(bRec) {\n          d.r[i].f[j].value = bRec[d.dm.b[i].fields[j].sfname];\n          d.r[i].f[j].origval = bRec[d.dm.b[i].fields[j].sfname];\n        } else if (d.dm.b[i].fields[j].value) {\n          d.r[i].f[j].value = d.dm.b[i].fields[j].value;\n        } else {\n          d.r[i].f[j].value = null;\n          d.r[i].f[j].origval = null;\n        }\n      };\n\n      setOrder(i);\n      for (let j = 0; j < d.r.length; j++) {\n        if (d.r[j].type === \"search\") {\n          d.ri = j;\n          d.fi = d.r[j].order[0];\n\n          return true;\n        }\n      }\n\n      if(d.search) { \n        sf.clearBaseSearch();\n        d.fi = r[i].order[0];\n        sf.loadAllRecords(); \n      }\n\n      return true;\n    }\n  }\n\n  return false;\n};\n\nconst addRecord = function(rInd, rec) {\n  let i = d.dm.b.length;\n  // Decide where in the r array we will insert the new record. This loop keeps counting up until\n  // a) we exceed the length of the array, b) we reach the next higher record type, or c) we get to\n  // a record in the array of the same type and with the same sf Id as the record to be inserted.\n  while( i < d.r.length ) {\n    if ( !rec ) {\n      if (d.r[i].ri <= rInd) {\n        i += 1;\n      } else {\n        break;\n      }\n    } else if (d.r[i].ri <= rInd && !( d.r[i].ri === rInd && d.r[i].f.Id.value === rec.Id ) ) {\n      i++;\n    } else {\n      break;\n    }\n  }  \n\n  if ( i === d.r.length ) { \n    d.r.push({\n      type: \"record\",\n      ri: rInd,\n      order: [],\n      f: {},\n    }); \n  } else if( d.r[i].ri === rInd && d.r[i].f.Id.value === rec.Id ) {\n    d.r.splice(i, 1, { // replace the record, if it has the same id\n      type: \"record\",\n      ri: rInd,\n      order: [],\n      f: {},\n    });\n  } else {\n    d.r.splice(i, 0, { // otherwise, insert without deleting anything\n      type: \"record\",\n      ri: rInd,\n      order: [],\n      f: {},\n    });\n  }\n  \n\n  if (!rec) {\n    d.r[i].new = true;\n  } else {\n    d.r[i].new = false;\n  }\n\n  for (let j in d.dm.r[rInd].fields) {\n    d.r[i].f[j] = {};\n\n    d.r[i].f[j].sfname = d.dm.r[rInd].fields[j].sfname;\n\n    if (d.r[i].new) {\n      if (d.dm.r[rInd].fields[j].inherits) {\n        d.r[i].f[j].value = d.r[d.dm.r[rInd].fields[j].inherits.base].f[d.dm.r[rInd].fields[j].inherits.field].value;\n      } else if(d.dm.r[rInd].fields[j].autofill) {\n        d.r[i].f[j].value = d.r[d.dm.r[rInd].fields[j].autofill.base].f[d.dm.r[rInd].fields[j].autofill.field].value;\n      } else if (d.dm.r[rInd].fields[j].value) {\n        d.r[i].f[j].value = d.dm.r[rInd].fields[j].value;\n      } else if (d.dm.r[rInd].fields[j].default) {\n        d.r[i].f[j].value = d.dm.r[rInd].fields[j].default;\n      } else {\n        d.r[i].f[j].value = null;\n      }\n    } else {\n      d.r[i].f[j].value = rec[d.dm.r[rInd].fields[j].sfname];\n      d.r[i].f[j].origval = rec[d.dm.r[rInd].fields[j].sfname];\n    }\n  }\n  \n  setOrder(i);\n  return true;\n};\n\nconst updateIndexFields = function (callback, rin) {\n  if (!callback || typeof(callback) !== 'function') return false;\n\n  renderLoadingStart('Looking up index fields');\n  let ctr = 0;\n  let total = 0;\n  if( rin !== undefined && rin < r.length ) {\n    let map = rf.getBorR(rin);\n    for(let j in d.r[rin].f) {\n      if ( map.fields[j].type === 'index' && d.r[rin].f[j].value ) total += 1;\n    }\n\n    if (total === 0) { \n      rn.renderLoadingEnd();\n      callback();\n      return;\n    }\n\n    for(let j in r[rin].f) {\n      if (map.fields[j].type === 'index' && d.r[rin].f[j].value) {\n        let fieldsvar = {};\n        let callback;\n        fieldsvar[map.fields[j].indexshow] = 1;\n        $.ajax({\n          type: \"POST\",\n          contentType: \"application/json\",\n          url: \"/api/find\",\n          dataType: \"json\",\n          async: true,\n          //json object to sent to the authentication url\n          data: JSON.stringify({\n            sobject: map.fields[j].indexto,\n            conditions: { Id: d.r[i].f[j].value },\n            fields: fieldsvar,\n          }),\n          success: (data) => {\n            ctr += 1;\n\n            if(data[0]) {\n              d.r[i].f[j].showval = data[0][map.fields[j].indexshow];\n            }\n\n            if (ctr === total) {\n              rn.renderLoadingEnd();\n              callback();\n            }\n          },\n        });\n      }\n    }\n\n    return true;\n  }\n\n  total = 0;\n  ctr = 0;\n\n  for(let i in r) {\n    let map = mf.getBorR(i);\n    for( let j in r[i].f ) {\n      if ( map.fields[j].type == 'index' && r[i].f[j].value ) total += 1;\n    }\n  }\n\n  if (total === 0) { \n    rn.renderLoadingEnd();\n    callback();\n    return;\n  }\n\n  for(let i in r) {\n    let map = mf.getBorR(i);\n    for(let j in r[i].f) {\n      if ( map.fields[j].type == 'index' && r[i].f[j].value ) {\n        let fieldsvar = {};\n        fieldsvar[map.fields[j].indexshow] = 1;\n        $.ajax({\n          type: \"POST\",\n          contentType: \"application/json\",\n          url: \"/api/find\",\n          dataType: \"json\",\n          async: true,\n          //json object to sent to the authentication url\n          data: JSON.stringify({\n            sobject: map.fields[j].indexto,\n            conditions: { Id: d.r[i].f[j].value },\n            fields: fieldsvar,\n          }),\n          success: (data) => {\n            ctr += 1;\n\n            if(data[0]) {\n              d.r[i].f[j].showval = data[0][map.fields[j].indexshow];\n            }\n\n            if (ctr === total) {\n              rn.renderLoadingEnd();\n              callback();\n            }\n          }\n        });\n      \n      }\n    \n    }\n  \n  }\n}\n\nconst updateR = function() {\n  fm = mf.getFm();\n  if (!d.r[d.ri].f[d.fi].origval || d.r[d.ri].f[d.fi].value != d.r[d.ri].f[d.fi].origval) {\n    if (d.r[d.ri].type === \"search\" && d.r[d.ri].new) {\n      return sf.searchBase(d.ri);\n    }\n  }\n\n  return true;\n};\n\nmodule.exports.initR = initR;\nmodule.exports.orderR = orderR;\nmodule.exports.isNew = isNew;\nmodule.exports.isChanged = isChanged;\nmodule.exports.allUnchanged = allUnchanged;\nmodule.exports.basesUpToDate = basesUpToDate;\nmodule.exports.setValue = setValue;\nmodule.exports.validateSelection = validateSelection;\nmodule.exports.nextrAndAdd = nextrAndAdd;\nmodule.exports.nextrNoAdd = nextrNoAdd;\nmodule.exports.nextr = nextr;\nmodule.exports.prevrAndAdd = prevrAndAdd;\nmodule.exports.prevrNoAdd = prevrNoAdd;\nmodule.exports.prevr = prevf;\nmodule.exports.nextf = nextf;\nmodule.exports.prevf = prevf;\nmodule.exports.jumpTo = jumpTo;\nmodule.exports.setOrder = setOrder;\nmodule.exports.addSearchRecords = addSearchRecords;\nmodule.exports.addBaseRecord = addBaseRecord;\nmodule.exports.addRecord = addRecord;\nmodule.exports.updateIndexFields = updateIndexFields;\nmodule.exports.updateR = updateR;\n\n\n//# sourceURL=webpack:///./src/recarrayfunctions.js?");

/***/ }),

/***/ "./src/render.js":
/*!***********************!*\
  !*** ./src/render.js ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst mf = __webpack_require__(/*! ./mapfunctions.js */ \"./src/mapfunctions.js\");\nconst sf = __webpack_require__(/*! ./searchfunctions.js */ \"./src/searchfunctions.js\");\nconst rf = __webpack_require__(/*! ./recarrayfunctions.js */ \"./src/recarrayfunctions.js\");\nconst uf = __webpack_require__(/*! ./upsertfunctions.js */ \"./src/upsertfunctions.js\");\nconst ef = __webpack_require__(/*! ./eventfunctions.js */ \"./src/eventfunctions.js\");\n\nconst renderDoc = function(site) {\n  $('.pdfwin').empty();\n  if(site === undefined) {\n    $(\".pdfwin\").append('<iframe id=\"pdfiframe\" height=\"100%\" width=\"100%\" src=\"/doc/view\"></iframe>');\n  } else {\n    $(\".pdfwin\").append('<iframe id=\"pdfiframe\" height=\"100%\" width=\"100%\" src=\"'+site+'\"></iframe>');\n  }\n\n  $('#pdfiframe').on('load', function () {\n    \n    $(\"#pdfiframe\")\n      .contents()\n      .find(\"body\")\n      .off()\n      .mouseup(function(e) {\n        let doc = document.getElementById(\"pdfiframe\").contentDocument;\n        let selec = doc.getSelection();\n        let txt = selec.toString();\n        if(!txt) { return; }\n\n        if(mdownpos === []) mdownpos = [e.pageX, e.pageY];\n        \n        if(!validateSelection(txt)) {\n          renderSelectionErr(selec);\n          selec.collapseToStart();\n          $('.fldwin').attr(\"tabindex\",-1).focus();\n          return;\n        }\n\n        $(\".fldinput\").val(txt);\n        $(\".fldinput\").change();\n        selec.collapseToStart();\n        $('.fldwin').attr(\"tabindex\",-1).focus();\n        mdownpos = [];\n      });\n\n    $('#pdfiframe').contents().find('body').mousedown(function (e) {\n      mdownpos = [e.pageX, e.pageY];\n      $('#selecpopup').remove();\n    });\n  \n  });\n  \n};\n\nconst renderSelectionErr = function(selec) {\n  const fname = getFm().appname;\n  const $mainwin = $('.mainwin');\n  const $iframe = $('.pdfwin');\n  $mainwin.append('<div id=\"selecpopup\" style=\"position:absolute;display:none;z-index:100;background-color:yellow;\"><b>Invalid selection for field: \"'+fname+'\"</b></div>');\n  const $popup = $('#selecpopup');\n  $('#selecpopup').offset({ top: $iframe.position().top + mdownpos[1] - 45, left: $iframe.position().left + mdownpos[0] - 100}).show();\n  setTimeout(()=>{\n    $('#selecpopup').fadeOut('slow',()=>{\n      $('#selecpopup').remove();\n    });\n  }, 2000);\n\n\n}\n\nvar renderError = function(msg) {\n  $(\".error-body\").empty();\n  $(\".error-body\").append(msg);\n  $(\".error\").modal(\"show\");\n};\n\nvar renderAlert = function(msg, callback) {\n  $(\".alert-body\").empty();\n  $(\".alert-body\").append(msg);\n  $(\".alert\").modal(\"show\");\n  $('.alert-execute').off().click(function () {\n    $('.alert').modal('hide');\n    if(callback) { callback(); }\n  });\n};\n\nvar renderOpenUrl = function() {\n  $('.openurl-input').val('');\n  $('.openurlmodal').modal('show');\n  $('.openurl-open-btn').off().click(function () {\n    $('.openurlmodal').modal('hide');\n    renderDoc($('.openurl-input').val());\n  });\n};\n\nvar renderLoadingStart = function(msg) {\n\n  $('.ld-msg').empty();\n  $('.ld-msg').append(msg);\n  $('.loading').modal('show');\n  setTimeout(function () {\n    renderLoadingEnd();\n  }, 10000);\n\n}\n\nvar renderLoadingEnd = function() {\n\n  setTimeout(function() {\n    $('.loading').modal('hide');\n  }, 200);\n  $('.ld-msg').empty();\n  \n\n}\n\nvar renderBaseSearch = function() {\n  var map = mf.getBorR();\n\n  var riloc = d.ri;\n  var filoc = d.fi;\n\n  $(\".sfviewmenu\").empty();\n\n  if ( d.r[ri].type == 'search' ) {\n    $(\".sfviewmenu\").append(\n      '<button type=\"button\" class=\"btn btn-primary newbase-button\">New</button'\n    );\n\n    $(\".newbase-button\").off().click(function() {\n      d.r[riloc].type = 'base';\n      setOrder(riloc);\n      d.fi = r[riloc].order[0];\n      renderFldEntry();\n      renderSfView();\n    });\n\n    $(\".sfviewbody\").empty();\n    $(\".sfviewbody\").append(\n      \"<h4>Find or Create \" + map.appname + \" (\" + map.sobject + \")</h4>\"\n    );\n\n    if (d.sdata.empty) {\n      return false;\n    }\n\n    for (let i = 0; i < d.sdata.records.length; i++) {\n      $(\".sfviewbody\").append(\n        '<div class=\"search-result\" data-id=\"' +\n          d.sdata.records[i][\"Id\"] +\n          '\" id=\"sresult' +\n          i +\n          '\"></div>'\n      );\n      for (var j in d.sdata.layout) {\n        $(\"#sresult\" + i).append(\n          \"<div>\" + parseLayout(d.sdata.layout[j], d.sdata.records[i]) + \"</div>\"\n        );\n      }\n      $(\"#sresult\" + i).off().click(function() {\n        $.event.trigger({\n          type: \"searchSelect\",\n          Id: d.sdata.records[i][\"Id\"]\n        });\n      });\n    }\n  } else {\n    $(\".sfviewmenu\").append(\n      '<button type=\"button\" class=\"btn btn-primary createbase-button\">Add to Salesforce</button'\n    );\n\n    $(\".createbase-button\").off().click(function() {\n      renderLoadingStart();\n      uf.updateRecord(riloc, function(data, rin){\n        renderLoadingEnd();\n        console.log('Created contact record!');\n        console.log(data);\n        console.log(rin);\n        if(data[0]) {\n          if(data[0].id) {\n            setValue(rin, 'Id', data[0].id);\n            d.r[rin].new = false;\n            sf.loadAllRecords();\n          }\n        }\n      });\n    });\n\n    $(\".sfviewbody\").empty();\n    $(\".sfviewbody\").append(\n      \"<h4>Add \" + map.appname + \" (\" + map.sobject + \") to Salesforce</h4>\"\n    );\n  }  \n  \n};\n\nvar renderSfView = function() {\n\n  /*if (init) {\n    $(\".sfviewmenu\").empty();\n    $(\".sfviewbody\").empty();\n    return;\n  }*/\n\n  if (d.search) {\n    return renderBaseSearch();\n  }\n\n  if( d.ri >= d.r.length ) d.ri = d.r.length-1;\n  if( d.ri < 0 ) d.ri = 0;\n\n  $(\".sfviewmenu\").empty();\n\n  $(\".sfviewmenu\").append(\n    '<button type=\"button\" class=\"btn btn-primary saveall-button\" style=\"margin-right:5px;\">Save All</button'\n  );\n  $('.saveall-button').off().click(function(){\n    uf.updateAll();\n  });\n\n  $(\".sfviewmenu\").append(\n    '<button type=\"button\" class=\"btn btn-primary refresh-button\">Refresh</button'\n  );\n  $('.refresh-button').off().click(function(){\n    sf.loadAllRecords();\n  });\n\n  $(\".sfviewbody\").empty();\n\n  for (let i = 0; i < d.dm.b.length; i++) {\n    $(\".sfviewbody\").append(\n      '<div class=\"sfview-header sfview-base-box\" id=\"sfview-hdr-b-' + i + '\"></div>'\n    );\n    $(\"#sfview-hdr-b-\" + i).append(\"<h4>\" + d.dm.b[i].appname + \"</h4>\");\n    for( var j = 0; j < d.dm.b[i].settings.layout.length; j++ ) {\n      $(\"#sfview-hdr-b-\" + i).append('<div>'+parseLayout( d.dm.b[i].settings.layout[j], mf.getFieldsForLayout(i) )+'</div>');\n    }\n    $(\"#sfview-hdr-b-\" + i).attr('style','cursor:pointer');\n    $(\"#sfview-hdr-b-\" + i).off().click(function() {\n      rf.jumpTo(i);\n      renderFldEntry();\n      renderSfView();\n    });\n    if( d.ri == i ) {\n      $('#sfview-hdr-b-' + i).attr('style','border:2px solid red;');\n    }\n  }\n\n  for (let i = 0; i < d.dm.r.length; i++) {\n    $(\".sfviewbody\").append(\n      '<div class=\"sfview-header\" id=\"sfview-hdr-r-' + i + '\"></div>'\n    );\n    $(\"#sfview-hdr-r-\" + i).append(\"<h4>\" + d.dm.r[i].appname + \"</h4>\");\n  }\n\n  for (let i = d.dm.b.length; i < d.r.length; i++) {\n    $(\"#sfview-hdr-r-\" + d.r[i].ri).append('<div class=\"sfview-record\" id=\"sfview-rec-' + i + '\"></div>');\n    for ( let j = 0; j < d.dm.r[d.r[i].ri].settings.layout.length; j++ ) {\n      $(\"#sfview-rec-\" + i).append('<div>'+parseLayout( d.dm.r[d.r[i].ri].settings.layout[j], getFieldsForLayout(i) )+'</div>');\n    }\n    $('#sfview-rec-'+i).off().click(function(){\n      jumpTo(i);\n      renderFldEntry();\n      renderSfView();\n    });\n    if( d.ri == i ) {\n      $('#sfview-rec-' + i).attr('style','border: 2px solid red;');\n    }\n  }\n\n  var currentScrollTop = $('.sfviewbody').scrollTop();\n\n  if( d.ri < d.dm.b.length ) {\n    var selElement = $('#sfview-hdr-b-' + ri);\n  } else {\n    var selElement = $('#sfview-rec-' + ri);\n  }\n\n  var offsettop = selElement.offset().top - $('.sfviewbody').offset().top;\n  var offsetbottom = offsettop + selElement.height();\n\n  if( offsetbottom > $('.sfviewbody').innerHeight() ) {\n    $('.sfviewbody').scrollTop(currentScrollTop + offsetbottom - $('.sfviewbody').innerHeight() + 5);\n  } else if ( offsettop < 0 ) {\n    $('.sfviewbody').scrollTop(currentScrollTop + offsettop);\n  }\n  \n\n};\n\nvar convertDate = function(strin) {\n\n  var date = new Date(strin);\n\n  var months = ['Jan.','Feb.','Mar.','Apr.','May','June','July','Aug.','Sep.','Oct.','Nov.','Dec.'];\n\n  return months[date.getMonth()]+' '+date.getDate()+', '+date.getFullYear();\n\n}\n\nvar renderFldEntry = function() {\n\n  /*if ( d.length == 0 ) {\n    $(\".fldwinleft\").empty();\n    $(\".fldwinright\").empty();\n    $(\".fldtitle\").empty();\n    $(\".fldentry\").empty();\n    $(\".fldinstr\").empty();\n    return;\n  }*/\n\n  if( d.ri >= d.r.length ) d.ri = d.r.length-1;\n  if( d.ri < 0 ) d.ri = 0;\n\n  $(\".fldwinleft\").empty();\n  if (d.ri != 0 || d.fi != d.r[0].order[0]) {\n    $(\".fldwinleft\").append('<a class=\"btn btn-primary\" href=\"#\" id=\"prevlink\"><</a>');\n    $(\"#prevlink\").off().click(function() {\n      rf.updateR();\n      rf.setOrder();\n      rf.prevf();\n      renderFldEntry();\n      renderSfView();\n    });\n  }\n\n  $(\".fldwinright\").empty();\n  if (\n    d.ri < d.r.length - 1 ||\n    d.fi != d.r[d.r.length - 1].order[d.r[d.r.length - 1].order.length - 1]\n  ) {\n    $(\".fldwinright\").append('<a class=\"btn btn-primary\" href=\"#\" id=\"nextlink\">></a>');\n    $(\"#nextlink\").off().click(function() {\n      rf.updateR();\n      rf.setOrder();\n      rf.nextf();\n      renderFldEntry();\n      renderSfView();\n    });\n  }\n\n  var rec = d.r[d.ri];\n  var rmap = fm.getBorR();\n\n  $(\".fldtitle\").empty();\n  $(\".fldtitle\").append(\"<h4>\" + rmap.fields[d.fi].appname + \"</h4>\");\n\n  $(\".fldinstr\").empty();\n  if (rmap.fields[d.fi].instructions) {\n    $(\".fldinstr\").append(\"<p>\" + rmap.fields[d.fi].instructions + \"</p>\");\n  }\n\n  $(\".fldentry\").empty();\n  switch (rmap.fields[d.fi].type) {\n    case \"text\":\n      if (rmap.fields[d.fi].length > 260) {\n        var fldinput = '<textarea style=\"resize: none\" rows=\"5\" cols=\"45\" ';\n      } else {\n        var fldinput = '<input type=\"text\" size=\"45\" ';\n      }\n      fldinput +=\n        'class=\"fldinput\" maxlength = \"' + rmap.fields[d.fi].length + '\" > ';\n      break;\n    case \"phone\":\n      var fldinput = '<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"40\">';\n      break;\n    case \"url\":\n      var fldinput = '<input class=\"fldinput\" type=\"text\" size=\"50\">';\n      break;\n    case \"email\":\n      var fldinput =\n        '<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"' +\n        rmap.fields[d.fi].length +\n        '\">';\n      break;\n    case \"picklist\":\n      var fldinput = '<select class=\"fldinput\">';\n      fldinput += '<option value=\"\">None</option>';\n      for (var i = 0; i < rmap.fields[d.fi].values.length; i++) {\n        fldinput += \"<option>\" + rmap.fields[d.fi].values[i] + \"</option>\";\n      }\n      fldinput += \"</select>\";\n      break;\n    case \"date\":\n      var fldinput = '<input class=\"fldinput\" type=\"text\" maxlength=\"100\">';\n      break;\n    case \"index\":\n      var fldinput =\n        '<input class=\"fldinput\" type=\"text\" size=\"45\" maxlength=\"255\">';\n      break;\n    case \"boolean\":\n      var fldinput =\n        '<input class=\"fldinput\" type=\"checkbox\" >';\n        break;\n    default:\n      break;\n  }\n  $(\".fldentry\").append(fldinput);\n  if (d.r[d.ri].f[d.fi].value) {\n    if ( rmap.fields[d.fi].type == 'index' ) {\n      if (d.r[ri].f[fi].showval ) {\n        $('.fldinput').val(d.r[d.ri].f[d.fi].showval);\n      }\n    } else if ( rmap.fields[d.fi].type == 'date' ) {\n      $('.fldinput').val(convertDate(d.r[d.ri].f[d.fi].value));\n    } else if(rmap.fields[d.fi].type == 'boolean' ) {\n      if ( d.r[d.ri].f[d.fi].value ) { $('.fldinput').prop('checked',true); } else { $('.fldinput').prop('checked',false); }\n    } else {\n      $(\".fldinput\").val(d.r[d.ri].f[d.fi].value);\n    }\n  }\n\n  let rin = d.ri;\n  let fin = d.fi;\n  let so = rmap.fields[d.fin].indexto;\n\n  $(\".fldinput\").off().change(function() {\n    if (rmap.fields[fin].type == \"index\") {\n      if ($('.fldinput').val() == '') {\n        d.r[rin].f[fin].showval = null;\n        d.r[rin].f[fin].value = null;\n        rf.updateR();\n        rf.setOrder();\n        rf.nextf();\n        renderFldEntry();\n        renderSfView();\n        return;\n      }\n      d.r[rin].f[fin].showval = $('.fldinput').val();\n      sf.searchIndexRecord(rin, fin);\n      return;\n    }\n    if(rmap.fields[fin].type == \"boolean\") {\n      d.r[rin].f[fin].value = $(\".fldinput\").prop('checked');\n      return\n    }\n    if (setValue(rin, fin, $(\".fldinput\").val())) {\n      rf.updateR();\n      rf.setOrder();\n      rf.nextf();\n      renderFldEntry();\n      renderSfView();\n    }\n  });\n};\n\nvar renderIndexSearch = function(rin, fin, records) {\n  var fm = mf.getFm(rin, fin);\n\n  $(\".insrch-title\").empty();\n  $(\".insrch-body\").empty();\n\n  $(\".insrch-title\").prepend('Searching for ' + fm.indexto );\n  $('.insrch').modal('show');\n\n  for (let i = 0; i < records.length; i++) {\n    $(\".insrch-body\").append('<div class=\"insresult\" id=\"insresult' + i + '\"></div>');\n    for ( let j = 0; j < fm.searchlayout.length; j++ ) {\n      $(\"#insresult\" + i).append('<span>'+parseLayout(fm.searchlayout[j], records[i])+'</span>');\n    }\n    $('#insresult' + i).off().click( function () {\n      indexSearchSelected( rin, fin, records[i] );\n      $('.insrch').modal('hide');\n    });\n  }\n  $('.insrch-create-btn').off().click(function() {\n    renderIndexCreate(rin, fin);\n  });\n};\n\nvar renderIndexCreate = function(rin, fin) {\n  var map = fm.getBorR(rin);\n  var fm = fm.getFm(rin, fin);\n\n  $(\".increate-title\").empty();\n  $('.increate-body').empty();\n\n\n  $(\".increate-title\").append(\"Create new \" + fm.appname + \" record\");\n\n  var recordObj = {};\n  recordObj.sobject = fm.indexto;\n  recordObj.record = {};\n  for ( let i = 0; i < fm.createfields.length; i++ ) {\n    $('.increate-body').append('<div id=\"increate-fld-'+i+'\"></div>');\n    $('#increate-fld-'+i).append('<h5 id=\"increate-fldtitle-'+i+'\"></h5>');\n    $('#increate-fld-' + i).append('<input type=\"text\" size=\"45\" id=\"increate-fldinput-'+i+'\">');\n    $(\"#increate-fldtitle-\"+i).append(fm.createfields[i] + ':' );\n    if(fm.createfields[i] == fm.indexshow) {\n      $(\"#increate-fldinput-\"+i).val($('.fldinput').val());\n    }\n  }\n  $('.increate-create-btn').off().click(function() {\n\n    var apiObj = {\n      sobject: fm.indexto,\n      records: [{}]\n    }\n    \n    for( var j = 0; j < fm.createfields.length; j++ ) {\n      if($('#increate-fldinput-'+j).val()) {\n        apiObj.records[0][fm.createfields[j]] = $('#increate-fldinput-'+j).val();\n      }\n    }\n\n    for( var k in fm.indexfields ) {\n      if( fm.indexfields[k].value ) {\n        apiObj.records[0][k] = fm.indexfields[k].value;\n      }\n    }\n\n    renderLoadingStart('Creating '+fm.appname+' record');\n    $.ajax({\n      type: \"POST\",\n      contentType: \"application/json\",\n      url: \"/api/create\",\n      dataType: \"json\",\n      async: true,\n      //json object to sent to the authentication url\n      data: JSON.stringify(apiObj),\n      success: function (data) {\n        renderLoadingEnd();\n        if( data[0].err || !data[0].success) {\n          renderError('Could not create '+fm.indexto+': ' + data[0].err );\n          return false;\n        }\n\n        $('.increate').modal('hide');\n        rf.setValue(rin, fin, data[0].id);\n        d.r[rin].f[fin].showval = apiObj.records[0][fm.indexshow];\n        renderFldEntry();\n        renderSfView();\n      }\n    });\n\n  });\n\n  $('.increate').modal('show');\n\n};\n\nvar renderAll = function() {\n  renderSfView();\n  renderFldEntry();\n  renderDoc();\n}\n\nconst renderInstructions = function () {\n  $('.instructions-frame').show();\n  ef.unbindEvents();\n}\n\nconst renderInstructionsHide = function () {\n  $('.instructions-frame').hide();\n  ef.bindEvents();\n}\n\nmodule.exports.renderDoc =renderDoc;\nmodule.exports.renderSelectionErr = renderSelectionErr;\nmodule.exports.renderError = renderError;\nmodule.exports.renderAlert = renderAlert;\nmodule.exports.renderOpenUrl = renderOpenUrl;\nmodule.exports.renderLoadingStart = renderLoadingStart;\nmodule.exports.renderLoadingEnd = renderLoadingEnd;\nmodule.exports.renderBaseSearch = renderBaseSearch;\nmodule.exports.renderSfView = renderSfView;\nmodule.exports.convertDate = convertDate;\nmodule.exports.renderFldEntry = renderFldEntry;\nmodule.exports.renderIndexSearch = renderIndexSearch;\nmodule.exports.renderIndexCreate = renderIndexCreate;\nmodule.exports.renderAll = renderAll;\nmodule.exports.renderInstructions = renderInstructions;\nmodule.exports.renderInstructionsHide = renderInstructionsHide;\n\n\n//# sourceURL=webpack:///./src/render.js?");

/***/ }),

/***/ "./src/searchfunctions.js":
/*!********************************!*\
  !*** ./src/searchfunctions.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst mf = __webpack_require__(/*! ./mapfunctions.js */ \"./src/mapfunctions.js\");\nconst rf = __webpack_require__(/*! ./recarrayfunctions.js */ \"./src/recarrayfunctions.js\");\nconst rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\n\nconst searchBase = function(rin) {\n  if (d.r[rin].type != \"search\") {\n    return false;\n  }\n\n  const bm = mf.getBorR(rin);\n  let searchObj = {};\n  /*\n  body = {\n      sobject: \"\",\n      conditions: {\n          SfField1: { $like: \"%field1val%\" },\n          SfField2: { $like: \"%field2val%\" },\n          SfField3: \"field3val\" //picklist\n      },\n      fields: {\n          SfField4: 1,\n  \n      }\n  }*/\n  searchObj.sobject = bm.sobject;\n  searchObj.conditions = {};\n  searchObj.fields = {};\n  for (let i in bm.fields) searchObj.fields[bm.fields[i].sfname] = 1;\n  for (let j = 0; j < bm.settings.searchorder.length; j++) {\n    let i = bm.settings.searchorder[j].field;\n    if (d.r[rin].f[i].value) {\n      if (bm.fields[i].type == \"text\") {\n        searchObj.conditions[bm.fields[i].sfname] = {\n          $like: \"%\" + d.r[rin].f[i].value.replace(/\\s+/g, \"%\") + \"%\"\n        };\n      } else {\n        searchObj.conditions[bm.fields[i].sfname] = d.r[rin].f[i].value;\n      }\n    }\n  }\n\n  renderLoadingStart(\"Searching for \" + bm.appname);\n  $.ajax({\n    type: \"POST\",\n    contentType: \"application/json\",\n    url: \"/api/find\",\n    dataType: \"json\",\n    async: true,\n    //json object to sent to the authentication url\n    data: JSON.stringify(searchObj),\n    success: function(data) {\n      d.search = true;\n      d.sdata = {\n        type: \"base\",\n        layout: bm.settings.searchlayout,\n        sobject: searchObj.sobject,\n        i: d.r[rin].bi,\n        records: mf.convRecSA(\"base\", d.r[rin].bi, data)\n      };\n\n      $(document).on(\"searchSelect\", function(e) {\n        if (!e) {\n          return false;\n        }\n        if (e.Id ) {\n          baseSearchSelected(e.Id);\n        } else {\n          return;\n        }\n      });\n      rn.renderLoadingEnd();\n      rn.renderSfView();\n    }\n  });\n\n};\n\nconst clearBaseSearch = function() {\n  d.search = false;\n  d.sdata = { empty: true };\n  rn.renderSfView();\n};\n\nconst searchIndexRecord = function(rin, fin) {\n  var map = mf.getBorR(rin);\n  var fm = map.fields[fin];\n\n  if ( fm.type != 'index' ) { return false;}\n\n  var searchObj = {\n    sobject: fm.indexto,\n    conditions: {},\n    fields: {\n      Id: 1\n    }\n  };\n\n  searchObj.conditions[fm.indexshow] = {\n    $like: \"%\" + d.r[rin].f[fin].showval.replace(/\\s\\s+/g, \"%\") + \"%\"\n  };\n\n  for (var i in fm.indexfields) {\n    searchObj.fields[i] = 1;\n  }\n\n  renderLoadingStart(\"Searching for \" + map.fields[fin].indexto);\n  $.ajax({\n    type: \"POST\",\n    contentType: \"application/json\",\n    url: \"/api/find\",\n    dataType: \"json\",\n    async: true,\n    //json object to sent to the authentication url\n    data: JSON.stringify(searchObj),\n    success: function(data) {\n      rn.renderLoadingEnd();\n      return rn.renderIndexSearch(rin, fin, data);\n    }\n  });\n};\n\nconst loadAllRecords = function(callback) {\n  renderLoadingStart(\"Loading all records\");\n  let loaded = 0;\n  if(d.r.length > d.dm.b.length) {\n    let len = d.r.length;\n    for (let i = d.dm.b.length; i < len; i++) d.r.pop();\n  }\n\n  for (let i = 0; i < d.dm.b.length; i++) {\n    if (!d.r[i].f.Id.value) continue;\n\n    let searchObj = {\n      sobject: d.dm.b[i].sobject,\n      conditions: {},\n      fields: {}\n    };\n\n    searchObj.conditions.Id = d.r[i].f.Id.value;\n    for (let j in d.dm.b[i].fields) {\n      searchObj.fields[d.dm.b[i].fields[j].sfname] = 1;\n      if (d.dm.b[i].fields[j].value) {\n        searchObj.conditions[d.dm.b[i].fields[j].sfname] =\n          d.dm.b[i].fields[j].value;\n      }\n    }\n\n    $.ajax({\n      type: \"POST\",\n      contentType: \"application/json\",\n      url: \"/api/find\",\n      dataType: \"json\",\n      async: true,\n      //json object to sent to the authentication url\n      data: JSON.stringify(searchObj),\n      success: function(data) {\n        loaded += 1;\n        if (data) {\n          for (let l in data) {\n            rf.addBaseRecord(i, data[l]);\n          }\n        }\n        \n        if (loaded === d.dm.b.length + d.dm.r.length) {\n          rf.orderR();\n          rf.updateIndexFields(() => {\n            rn.renderFldEntry();\n            rn.renderSfView();\n            if(callback && typeof(callback) === 'function') callback();\n          });\n        }\n      }\n    });\n  }\n\n\n  let rlen = d.dm.r.length;\n  for (let i = 0; i < rlen; i++) {\n    let searchObj = {\n      sobject: d.dm.r[i].sobject,\n      conditions: {},\n      fields: {}\n    };\n\n    for (let j in d.dm.r[i].fields) {\n      searchObj.fields[d.dm.r[i].fields[j].sfname] = 1;\n      if (d.dm.r[i].fields[j].value) {\n        searchObj.conditions[d.dm.r[i].fields[j].sfname] =\n          d.dm.r[i].fields[j].value;\n      } else if (d.dm.r[i].fields[j].inherits) {\n        for (let k in r) {\n          if (d.r[k].bi == d.dm.r[i].fields[j].inherits.base) {\n            searchObj.conditions[d.dm.r[i].fields[j].sfname] =\n              d.r[k].f[d.dm.r[i].fields[j].inherits.field].value;\n          }\n        }\n      }\n    }\n\n    $.ajax({\n      type: \"POST\",\n      contentType: \"application/json\",\n      url: \"/api/find\",\n      dataType: \"json\",\n      async: true,\n      //json object to sent to the authentication url\n      data: JSON.stringify(searchObj),\n      success: function(data) {\n        loaded += 1;\n        if (data) {\n          for (let l in data) {\n            rf.addRecord(i, data[l]);\n          }\n        }\n\n        if (loaded === dm.b.length + dm.r.length) {\n          rf.orderR();\n          rf.updateIndexFields(() => {\n            rn.renderFldEntry();\n            rn.renderSfView();\n            if(callback && typeof(callback) === 'function') callback();\n          });\n        }\n\n        return true;\n      }\n    });\n  }\n};\n\nconst indexSearchSelected = function(rin, fin, record) {\n  if (!record.Id) {\n    return false;\n  }\n\n  rf.setValue(rin, fin, record.Id);\n  const fm = mf.getFm(rin, fin);\n  if (!record[fm.indexshow]) {\n    return false;\n  }\n\n  d.r[rin].f[fin].showval = record[fm.indexshow];\n  rf.nextf();\n  rn.renderFldEntry();\n  return true;\n};\n\nconst baseSearchSelected = function(id) {\n  let bRec = {};\n  for (let i in d.sdata.records) {\n    if (d.sdata.records[i].Id === id) {\n      bRec = d.sdata.records[i];\n    }\n  }\n\n  if (!bRec.Id) {\n    return false;\n  }\n\n  rf.addBaseRecord(d.sdata.i, bRec);\n  return;\n};\n\nconst recordSearchSelected = function(id) {\n  let rec = {};\n  for (let i in d.sdata.records) {\n    if (d.sdata.records[i].Id === id) {\n      rec = d.sdata.records[i];\n    }\n  }\n\n  if (!rec.Id) {\n    return false;\n  }\n\n  rf.addRecord(d.sdata.i, record);\n  rn.renderSfView();\n  rn.renderFldEntry();\n  return;\n};\n\nmodule.exports.searchBase = searchBase;\nmodule.exports.clearBaseSearch = clearBaseSearch;\nmodule.exports.searchIndexRecord = searchIndexRecord;\nmodule.exports.loadAllRecords = loadAllRecords;\nmodule.exports.indexSearchSelected = indexSearchSelected;\nmodule.exports.baseSearchSelected = baseSearchSelected;\nmodule.exports.recordSearchSelected = recordSearchSelected;\n\n\n//# sourceURL=webpack:///./src/searchfunctions.js?");

/***/ }),

/***/ "./src/upsertfunctions.js":
/*!********************************!*\
  !*** ./src/upsertfunctions.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("const d = __webpack_require__(/*! ./data.js */ \"./src/data.js\");\nconst mf = __webpack_require__(/*! ./mapfunctions.js */ \"./src/mapfunctions.js\");\nconst rf = __webpack_require__(/*! ./recarrayfunctions.js */ \"./src/recarrayfunctions.js\");\nconst rn = __webpack_require__(/*! ./render.js */ \"./src/render.js\");\n\nconst updateRecord = function(rin, callback) {\n  if ( !isChanged(rin) ) { return false; }\n\n  let map = mf.getBorR(rin);\n  let rec = d.r[rin];\n  if ( rec.new && !rec.f.Id.value ) {\n    let apiObj = {\n      sobject: map.sobject,\n      records: [{}],\n    };\n\n    for (let i in rec.f) {\n      if ( rec.f[i].value && rec.f[i].sfname != \"Id\" && !map.fields[i].noupdate) {\n        apiObj.records[0][map.fields[i].sfname] = rec.f[i].value;\n      }\n    }\n\n    $.ajax({\n      type: \"POST\",\n      contentType: \"application/json\",\n      url: \"/api/create\",\n      dataType: \"json\",\n      async: true,\n      //json object to sent to the authentication url\n      data: JSON.stringify(apiObj),\n      success: function(data) {\n        if ( data.success === false || data.err ) {\n          return;\n        }\n\n        if(callback) callback(data, rin);\n      }\n    });\n\n  } else if ( !rec.new ) {\n    let apiObj = {\n      sobject: map.sobject,\n      records: [{}],\n    };\n\n    apiObj.records[0].Id = rec.f.Id.value;\n    for (let i in rec.f) {\n      if(rec.f[i].value != rec.f[i].origval && !map.fields[i].noupdate) { apiObj.records[0][map.fields[i].sfname] = rec.f[i].value; }\n    }\n\n    $.ajax({\n      type: \"POST\",\n      contentType: \"application/json\",\n      url: \"/api/update\",\n      dataType: \"json\",\n      async: true,\n      //json object to sent to the authentication url\n      data: JSON.stringify(apiObj),\n      success: function(data) {\n        if ( data.success === false || data.err ) {\n          return;\n        }\n\n        if(callback) callback(data);\n      }\n    });\n\n\n  } else {\n    rn.renderErr('Record is labelled new but has salesforce Id');\n    return false;\n  }\n\n  return true;\n}\n\nconst updateAll = function() {\n  if( allUnchanged() ) { \n    rn.renderError('Nothing to update!');\n    return false; \n  }\n\n  var ctr = 0;\n  var total = 0;\n  rn.renderLoadingStart();\n  for( let i = 0; i < d.r.length; i++ ) {\n    if ( !isChanged(i) ) { \n      continue; \n    } else {\n      total += 1;\n    }\n  }\n  \n  for ( let i = 0; i < d.r.length; i++ ) {\n    updateRecord(i, function(){\n      ctr += 1;\n      if(ctr === total) {\n        rn.renderLoadingEnd();\n        rn.loadAllRecords();\n      }\n    });\n  }\n\n  return true;\n};\n\nmodule.exports.updateRecord = updateRecord;\nmodule.exports.updateAll = updateAll;\n\n\n//# sourceURL=webpack:///./src/upsertfunctions.js?");

/***/ })

/******/ });